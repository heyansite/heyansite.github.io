<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>0 - 什么是线程安全 | Yan&#39;s Blog Home</title>
    <meta name="description" content="Personal blog site">
    
    
    <link rel="preload" href="/assets/css/0.styles.659f981c.css" as="style"><link rel="preload" href="/assets/js/app.29af2d6c.js" as="script"><link rel="preload" href="/assets/js/2.858e58ff.js" as="script"><link rel="preload" href="/assets/js/76.2f88e50b.js" as="script"><link rel="prefetch" href="/assets/js/10.5dcc1f52.js"><link rel="prefetch" href="/assets/js/100.0327e00b.js"><link rel="prefetch" href="/assets/js/101.404f187c.js"><link rel="prefetch" href="/assets/js/102.d78878ec.js"><link rel="prefetch" href="/assets/js/103.ec9aedef.js"><link rel="prefetch" href="/assets/js/104.39309514.js"><link rel="prefetch" href="/assets/js/105.afbf1884.js"><link rel="prefetch" href="/assets/js/106.8e9709d3.js"><link rel="prefetch" href="/assets/js/107.9712aa22.js"><link rel="prefetch" href="/assets/js/108.4158fdb6.js"><link rel="prefetch" href="/assets/js/109.ae61a303.js"><link rel="prefetch" href="/assets/js/11.34e3d90e.js"><link rel="prefetch" href="/assets/js/110.0abce6c9.js"><link rel="prefetch" href="/assets/js/111.b5c958e5.js"><link rel="prefetch" href="/assets/js/112.9b07d6a0.js"><link rel="prefetch" href="/assets/js/113.9d95243d.js"><link rel="prefetch" href="/assets/js/114.f759f9b9.js"><link rel="prefetch" href="/assets/js/115.fd833a74.js"><link rel="prefetch" href="/assets/js/116.1e5e62e4.js"><link rel="prefetch" href="/assets/js/117.952db9d4.js"><link rel="prefetch" href="/assets/js/118.ed9df468.js"><link rel="prefetch" href="/assets/js/119.f19ee9e0.js"><link rel="prefetch" href="/assets/js/12.cd237cda.js"><link rel="prefetch" href="/assets/js/120.24dbecef.js"><link rel="prefetch" href="/assets/js/121.41c70ddb.js"><link rel="prefetch" href="/assets/js/122.5205ca42.js"><link rel="prefetch" href="/assets/js/123.25aa20a6.js"><link rel="prefetch" href="/assets/js/124.11cc8c85.js"><link rel="prefetch" href="/assets/js/125.091331f4.js"><link rel="prefetch" href="/assets/js/126.471b335f.js"><link rel="prefetch" href="/assets/js/127.60ffdb36.js"><link rel="prefetch" href="/assets/js/128.9c5c36ef.js"><link rel="prefetch" href="/assets/js/129.36fd802b.js"><link rel="prefetch" href="/assets/js/13.de2ffe9f.js"><link rel="prefetch" href="/assets/js/130.822de8a4.js"><link rel="prefetch" href="/assets/js/131.697750e2.js"><link rel="prefetch" href="/assets/js/132.fd5faa78.js"><link rel="prefetch" href="/assets/js/133.cf327ef4.js"><link rel="prefetch" href="/assets/js/134.6cdb8690.js"><link rel="prefetch" href="/assets/js/135.906c8800.js"><link rel="prefetch" href="/assets/js/136.43585d13.js"><link rel="prefetch" href="/assets/js/137.3c7ddb41.js"><link rel="prefetch" href="/assets/js/138.e3274ead.js"><link rel="prefetch" href="/assets/js/139.7fa38b58.js"><link rel="prefetch" href="/assets/js/14.9d6406e7.js"><link rel="prefetch" href="/assets/js/140.1b026dad.js"><link rel="prefetch" href="/assets/js/141.c1adfec5.js"><link rel="prefetch" href="/assets/js/142.2810013c.js"><link rel="prefetch" href="/assets/js/143.af96e2f9.js"><link rel="prefetch" href="/assets/js/144.923a7d38.js"><link rel="prefetch" href="/assets/js/145.d88163de.js"><link rel="prefetch" href="/assets/js/146.2134dd3e.js"><link rel="prefetch" href="/assets/js/147.9925c468.js"><link rel="prefetch" href="/assets/js/148.109297cc.js"><link rel="prefetch" href="/assets/js/149.ae529d47.js"><link rel="prefetch" href="/assets/js/15.fe3428fa.js"><link rel="prefetch" href="/assets/js/150.705297ac.js"><link rel="prefetch" href="/assets/js/151.a715116f.js"><link rel="prefetch" href="/assets/js/152.57feb7ad.js"><link rel="prefetch" href="/assets/js/153.fd5cde7c.js"><link rel="prefetch" href="/assets/js/154.8cedd5d3.js"><link rel="prefetch" href="/assets/js/155.042308eb.js"><link rel="prefetch" href="/assets/js/156.54044f43.js"><link rel="prefetch" href="/assets/js/157.69e07481.js"><link rel="prefetch" href="/assets/js/158.5b91c0e7.js"><link rel="prefetch" href="/assets/js/159.ccb310d2.js"><link rel="prefetch" href="/assets/js/16.7976352c.js"><link rel="prefetch" href="/assets/js/160.08c90bea.js"><link rel="prefetch" href="/assets/js/161.943b1e4b.js"><link rel="prefetch" href="/assets/js/162.8092cc22.js"><link rel="prefetch" href="/assets/js/163.3c82e51b.js"><link rel="prefetch" href="/assets/js/164.0fd751fe.js"><link rel="prefetch" href="/assets/js/165.60d778eb.js"><link rel="prefetch" href="/assets/js/166.54d7340a.js"><link rel="prefetch" href="/assets/js/167.5fd6aaa3.js"><link rel="prefetch" href="/assets/js/168.205929f8.js"><link rel="prefetch" href="/assets/js/169.873b90b1.js"><link rel="prefetch" href="/assets/js/17.4a461074.js"><link rel="prefetch" href="/assets/js/170.68c49359.js"><link rel="prefetch" href="/assets/js/171.d8f93304.js"><link rel="prefetch" href="/assets/js/172.6b496cc7.js"><link rel="prefetch" href="/assets/js/173.f276a0ce.js"><link rel="prefetch" href="/assets/js/174.09cb41e2.js"><link rel="prefetch" href="/assets/js/175.c77ce8d9.js"><link rel="prefetch" href="/assets/js/176.01ab9f3f.js"><link rel="prefetch" href="/assets/js/177.e9733435.js"><link rel="prefetch" href="/assets/js/178.02e78943.js"><link rel="prefetch" href="/assets/js/179.0d14e948.js"><link rel="prefetch" href="/assets/js/18.8264b169.js"><link rel="prefetch" href="/assets/js/180.9a15f295.js"><link rel="prefetch" href="/assets/js/181.d5bcbada.js"><link rel="prefetch" href="/assets/js/182.571b87a8.js"><link rel="prefetch" href="/assets/js/183.0ce45547.js"><link rel="prefetch" href="/assets/js/184.8397e2fe.js"><link rel="prefetch" href="/assets/js/185.3a38f733.js"><link rel="prefetch" href="/assets/js/186.881a0fab.js"><link rel="prefetch" href="/assets/js/187.17663dea.js"><link rel="prefetch" href="/assets/js/188.471fcd9b.js"><link rel="prefetch" href="/assets/js/189.69430297.js"><link rel="prefetch" href="/assets/js/19.e6227b20.js"><link rel="prefetch" href="/assets/js/190.357b4cc8.js"><link rel="prefetch" href="/assets/js/191.f2d049a7.js"><link rel="prefetch" href="/assets/js/192.e2d30cca.js"><link rel="prefetch" href="/assets/js/193.2fbcbc68.js"><link rel="prefetch" href="/assets/js/194.61d0acd9.js"><link rel="prefetch" href="/assets/js/195.33b772c3.js"><link rel="prefetch" href="/assets/js/196.7d35848a.js"><link rel="prefetch" href="/assets/js/197.4b958d27.js"><link rel="prefetch" href="/assets/js/198.dfbfba98.js"><link rel="prefetch" href="/assets/js/199.f6c7aacb.js"><link rel="prefetch" href="/assets/js/20.65ad9b00.js"><link rel="prefetch" href="/assets/js/200.6a05302e.js"><link rel="prefetch" href="/assets/js/201.be446c97.js"><link rel="prefetch" href="/assets/js/202.d058ca1d.js"><link rel="prefetch" href="/assets/js/203.ef2b609c.js"><link rel="prefetch" href="/assets/js/204.dab38ee5.js"><link rel="prefetch" href="/assets/js/21.bf0f72d4.js"><link rel="prefetch" href="/assets/js/22.0ed457bc.js"><link rel="prefetch" href="/assets/js/23.789f7b2b.js"><link rel="prefetch" href="/assets/js/24.f151ffcb.js"><link rel="prefetch" href="/assets/js/25.1edb28e8.js"><link rel="prefetch" href="/assets/js/26.6a5f804d.js"><link rel="prefetch" href="/assets/js/27.98408441.js"><link rel="prefetch" href="/assets/js/28.fe24662a.js"><link rel="prefetch" href="/assets/js/29.fbd2340a.js"><link rel="prefetch" href="/assets/js/3.753236a7.js"><link rel="prefetch" href="/assets/js/30.30b44255.js"><link rel="prefetch" href="/assets/js/31.510d262b.js"><link rel="prefetch" href="/assets/js/32.c204bc79.js"><link rel="prefetch" href="/assets/js/33.5fa66039.js"><link rel="prefetch" href="/assets/js/34.6db47b26.js"><link rel="prefetch" href="/assets/js/35.fcb88dd5.js"><link rel="prefetch" href="/assets/js/36.e294e99d.js"><link rel="prefetch" href="/assets/js/37.0a98cae2.js"><link rel="prefetch" href="/assets/js/38.94af8189.js"><link rel="prefetch" href="/assets/js/39.e7017f9b.js"><link rel="prefetch" href="/assets/js/4.efbefbf5.js"><link rel="prefetch" href="/assets/js/40.b7a1deeb.js"><link rel="prefetch" href="/assets/js/41.ae4d7d1e.js"><link rel="prefetch" href="/assets/js/42.5dc5c7f6.js"><link rel="prefetch" href="/assets/js/43.1abeab08.js"><link rel="prefetch" href="/assets/js/44.2b0e19f3.js"><link rel="prefetch" href="/assets/js/45.903efdc0.js"><link rel="prefetch" href="/assets/js/46.0684656f.js"><link rel="prefetch" href="/assets/js/47.6425b35e.js"><link rel="prefetch" href="/assets/js/48.551e2caa.js"><link rel="prefetch" href="/assets/js/49.34841bc0.js"><link rel="prefetch" href="/assets/js/5.d3774f5f.js"><link rel="prefetch" href="/assets/js/50.48ce1d7e.js"><link rel="prefetch" href="/assets/js/51.1820aa29.js"><link rel="prefetch" href="/assets/js/52.5317c537.js"><link rel="prefetch" href="/assets/js/53.65c5ef62.js"><link rel="prefetch" href="/assets/js/54.31ed2a5e.js"><link rel="prefetch" href="/assets/js/55.4f9933ab.js"><link rel="prefetch" href="/assets/js/56.beb74e07.js"><link rel="prefetch" href="/assets/js/57.705bc19e.js"><link rel="prefetch" href="/assets/js/58.f5fd656b.js"><link rel="prefetch" href="/assets/js/59.4f21d836.js"><link rel="prefetch" href="/assets/js/6.f082ca37.js"><link rel="prefetch" href="/assets/js/60.fc3cf484.js"><link rel="prefetch" href="/assets/js/61.b5032b43.js"><link rel="prefetch" href="/assets/js/62.64d7637a.js"><link rel="prefetch" href="/assets/js/63.2a71075b.js"><link rel="prefetch" href="/assets/js/64.21eb4820.js"><link rel="prefetch" href="/assets/js/65.11535a8c.js"><link rel="prefetch" href="/assets/js/66.cc057448.js"><link rel="prefetch" href="/assets/js/67.5782c958.js"><link rel="prefetch" href="/assets/js/68.35886dae.js"><link rel="prefetch" href="/assets/js/69.934aa057.js"><link rel="prefetch" href="/assets/js/7.9a79fd87.js"><link rel="prefetch" href="/assets/js/70.53c7c7a2.js"><link rel="prefetch" href="/assets/js/71.0e82b1c6.js"><link rel="prefetch" href="/assets/js/72.0f5ba0b4.js"><link rel="prefetch" href="/assets/js/73.3dabc9cd.js"><link rel="prefetch" href="/assets/js/74.b2ae43f6.js"><link rel="prefetch" href="/assets/js/75.482aa6b4.js"><link rel="prefetch" href="/assets/js/77.d916e87e.js"><link rel="prefetch" href="/assets/js/78.35465388.js"><link rel="prefetch" href="/assets/js/79.03bce65e.js"><link rel="prefetch" href="/assets/js/8.60d5a8a9.js"><link rel="prefetch" href="/assets/js/80.96678f59.js"><link rel="prefetch" href="/assets/js/81.631a8496.js"><link rel="prefetch" href="/assets/js/82.41c1aeb7.js"><link rel="prefetch" href="/assets/js/83.16d5e455.js"><link rel="prefetch" href="/assets/js/84.195ca01f.js"><link rel="prefetch" href="/assets/js/85.d850d4dd.js"><link rel="prefetch" href="/assets/js/86.32d87d56.js"><link rel="prefetch" href="/assets/js/87.5f97a4f6.js"><link rel="prefetch" href="/assets/js/88.f5b0bbdb.js"><link rel="prefetch" href="/assets/js/89.9f9150f5.js"><link rel="prefetch" href="/assets/js/9.b09584f6.js"><link rel="prefetch" href="/assets/js/90.81e868a0.js"><link rel="prefetch" href="/assets/js/91.a4a66d6f.js"><link rel="prefetch" href="/assets/js/92.e992da4f.js"><link rel="prefetch" href="/assets/js/93.8f0f273c.js"><link rel="prefetch" href="/assets/js/94.7c76483d.js"><link rel="prefetch" href="/assets/js/95.448f049a.js"><link rel="prefetch" href="/assets/js/96.29982e03.js"><link rel="prefetch" href="/assets/js/97.4fdd8a0b.js"><link rel="prefetch" href="/assets/js/98.74cfc635.js"><link rel="prefetch" href="/assets/js/99.abdd1b46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.659f981c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yan's Blog Home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java Basic</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java NIO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java 并发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/DevLanguage/Java/Java%E5%B9%B6%E5%8F%91/" class="sidebar-link">Java并发</a></li><li><a href="/DevLanguage/Java/Java并发/0-多线程相关.html" class="sidebar-link">0 - 多线程相关概念</a></li><li><a href="/DevLanguage/Java/Java并发/0-什么是线程安全.html" class="active sidebar-link">0 - 什么是线程安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DevLanguage/Java/Java并发/0-什么是线程安全.html#什么是进程？" class="sidebar-link">什么是进程？</a></li><li class="sidebar-sub-header"><a href="/DevLanguage/Java/Java并发/0-什么是线程安全.html#什么是线程？" class="sidebar-link">什么是线程？</a></li><li class="sidebar-sub-header"><a href="/DevLanguage/Java/Java并发/0-什么是线程安全.html#什么是线程安全？" class="sidebar-link">什么是线程安全？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DevLanguage/Java/Java并发/0-什么是线程安全.html#添加一个状态呢？" class="sidebar-link">添加一个状态呢？</a></li><li class="sidebar-sub-header"><a href="/DevLanguage/Java/Java并发/0-什么是线程安全.html#如何确保线程安全？" class="sidebar-link">如何确保线程安全？</a></li></ul></li></ul></li><li><a href="/DevLanguage/Java/Java并发/0-并发相关.html" class="sidebar-link">0 - 并发相关概念</a></li><li><a href="/DevLanguage/Java/Java并发/0-JMM.html" class="sidebar-link">0 - JMM(Java内存模型)概念</a></li><li><a href="/DevLanguage/Java/Java并发/0-锁.html" class="sidebar-link">0 - 各种锁及Java实现</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 常用框架</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/index/" class="sidebar-link">&lt; 首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_0-什么是线程安全"><a href="#_0-什么是线程安全" class="header-anchor">#</a> 0 - 什么是线程安全</h1> <div class="custom-block tip"><p class="custom-block-title">转</p> <ul><li><a href="https://blog.csdn.net/csdnnews/article/details/82321777" target="_self" rel="noopener noreferrer">https://blog.csdn.net/csdnnews/article/details/82321777</a></li></ul></div> <h2 id="什么是进程？"><a href="#什么是进程？" class="header-anchor">#</a> <strong>什么是进程？</strong></h2> <p>电脑中时会有很多单独运行的程序，每个程序有一个独立的进程，而进程之间是相互独立存在的。比如下图中的QQ、酷狗播放器、电脑管家等等。</p> <h2 id="什么是线程？"><a href="#什么是线程？" class="header-anchor">#</a> <strong>什么是线程？</strong></h2> <p>进程想要执行任务就需要依赖线程。换句话说，就是进程中的最小执行单位就是线程，并且一个进程中至少有一个线程。<br>那什么是多线程？提到多线程这里要说两个概念，就是串行和并行，搞清楚这个，我们才能更好地理解多线程。</p> <p><strong>所谓串行</strong>，其实是相对于单条线程来执行多个任务来说的，我们就拿下载文件来举个例子：当我们下载多个文件时，在串行中它是按照一定的顺序去进行下载的，也就是说，必须等下载完A之后才能开始下载B，它们在时间上是不可能发生重叠的。<br><strong>并行</strong>：下载多个文件，开启多条线程，多个文件同时进行下载，这里是严格意义上的，在同一时刻发生的，并行在时间上是重叠的。</p> <p>了解了这两个概念之后，我们再来说说什么是多线程。举个例子，我们打开腾讯管家，腾讯管家本身就是一个程序，也就是说它就是一个进程，它里面有很多的功能，我们可以看下图，能查杀病毒、清理垃圾、电脑加速等众多功能。<br>按照单线程来说，无论你想要清理垃圾、还是要病毒查杀，那么你必须先做完其中的一件事，才能做下一件事，这里面是有一个执行顺序的。<br>如果是多线程的话，我们其实在清理垃圾的时候，还可以进行查杀病毒、电脑加速等等其他的操作，这个是严格意义上的同一时刻发生的，没有执行上的先后顺序。<br>以上就是，一个进程运行时产生了多个线程。</p> <p>在了解完这个问题后，我们又需要去了解一个使用多线程不得不考虑的问题——线程安全。<br>今天我们不说如何保证一个线程的安全，我们聊聊<strong>什么是线程安全</strong>？因为我之前面试被问到了，说真的，我之前真的不是特别了解这个问题，我们好像只学了如何确保一个线程安全，却不知道所谓的安全到底是什么！</p> <h2 id="什么是线程安全？"><a href="#什么是线程安全？" class="header-anchor">#</a> <strong>什么是线程安全？</strong></h2> <p>既然是线程安全问题，那么毫无疑问，所有的隐患都是在多个线程访问的情况下产生的，也就是我们要确保在多条线程访问的时候，我们的程序还能按照我们预期的行为去执行，我们看一下下面的代码。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Integer</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  count <span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>很简单的一段代码，下面我们就来统计一下这个方法的访问次数，多个线程同时访问会不会出现什么问题，我开启的3条线程，每个线程循环10次，得到以下结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>13
14
15
16
17
18
19
20
21
22
23
24
25
26
26
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>我们可以看到，这里出现了两个26，出现这种情况显然表明这个方法根本就不是线程安全的，出现这种问题的原因有很多。</p> <p>最常见的一种，就是我们A线程在进入方法后，拿到了count的值，刚把这个值读取出来，还没有改变count的值的时候，结果线程B也进来的，那么导致线程A和线程B拿到的count值是一样的。</p> <p>那么由此我们可以了解到，这确实不是一个线程安全的类，因为他们都需要操作这个共享的变量。其实要对线程安全问题给出一个明确的定义，还是蛮复杂的，我们根据我们这个程序来总结下什么是线程安全。</p> <p><strong>当多个线程访问某个方法时，不管你通过怎样的调用方式、或者说这些线程如何交替地执行，我们在主程序中不需要去做任何的同步，这个类的结果行为都是我们设想的正确行为，那么我们就可以说这个类是线程安全的。</strong></p> <p>搞清楚了什么是线程安全，接下来我们看看Java中确保线程安全最常用的两种方式。先来看段代码。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    j <span class="token operator">=</span> j <span class="token operator">+</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>大家觉得这段代码是线程安全的吗？<br>毫无疑问，它绝对是线程安全的，我们来分析一下，为什么它是线程安全的？<br>我们可以看到这段代码是没有任何状态的，就是说我们这段代码，不包含任何的作用域，也没有去引用其他类中的域进行引用，它所执行的作用范围与执行结果只存在它这条线程的局部变量中，并且只能由正在执行的线程进行访问。当前线程的访问，不会对另一个访问同一个方法的线程造成任何的影响。<br>两个线程同时访问这个方法，<strong>因为没有共享的数据，所以他们之间的行为，并不会影响其他线程的操作和结果，所以说无状态的对象，也是线程安全的</strong>。</p> <h3 id="添加一个状态呢？"><a href="#添加一个状态呢？" class="header-anchor">#</a> <strong>添加一个状态呢？</strong></h3> <p>如果我们给这段代码添加一个状态，添加一个count，来记录这个方法并命中的次数，每请求一次count+1，那么这个时候这个线程还是安全的吗？</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDemo</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 记录方法的命中次数</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       count<span class="token operator">++</span> <span class="token punctuation">;</span>
       <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
       j <span class="token operator">=</span> j <span class="token operator">+</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>很明显已经不是了，单线程运行起来确实是没有任何问题的，但是当出现多条线程并发访问这个方法的时候，问题就出现了，我们先来分析下count+1这个操作。<br>进入这个方法之后首先要读取count的值，然后修改count的值，最后才把这把值赋值给count，总共包含了三步过程：“读取”一&gt;“修改”一&gt;“赋值”，既然这个过程是分步的，那么我们先来看下面这张图，看看你能不能看出问题：</p> <div style="display:flex;"><img src="data:image/png;base64,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" alt="jdk overview" align="left" style="zoom:100%;display:block;"></div> <p>可以发现，count的值并不是正确的结果，当线程A读取到count的值，但是还没有进行修改的时候，线程B已经进来了，然后线程B读取到的还是count为1的值，正因为如此所以我们的count值已经出现了偏差，那么这样的程序放在我们的代码中，是存在很多的隐患的。</p> <h3 id="如何确保线程安全？"><a href="#如何确保线程安全？" class="header-anchor">#</a> <strong>如何确保线程安全？</strong></h3> <p>既然存在线程安全的问题，那么肯定得想办法解决这个问题，怎么解决？我们说说常见的几种方式。</p> <p><strong>1. synchronized</strong></p> <p>synchronized关键字，就是用来控制线程同步的，保证我们的线程在多线程环境下，不被多个线程同时执行，确保我们数据的完整性，使用方法一般是加在方法上。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDemo</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 记录方法的命中次数</span>
   <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">threadMethod</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       count<span class="token operator">++</span> <span class="token punctuation">;</span>
       <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
       j <span class="token operator">=</span> j <span class="token operator">+</span> i<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这样就可以确保我们的线程同步了，同时这里需要注意一个大家平时忽略的问题，首先<strong>synchronized锁的是括号里的对象</strong>，而不是代码，其次，对于非静态的synchronized方法，锁的是对象本身也就是this。</p> <p>当synchronized锁住一个对象之后，别的线程如果想要获取锁对象，那么就必须等这个线程执行完释放锁对象之后才可以，否则一直处于等待状态。</p> <p>注意点：虽然加synchronized关键字，可以让我们的线程变得安全，但是我们在用的时候，也要注意缩小synchronized的使用范围，如果随意使用时很影响程序的性能，别的对象想拿到锁，结果你没用锁还一直把锁占用，这样就有点浪费资源。</p> <p><strong>2. Lock</strong></p> <p>先来说说它跟synchronized有什么区别吧，Lock是在Java1.6被引入进来的，Lock的引入让锁有了可操作性，什么意思？就是我们在需要的时候去手动的获取锁和释放锁，甚至我们还可以中断获取以及超时获取的同步特性，但是从使用上说Lock明显没有synchronized使用起来方便快捷。我们先来看下一般是如何使用的：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReentrantLock是Lock的子类</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread<span class="token punctuation">)</span><span class="token punctuation">{</span>
  lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取锁对象</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;获得了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Thread.sleep(2000);</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;释放了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放锁对象</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>进入方法我们首先要获取到锁，然后去执行我们业务代码，这里跟synchronized不同的是，Lock获取的所对象需要我们亲自去进行释放，为了防止我们代码出现异常，所以我们的释放锁操作放在finally中，因为finally中的代码无论如何都是会执行的。</p> <p>写个主方法，开启两个线程测试一下我们的程序是否正常：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">LockTest</span> lockTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// 线程1</span>
       <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token comment">// Thread.currentThread()  返回当前线程的引用</span>
               lockTest<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// 线程2</span>
       <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               lockTest<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>结果：
线程名: t1获得了锁
线程名: t1释放了锁
线程名: t2获得了锁
线程名: t2释放了锁
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看出我们的执行，是没有任何问题的。</p> <p>其实在Lock还有几种获取锁的方式，我们这里再说一种，就是tryLock()这个方法跟Lock()是有区别的，Lock在获取锁的时候，如果拿不到锁，就一直处于等待状态，直到拿到锁，但是tryLock()却不是这样的，tryLock是有一个Boolean的返回值的，如果没有拿到锁，直接返回false，停止等待，它不会像Lock()那样去一直等待获取锁。</p> <p>我们来看下代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token comment">// lock.lock(); // 获取锁对象</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">try</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;获得了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">// Thread.sleep(2000);</span>
           <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;释放了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放锁对象</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>结果：我们继续使用刚才的两个线程进行测试可以发现，在线程t1获取到锁之后，线程t2立马进来，然后发现锁已经被占用，那么这个时候它也不在继续等待。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>线程名: t1获得了锁
线程名: t1释放了锁
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>似乎这种方法，感觉不是很完美，如果我第一个线程，拿到锁的时间，比第二个线程进来的时间还要长，是不是也拿不到锁对象？<br>那我能不能，用一中方式来控制一下，让后面等待的线程，可以等待5秒，如果5秒之后，还获取不到锁，那么就停止等，其实tryLock()是可以进行设置等待的相应时间的。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
       <span class="token comment">// lock.lock(); // 获取锁对象</span>

       <span class="token comment">// 如果2秒内获取不到锁对象，那就不再等待</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">try</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;获得了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               <span class="token comment">// 这里睡眠3秒</span>
               <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;释放了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放锁对象</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>结果：看上面的代码，我们可以发现，虽然我们获取锁对象的时候，可以等待2秒，但是我们线程t1在获取锁对象之后，执行任务缺花费了3秒，那么这个时候线程t2是不在等待的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>线程名<span class="token operator">:</span> t1获得了锁
线程名<span class="token operator">:</span> t1释放了锁
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们再来改一下这个等待时间，改为5秒，再来看下结果：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> thread<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
       <span class="token comment">// lock.lock(); // 获取锁对象</span>

       <span class="token comment">// 如果5秒内获取不到锁对象，那就不再等待</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">try</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;获得了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
               e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;线程名：&quot;</span><span class="token operator">+</span>thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;释放了锁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放锁对象</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>结果：这个时候我们可以看到，线程t2等到5秒获取到了锁对象，执行了任务代码。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>线程名<span class="token operator">:</span> t1获得了锁
线程名<span class="token operator">:</span> t1释放了锁
线程名<span class="token operator">:</span> t2获得了锁
线程名<span class="token operator">:</span> t2释放了锁
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以上就是使用Lock，来保证我们线程安全的方式。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/DevLanguage/Java/Java并发/0-多线程相关.html" class="prev">0 - 多线程相关概念</a></span> <span class="next"><a href="/DevLanguage/Java/Java并发/0-并发相关.html">0 - 并发相关概念</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.29af2d6c.js" defer></script><script src="/assets/js/2.858e58ff.js" defer></script><script src="/assets/js/76.2f88e50b.js" defer></script>
  </body>
</html>
