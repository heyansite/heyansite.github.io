(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{362:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-1.c242664f.png"},363:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-2.2bd69224.png"},364:function(t,s){t.exports="data:image/png;base64,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"},365:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-4.461e9512.png"},366:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-5.05955a7e.png"},367:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-6.4e8a5e04.png"},368:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-7.431ebe4a.png"},369:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-8.1c21adea.png"},370:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-9.064fd4d7.png"},371:function(t,s,a){t.exports=a.p+"assets/img/es-index-basicoperation-10.cf15e313.png"},745:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"es-index-基本操作与并发"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es-index-基本操作与并发"}},[t._v("#")]),t._v(" ES Index-基本操作与并发")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("转载")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.yuque.com/xiongsanxiansheng/qfvqxo/asntd2",target:"_self",rel:"noopener noreferrer"}},[t._v("https://www.yuque.com/xiongsanxiansheng/qfvqxo/asntd2")])])])]),t._v(" "),n("h2",{attrs:{id:"数据的基本操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据的基本操作"}},[t._v("#")]),t._v(" "),n("strong",[t._v("数据的基本操作")])]),t._v(" "),n("h3",{attrs:{id:"_1-文档的-curd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-文档的-curd"}},[t._v("#")]),t._v(" 1. 文档的 CURD")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("Index")])]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("PUT my_index/_doc/1")]),t._v('{"user": "mike", "comment": "You know, for search"}')])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("Create")])]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("PUT my_index/_create/1")]),t._v('{"user": "mike", "comment": "You know, for search"} '),n("strong",[t._v("POST")]),t._v(" "),n("strong",[t._v("my_index/_doc （不指定 ID，自动生成）")]),t._v('{"user": "mike", "comment": "You know, for search"}')])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("Read")])]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("GET")]),t._v(" "),n("strong",[t._v("my_index/_doc/1")])])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("Update")])]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("POST")]),t._v(" "),n("strong",[t._v("my_index/_update/1")]),t._v('{ "doc": {"user": "mike", "comment": "You know, ElasticSearch"} }')])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("Delete")])]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[n("strong",[t._v("DELETE")]),t._v(" "),n("strong",[t._v("my_index/_doc/1")])])])])]),t._v(" "),n("ul",[n("li",[t._v("Type 名，7.x 以后，约定都用 _doc；")]),t._v(" "),n("li",[t._v("Create，如果 ID 已经存在，会失败；")]),t._v(" "),n("li",[t._v("Index，如果 ID 不存在，创建新的文档。否则，先删除现有文档，再创建新的文档，版本会增加；")]),t._v(" "),n("li",[t._v("Update，文档必须已经存在，更新只会对相应字段做增量修改；")]),t._v(" "),n("li",[t._v("Delete，不会立刻物理删除，只会将其标记为 deleted 状态，当数据越来越多的时候，在后台自动删除（细节内容参考：“"),n("em",[t._v("分片内部原理")]),t._v("”）")])]),t._v(" "),n("h4",{attrs:{id:"_1-1-create-一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-create-一个文档"}},[t._v("#")]),t._v(" 1.1 Create 一个文档")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(362),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("支持自动生成文档 ID 和指定文档 ID 两种方式；")]),t._v(" "),n("li",[t._v('通过调用 "POST my_index/_doc"，系统会自动生成 document id；')]),t._v(" "),n("li",[t._v("使用 PUT my_index/"),n("strong",[t._v("_create")]),t._v("/1 创建时，URI 中显示指定 _create，此时如果该 id 的文档已经存在，操作失败；")])]),t._v(" "),n("h4",{attrs:{id:"_1-2-index-一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-index-一个文档"}},[t._v("#")]),t._v(" 1.2 Index 一个文档")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(363),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("Index 和 Create 不一样的地方：如果文档不存在，就索引新的文档。否则现有文档会被删除，新的文档被索引。版本信息+1")]),t._v(" "),n("li",[t._v("document 一旦被索引是不可变的，如果要修改 document 的内容，可以使用 Index 对 document 重新建立索引，相当于全量替换，旧的 document 被标记为 deleted，ES 会在后台适当的时候自动删除；")]),t._v(" "),n("li",[t._v("Index 全量替换修改 document，每次的执行流程是这样的：\n"),n("ul",[n("li",[t._v("应用程序先发起一个 get 请求，获取到 document，展示到前台界面，供用户查看和修改；")]),t._v(" "),n("li",[t._v("用户在前台界面修改数据，发送到后台；")]),t._v(" "),n("li",[t._v("后台代码，会将用户修改的数据在内存中进行执行，然后封装好修改后的全量数据；")]),t._v(" "),n("li",[t._v("然后发送 PUT 请求，到 es 中，进行全量替换；")]),t._v(" "),n("li",[t._v("es 将老的 document 标记为 deleted，然后重新创建一个新的 document；")])])])]),t._v(" "),n("h4",{attrs:{id:"_1-3-update-一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-update-一个文档"}},[t._v("#")]),t._v(" 1.3 Update 一个文档")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(364),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("Update，文档必须已经存在，更新只会对相应字段做增量修改；")]),t._v(" "),n("li",[t._v("Update 方法不会删除原来的文档，而是实现真正的数据更新；")]),t._v(" "),n("li",[t._v('POST 方法 / Payload 需要包含在 "doc" 中；')]),t._v(" "),n("li",[t._v("Update 可以在原文档的基础上增加字段；")])]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("POST users/_update/"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"doc"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"post_date"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-05-15T14:12:12"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"trying out Elasticsearch"')]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("看起来，好像比较方便，每次就传递少数几个发生修改的 field 即可，不需要将全量的 document 数据发过去；")]),t._v(" "),n("blockquote",[n("p",[t._v("那么 "),n("strong",[t._v("Partial Update")]),t._v(" 的实际内部原理是怎样的，它的优点是什么呢？")])]),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(365),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("Partial Update 相较于全量替换的优点：\n"),n("ul",[n("li",[t._v("所有的查询、修改和写回操作，都发生在 ES 中的一个 shard 内部，避免了所有的网路数据传输的开销（减少了2次网络请求），大大提升了性能；")]),t._v(" "),n("li",[t._v("减少了查找和修改中的时间间隔，可以有效减少并发冲突的情况；")])])])]),t._v(" "),n("h4",{attrs:{id:"_1-4-get-一个文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-get-一个文档"}},[t._v("#")]),t._v(" 1.4 Get 一个文档")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(366),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("找到文档，返回 HTTP 200\n"),n("ul",[n("li",[t._v("文档源信息\n"),n("ul",[n("li",[t._v("_index / _type /")]),t._v(" "),n("li",[t._v("版本信息，同一个 ID 的文档，即使被删除，Version 号也会不断增加；")]),t._v(" "),n("li",[t._v("_source 中默认包含了文档的所有原始信息；")])])])])]),t._v(" "),n("li",[t._v("找不到文档，返回 HTTP 404；")])]),t._v(" "),n("h3",{attrs:{id:"_2-bulk-api-批量增、删、改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-bulk-api-批量增、删、改"}},[t._v("#")]),t._v(" 2. Bulk API 批量增、删、改")]),t._v(" "),n("ul",[n("li",[t._v("支持再一次 API 调用中，对不同的索引进行操作；")]),t._v(" "),n("li",[t._v("支持四种类型操作\n"),n("ul",[n("li",[t._v("Index，普通的 put 操作，可以是创建文档，也可以是全量替换文档；")]),t._v(" "),n("li",[t._v("Create，PUT /index/_create/id 操作，强制创建文档；")]),t._v(" "),n("li",[t._v("Update，执行的 partial update 部分更新操作；")]),t._v(" "),n("li",[t._v("Delete，删除一个文档，只要一个 json 串就可以了；")])])]),t._v(" "),n("li",[t._v("可以在 URI 中指定 Index，也可以在请求的 Payload 中进行；")]),t._v(" "),n("li",[t._v("操作中单挑操作失败，并不会影响其他操作；")]),t._v(" "),n("li",[t._v("返回结果包括了每一条操作执行的结果")])]),t._v(" "),n("p",[n("strong",[t._v("POST")]),t._v(" "),n("strong",[t._v("_bulk")])]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field1"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value1"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"create"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field1"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value3"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"update"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"doc"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field2"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"delete"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("ul",[n("li",[t._v("除了 delete 操作，其他每一个操作需要两行，要两个 JSON 串，语法如下：\n"),n("ul",[n("li",[t._v('元素据：{ "action" : { "metadata" }}')]),t._v(" "),n("li",[t._v('document 中的真实数据：{ "data" }')])])]),t._v(" "),n("li",[t._v("Bulk API 对 JSON 的语法，有严格的要求：\n"),n("ul",[n("li",[t._v("每个 JSON 不能像 JSON 对象那样进行格式换行，一个 JSON 只能作为一个字符串只能放在一行；")]),t._v(" "),n("li",[t._v("同时一个 JSON 串和一个 JSON 串之间，必须有一个换行；")])])]),t._v(" "),n("li",[t._v("Bulk Size 最佳大小\n"),n("ul",[n("li",[t._v("bulk request 会加载到内存里，如果太大的话，性能反而会下降，因此需要反复尝试一个最佳的 bulk size；")]),t._v(" "),n("li",[t._v("一般从 1000~5000 条数据开始，尝试逐渐增加。")]),t._v(" "),n("li",[t._v("另外，如果看大小的话，最好是在 5~15 MB 之间；")])])])]),t._v(" "),n("h3",{attrs:{id:"_3-mget-批量读取"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-mget-批量读取"}},[t._v("#")]),t._v(" 3. mget 批量读取")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("批量查询的好处：")]),t._v(" "),n("ul",[n("li",[t._v("就是一条一条的查询，比如说要查询100条数据，那么就要发送100次网络请求，这个开销还是很大的；")]),t._v(" "),n("li",[t._v("如果进行批量查询的话，查询100条数据，就只要发送1次网络请求，网络请求的性能开销缩减100倍；")])])]),t._v(" "),n("li",[n("p",[t._v("GET 请求进行查询，在 Body 中的 docs 数组里面，用 _index、_id 来定位 document；")]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("GET _mget\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"docs"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"comment"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#URI中指定index\nGET /test/_mget\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"docs"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n#指定返回的document内容部分\nGET /_mget\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"docs"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_source"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_source"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"field3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"field4"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_source"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"include"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"exclude"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user.location"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br")])])]),t._v(" "),n("li",[n("p",[t._v("mget 的重要性")]),t._v(" "),n("ul",[n("li",[t._v("一般来说，在进行查询的时候，如果一次性要查询多条数据的话，那么一定要用 batch 批量操作的 api；")]),t._v(" "),n("li",[t._v("尽可能减少网络开销次数，可能可以将性能提升数倍，甚至数十倍，非常非常之重要；")])])])]),t._v(" "),n("h3",{attrs:{id:"_4-msearch-批量条件查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-msearch-批量条件查询"}},[t._v("#")]),t._v(" 4. msearch 批量条件查询")]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("### msearch 操作\nPOST kibana_sample_data_ecommerce/_msearch\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match_all"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kibana_sample_data_flights"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match_all"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("h3",{attrs:{id:"_5-常见的错误返回"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-常见的错误返回"}},[t._v("#")]),t._v(" 5. 常见的错误返回")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[n("strong",[t._v("问题")])]),t._v(" "),n("th",[n("strong",[t._v("原因")])])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("无法连接")]),t._v(" "),n("td",[t._v("网络故障或集群挂了")])]),t._v(" "),n("tr",[n("td",[t._v("连接无法关闭")]),t._v(" "),n("td",[t._v("网络故障或节点出错")])]),t._v(" "),n("tr",[n("td",[t._v("429")]),t._v(" "),n("td",[t._v("集群过于繁忙")])]),t._v(" "),n("tr",[n("td",[t._v("4xx")]),t._v(" "),n("td",[t._v("请求体格式有错")])]),t._v(" "),n("tr",[n("td",[t._v("500")]),t._v(" "),n("td",[t._v("集群内部错误")])])])]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"读写文档的并发操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#读写文档的并发操作"}},[t._v("#")]),t._v(" "),n("strong",[t._v("读写文档的并发操作")])]),t._v(" "),n("h3",{attrs:{id:"_1-图解elasticsearch并发冲突问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-图解elasticsearch并发冲突问题"}},[t._v("#")]),t._v(" 1. 图解ElasticSearch并发冲突问题")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(367),alt:"",align:"left"}})]),t._v(" "),n("p",[t._v("上面说的这个过程，其实就是 ES 中的并发冲突问题，会导致数据不准确：")]),t._v(" "),n("ul",[n("li",[t._v("有些场景下，其实是无所谓的，不关注这个数据不准确的事情，比如说，我们如果就只是简单的将数据写入ES，无论数据是什么样的，都可以；还有些情况下，即使是算错了，也可以；（比如文章阅读数量统计，评论数量统计）")]),t._v(" "),n("li",[t._v("当并发操作 ES 的线程越来越多，或者并发请求越多；或者是读取一份数据，供用户查阅和操作的时间越长，因为这段时间里很可能数据在 ES 中已经被修改了，那么我们拿到的就是旧数据，基于旧数据去操作，后面结果肯定就错了；")])]),t._v(" "),n("h3",{attrs:{id:"_2-图解悲观锁和乐观锁两种并发控制方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-图解悲观锁和乐观锁两种并发控制方案"}},[t._v("#")]),t._v(" 2. 图解悲观锁和乐观锁两种并发控制方案")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(368),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(369),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[t._v(" --\x3e ES 使用乐观锁并发控制方案；")])],1),t._v(" "),n("p",[n("strong",[t._v("总结：")])]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("悲观锁并发控制")]),t._v(" "),n("ul",[n("li",[t._v("悲观锁的含义：我认为每次更新都有冲突的可能，并发更新这种操作特别不靠谱，我只相信只有严格按我定义的粒度进行串行更新，才是最安全的，一个线程更新时，其他的线程等着，前一个线程更新完成后，下一个线程再上。")]),t._v(" "),n("li",[t._v("关系型数据库中广泛使用该方案，常见的表锁、行锁、读锁、写锁，依赖redis或memcache等实现的分布式锁，都属于悲观锁的范畴。明显的特征是后续的线程会被挂起等待，性能一般来说比较低，不过自行实现的分布式锁，粒度可以自行控制（按行记录、按客户、按业务类型等），在数据正确性与并发性能方面也能找到很好的折衷点。")])])]),t._v(" "),n("li",[n("strong",[t._v("乐观锁并发控制")]),t._v(" "),n("ul",[n("li",[t._v("乐观锁的含义：我认为冲突不经常发生，我想提高并发的性能，如果真有冲突，被冲突的线程重新再尝试几次就好了。")]),t._v(" "),n("li",[t._v("Elasticsearch 默认使用的是乐观锁方案，前面介绍的 _version 字段，记录的就是每次更新的版本号，只有拿到最新版本号的更新操作，才能更新成功，其他拿到过期数据的更新失败，由客户端程序决定失败后的处理方案，一般是重试。")])])])]),t._v(" "),n("h3",{attrs:{id:"_3-图解elasticsearch内部如何基于-version进行乐观锁并发控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-图解elasticsearch内部如何基于-version进行乐观锁并发控制"}},[t._v("#")]),t._v(" 3. 图解ElasticSearch内部如何基于_version进行乐观锁并发控制")]),t._v(" "),n("h4",{attrs:{id:"_3-1-replica-shard-数据同步并发控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-replica-shard-数据同步并发控制"}},[t._v("#")]),t._v(" 3.1 Replica Shard 数据同步并发控制")]),t._v(" "),n("p",[t._v('在 Elasticsearch 内部，每当 primary shard 收到新的数据时，都需要向 replica shard 进行数据同步，这种同步请求特别多，并且是异步的。如果同一个 document 进行了多次修改，Shard 同步的请求是无序的，可能会出现"后发先至"的情况，如果没有任何的并发控制机制，那结果将无法相像。')]),t._v(" "),n("p",[t._v("Shard 的数据同步也是基于内置的 _version 进行乐观锁并发控制的。")]),t._v(" "),n("p",[t._v("例如 Java 客户端向 Elasticsearch 某条 document 发起更新请求，共发出3次，Java 端有严谨的并发请求控制，在 ElasticSearch 的 primary shard 中写入的结果是正确的，但 Elasticsearch 内部数据启动同步时，顺序不能保证都是先到先得，情况可能是这样，第三次更新请求比第二次更新请求先到，如下图：")]),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(370),alt:"",align:"left"}})]),t._v(" "),n("p",[t._v("如果 Elasticsearch 内部没有并发的控制，这个 document 在 replica 的结果可能是 test2，并且与 primary shard 的值不一致，这样肯定错了。"),n("br"),t._v("预期的更新顺序应该是 test1--\x3etest2--\x3etest3，最终的正确结果是 test3。那 Elasticsearch 内部是如何做的呢？"),n("br"),t._v("Elasticsearch 内部在更新 document 时，会比较一下 version，如果请求的 version 与 document 的 version 相等，就做更新，如果 document 的 version 已经大于请求的 version，说明此数据已经被后到的线程更新过了，此时会丢弃当前的请求，最终的结果为 test3。"),n("br"),t._v("此时的更新顺序为 test1--\x3etest2，最终结果也是对的。")]),t._v(" "),n("h4",{attrs:{id:"_3-2-partial-update-乐观锁并发控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-partial-update-乐观锁并发控制"}},[t._v("#")]),t._v(" 3.2 Partial Update 乐观锁并发控制")]),t._v(" "),n("br"),t._v(" "),n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{display:"block"},attrs:{src:a(371),alt:"",align:"left"}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("partial update 内置乐观锁并发控制\n"),n("ul",[n("li",[t._v("如果拿到的  _version 低于 partial update 操作时现有 document 的 _version，那么 es 会自动把此次 partial update fail 掉，让 partial update 失效；")])])]),t._v(" "),n("li",[t._v("retry_on_conflict\n"),n("ul",[n("li",[t._v("partial update 并发冲突时，如果 _version 低于现有的 document 的 _version，默认内置乐观锁会让此操作不生效；")]),t._v(" "),n("li",[t._v("如果要保证此次 partial update 操作尽可能的执行成功，可以添加 retry_on_conflict 参数，进行多次更新尝试；")]),t._v(" "),n("li",[t._v("retry 策略：\n"),n("ul",[n("li",[t._v("再次获取 document 数据和最新版本号；")]),t._v(" "),n("li",[t._v("基于最新版本号再次去更新，如果成功那么就 ok 了；")]),t._v(" "),n("li",[t._v("如果失败，重复1和2两个步骤，最多重复几次呢？可以通过 retry 那个参数的值指定，比如5次；")])])])])])]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("POST myindex/_update/"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("?retry_on_conflict="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"doc"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test_field"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test==2"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n#也可以指定_version，如果于我们要求的version不一致，就会返回错误，再根据需求自己决定下一步操作\nPOST myindex/_update/"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("?version="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("&retry_on_conflict="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"doc"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test_field"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test==2"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("h3",{attrs:{id:"_4-es基于-version进行乐观锁并发控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-es基于-version进行乐观锁并发控制"}},[t._v("#")]),t._v(" 4. ES基于_version进行乐观锁并发控制")]),t._v(" "),n("p",[n("strong",[t._v("旧版本")]),t._v("的 elasticsearch 是用 version 来解决并发问题，采用乐观锁的方式，比较更新时的 version 是否相同来决定能不能更新。但是在新版本 elasticsearch "),n("strong",[t._v("7.x")]),t._v(" 再使用 version 就会报上述问题；")]),t._v(" "),n("blockquote",[n("p",[n("strong",[t._v("新版本")]),t._v("用的是 _seq_no 和 _primary_term 两个字段来代替 version 处理并发问题，在查询文档时，这两个字段会返回。")])]),t._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[t._v("GET myindex/_doc/"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n#返回结果\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_index"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myindex"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_type"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_doc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_id"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_version"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_seq_no"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_primary_term"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"found"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_source"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test_field"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test==2"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n#新版本使用 if_seq_no、if_primary_term 参数来代替version做版本控制\nPUT myindex/_doc/"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("?if_seq_no="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("&if_primary_term="),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test_field"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test test333"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br")])]),n("h3",{attrs:{id:"_5-es基于external-version进行乐观锁并发控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-es基于external-version进行乐观锁并发控制"}},[t._v("#")]),t._v(" 5. ES基于external version进行乐观锁并发控制")]),t._v(" "),n("ul",[n("li",[t._v("external version：\n"),n("ul",[n("li",[t._v("es 提供了一个 feature，就是说，你可以不用它提供的内部 _version 版本号来进行并发控制，可以基于你自己维护的一个版本号来进行并发控制。")]),t._v(" "),n("li",[t._v("举个列子，假如你的数据在 mysql 里也有一份，然后你的应用系统本身就维护了一个版本号，无论是什么，如自己生成的、或程序控制的。这个时候，你进行乐观锁并发控制的时候，可能并不是想要用 es 内部的 _version 来进行控制，而是用你自己维护的那个 version 来进行控制。")])])])]),t._v(" "),n("p",[n("strong",[t._v("基于 _version")]),t._v("："),n("code",[t._v("?version=1")]),n("br"),n("strong",[t._v("基于 external version")]),t._v("："),n("code",[t._v("?version=1&version_type=external")])]),t._v(" "),n("ul",[n("li",[t._v("两者的区别在\n"),n("ul",[n("li",[t._v("_version：只有当你提供的 version 与 es 中的 _version 一模一样的时候，才可以进行修改，只要不一样，就报错；")]),t._v(" "),n("li",[t._v("当 version_type=external 的时候，只有当你提供的 version 比 es 中的 _version 大的时候，才能完成修改；")])])])]),t._v(" "),n("p",[t._v("es，_version=1，?version=1，才能更新成功；"),n("br"),t._v("es，_version=1，?version>1&version_type=external，才能成功，比如 version=2；")]),t._v(" "),n("blockquote",[n("p",[t._v("经过测试，external version 版本控制方案在新老版本中都可以使用。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);