<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 教程 | Yan&#39;s Blog Home</title>
    <meta name="description" content="Personal blog site">
    
    
    <link rel="preload" href="/assets/css/0.styles.659f981c.css" as="style"><link rel="preload" href="/assets/js/app.2ba1140b.js" as="script"><link rel="preload" href="/assets/js/2.858e58ff.js" as="script"><link rel="preload" href="/assets/js/27.98408441.js" as="script"><link rel="prefetch" href="/assets/js/10.5dcc1f52.js"><link rel="prefetch" href="/assets/js/100.0327e00b.js"><link rel="prefetch" href="/assets/js/101.404f187c.js"><link rel="prefetch" href="/assets/js/102.d78878ec.js"><link rel="prefetch" href="/assets/js/103.a682f6f1.js"><link rel="prefetch" href="/assets/js/104.d831bcb5.js"><link rel="prefetch" href="/assets/js/105.afbf1884.js"><link rel="prefetch" href="/assets/js/106.8e9709d3.js"><link rel="prefetch" href="/assets/js/107.9712aa22.js"><link rel="prefetch" href="/assets/js/108.4158fdb6.js"><link rel="prefetch" href="/assets/js/109.ae61a303.js"><link rel="prefetch" href="/assets/js/11.34e3d90e.js"><link rel="prefetch" href="/assets/js/110.0abce6c9.js"><link rel="prefetch" href="/assets/js/111.b5c958e5.js"><link rel="prefetch" href="/assets/js/112.fdacfaf6.js"><link rel="prefetch" href="/assets/js/113.9d95243d.js"><link rel="prefetch" href="/assets/js/114.f759f9b9.js"><link rel="prefetch" href="/assets/js/115.1b1f9f3d.js"><link rel="prefetch" href="/assets/js/116.1e5e62e4.js"><link rel="prefetch" href="/assets/js/117.952db9d4.js"><link rel="prefetch" href="/assets/js/118.ed9df468.js"><link rel="prefetch" href="/assets/js/119.f19ee9e0.js"><link rel="prefetch" href="/assets/js/12.cd237cda.js"><link rel="prefetch" href="/assets/js/120.24dbecef.js"><link rel="prefetch" href="/assets/js/121.0aa2d47c.js"><link rel="prefetch" href="/assets/js/122.5205ca42.js"><link rel="prefetch" href="/assets/js/123.25aa20a6.js"><link rel="prefetch" href="/assets/js/124.420b2a92.js"><link rel="prefetch" href="/assets/js/125.091331f4.js"><link rel="prefetch" href="/assets/js/126.471b335f.js"><link rel="prefetch" href="/assets/js/127.60ffdb36.js"><link rel="prefetch" href="/assets/js/128.9c5c36ef.js"><link rel="prefetch" href="/assets/js/129.36fd802b.js"><link rel="prefetch" href="/assets/js/13.de2ffe9f.js"><link rel="prefetch" href="/assets/js/130.822de8a4.js"><link rel="prefetch" href="/assets/js/131.697750e2.js"><link rel="prefetch" href="/assets/js/132.fd5faa78.js"><link rel="prefetch" href="/assets/js/133.cf327ef4.js"><link rel="prefetch" href="/assets/js/134.6cdb8690.js"><link rel="prefetch" href="/assets/js/135.906c8800.js"><link rel="prefetch" href="/assets/js/136.43585d13.js"><link rel="prefetch" href="/assets/js/137.3c7ddb41.js"><link rel="prefetch" href="/assets/js/138.e3274ead.js"><link rel="prefetch" href="/assets/js/139.7fa38b58.js"><link rel="prefetch" href="/assets/js/14.9d6406e7.js"><link rel="prefetch" href="/assets/js/140.1b026dad.js"><link rel="prefetch" href="/assets/js/141.c1adfec5.js"><link rel="prefetch" href="/assets/js/142.ed2a4a22.js"><link rel="prefetch" href="/assets/js/143.af96e2f9.js"><link rel="prefetch" href="/assets/js/144.923a7d38.js"><link rel="prefetch" href="/assets/js/145.d88163de.js"><link rel="prefetch" href="/assets/js/146.2134dd3e.js"><link rel="prefetch" href="/assets/js/147.9925c468.js"><link rel="prefetch" href="/assets/js/148.109297cc.js"><link rel="prefetch" href="/assets/js/149.ae529d47.js"><link rel="prefetch" href="/assets/js/15.fe3428fa.js"><link rel="prefetch" href="/assets/js/150.6bf9657f.js"><link rel="prefetch" href="/assets/js/151.603cf1f9.js"><link rel="prefetch" href="/assets/js/152.b64ef399.js"><link rel="prefetch" href="/assets/js/153.fd5cde7c.js"><link rel="prefetch" href="/assets/js/154.8cedd5d3.js"><link rel="prefetch" href="/assets/js/155.042308eb.js"><link rel="prefetch" href="/assets/js/156.1f58dd5a.js"><link rel="prefetch" href="/assets/js/157.69e07481.js"><link rel="prefetch" href="/assets/js/158.40b656df.js"><link rel="prefetch" href="/assets/js/159.823c56a4.js"><link rel="prefetch" href="/assets/js/16.7976352c.js"><link rel="prefetch" href="/assets/js/160.93aba24e.js"><link rel="prefetch" href="/assets/js/161.3ae7729a.js"><link rel="prefetch" href="/assets/js/162.8092cc22.js"><link rel="prefetch" href="/assets/js/163.3c82e51b.js"><link rel="prefetch" href="/assets/js/164.d358ee7b.js"><link rel="prefetch" href="/assets/js/165.60d778eb.js"><link rel="prefetch" href="/assets/js/166.54d7340a.js"><link rel="prefetch" href="/assets/js/167.5fd6aaa3.js"><link rel="prefetch" href="/assets/js/168.205929f8.js"><link rel="prefetch" href="/assets/js/169.873b90b1.js"><link rel="prefetch" href="/assets/js/17.72e8ffa6.js"><link rel="prefetch" href="/assets/js/170.68c49359.js"><link rel="prefetch" href="/assets/js/171.d8f93304.js"><link rel="prefetch" href="/assets/js/172.6b496cc7.js"><link rel="prefetch" href="/assets/js/173.f276a0ce.js"><link rel="prefetch" href="/assets/js/174.09cb41e2.js"><link rel="prefetch" href="/assets/js/175.c77ce8d9.js"><link rel="prefetch" href="/assets/js/176.01ab9f3f.js"><link rel="prefetch" href="/assets/js/177.2f91a2a4.js"><link rel="prefetch" href="/assets/js/178.5f0a0527.js"><link rel="prefetch" href="/assets/js/179.0d14e948.js"><link rel="prefetch" href="/assets/js/18.8264b169.js"><link rel="prefetch" href="/assets/js/180.9a15f295.js"><link rel="prefetch" href="/assets/js/181.d5bcbada.js"><link rel="prefetch" href="/assets/js/182.571b87a8.js"><link rel="prefetch" href="/assets/js/183.b87f5a38.js"><link rel="prefetch" href="/assets/js/184.90ecbd35.js"><link rel="prefetch" href="/assets/js/185.3a38f733.js"><link rel="prefetch" href="/assets/js/186.881a0fab.js"><link rel="prefetch" href="/assets/js/187.17663dea.js"><link rel="prefetch" href="/assets/js/188.471fcd9b.js"><link rel="prefetch" href="/assets/js/189.6d486653.js"><link rel="prefetch" href="/assets/js/19.e6227b20.js"><link rel="prefetch" href="/assets/js/190.357b4cc8.js"><link rel="prefetch" href="/assets/js/191.ccf9ae83.js"><link rel="prefetch" href="/assets/js/192.3ee45cf5.js"><link rel="prefetch" href="/assets/js/193.2fbcbc68.js"><link rel="prefetch" href="/assets/js/194.61d0acd9.js"><link rel="prefetch" href="/assets/js/195.33b772c3.js"><link rel="prefetch" href="/assets/js/196.7d35848a.js"><link rel="prefetch" href="/assets/js/197.4b958d27.js"><link rel="prefetch" href="/assets/js/198.dfbfba98.js"><link rel="prefetch" href="/assets/js/199.f6c7aacb.js"><link rel="prefetch" href="/assets/js/20.65ad9b00.js"><link rel="prefetch" href="/assets/js/200.6a05302e.js"><link rel="prefetch" href="/assets/js/201.be446c97.js"><link rel="prefetch" href="/assets/js/202.d058ca1d.js"><link rel="prefetch" href="/assets/js/203.ef2b609c.js"><link rel="prefetch" href="/assets/js/204.dab38ee5.js"><link rel="prefetch" href="/assets/js/21.300f7dfb.js"><link rel="prefetch" href="/assets/js/22.0ed457bc.js"><link rel="prefetch" href="/assets/js/23.9cf0f43d.js"><link rel="prefetch" href="/assets/js/24.f151ffcb.js"><link rel="prefetch" href="/assets/js/25.680a763b.js"><link rel="prefetch" href="/assets/js/26.6a5f804d.js"><link rel="prefetch" href="/assets/js/28.acbefbd1.js"><link rel="prefetch" href="/assets/js/29.fbd2340a.js"><link rel="prefetch" href="/assets/js/3.753236a7.js"><link rel="prefetch" href="/assets/js/30.30b44255.js"><link rel="prefetch" href="/assets/js/31.510d262b.js"><link rel="prefetch" href="/assets/js/32.c204bc79.js"><link rel="prefetch" href="/assets/js/33.5fa66039.js"><link rel="prefetch" href="/assets/js/34.6db47b26.js"><link rel="prefetch" href="/assets/js/35.fcb88dd5.js"><link rel="prefetch" href="/assets/js/36.e294e99d.js"><link rel="prefetch" href="/assets/js/37.fe541556.js"><link rel="prefetch" href="/assets/js/38.94af8189.js"><link rel="prefetch" href="/assets/js/39.e7017f9b.js"><link rel="prefetch" href="/assets/js/4.1c3159e6.js"><link rel="prefetch" href="/assets/js/40.b7a1deeb.js"><link rel="prefetch" href="/assets/js/41.ae4d7d1e.js"><link rel="prefetch" href="/assets/js/42.5dc5c7f6.js"><link rel="prefetch" href="/assets/js/43.73610732.js"><link rel="prefetch" href="/assets/js/44.2b0e19f3.js"><link rel="prefetch" href="/assets/js/45.903efdc0.js"><link rel="prefetch" href="/assets/js/46.0684656f.js"><link rel="prefetch" href="/assets/js/47.6425b35e.js"><link rel="prefetch" href="/assets/js/48.43663ba9.js"><link rel="prefetch" href="/assets/js/49.34841bc0.js"><link rel="prefetch" href="/assets/js/5.d3774f5f.js"><link rel="prefetch" href="/assets/js/50.48ce1d7e.js"><link rel="prefetch" href="/assets/js/51.1820aa29.js"><link rel="prefetch" href="/assets/js/52.5317c537.js"><link rel="prefetch" href="/assets/js/53.71b86df9.js"><link rel="prefetch" href="/assets/js/54.31ed2a5e.js"><link rel="prefetch" href="/assets/js/55.4f9933ab.js"><link rel="prefetch" href="/assets/js/56.beb74e07.js"><link rel="prefetch" href="/assets/js/57.705bc19e.js"><link rel="prefetch" href="/assets/js/58.f5fd656b.js"><link rel="prefetch" href="/assets/js/59.cc8ae217.js"><link rel="prefetch" href="/assets/js/6.f082ca37.js"><link rel="prefetch" href="/assets/js/60.fc3cf484.js"><link rel="prefetch" href="/assets/js/61.b5032b43.js"><link rel="prefetch" href="/assets/js/62.64d7637a.js"><link rel="prefetch" href="/assets/js/63.2a71075b.js"><link rel="prefetch" href="/assets/js/64.21eb4820.js"><link rel="prefetch" href="/assets/js/65.11535a8c.js"><link rel="prefetch" href="/assets/js/66.d9c62638.js"><link rel="prefetch" href="/assets/js/67.5782c958.js"><link rel="prefetch" href="/assets/js/68.35886dae.js"><link rel="prefetch" href="/assets/js/69.934aa057.js"><link rel="prefetch" href="/assets/js/7.9a79fd87.js"><link rel="prefetch" href="/assets/js/70.53c7c7a2.js"><link rel="prefetch" href="/assets/js/71.0e82b1c6.js"><link rel="prefetch" href="/assets/js/72.1da0eaf9.js"><link rel="prefetch" href="/assets/js/73.3dabc9cd.js"><link rel="prefetch" href="/assets/js/74.b2ae43f6.js"><link rel="prefetch" href="/assets/js/75.55bf2044.js"><link rel="prefetch" href="/assets/js/76.2f88e50b.js"><link rel="prefetch" href="/assets/js/77.d916e87e.js"><link rel="prefetch" href="/assets/js/78.0e80a77d.js"><link rel="prefetch" href="/assets/js/79.03bce65e.js"><link rel="prefetch" href="/assets/js/8.60d5a8a9.js"><link rel="prefetch" href="/assets/js/80.96678f59.js"><link rel="prefetch" href="/assets/js/81.75ffa4d3.js"><link rel="prefetch" href="/assets/js/82.41c1aeb7.js"><link rel="prefetch" href="/assets/js/83.16d5e455.js"><link rel="prefetch" href="/assets/js/84.195ca01f.js"><link rel="prefetch" href="/assets/js/85.d850d4dd.js"><link rel="prefetch" href="/assets/js/86.32d87d56.js"><link rel="prefetch" href="/assets/js/87.5f97a4f6.js"><link rel="prefetch" href="/assets/js/88.f5b0bbdb.js"><link rel="prefetch" href="/assets/js/89.9f9150f5.js"><link rel="prefetch" href="/assets/js/9.74db15a0.js"><link rel="prefetch" href="/assets/js/90.f69286ce.js"><link rel="prefetch" href="/assets/js/91.c9995055.js"><link rel="prefetch" href="/assets/js/92.e992da4f.js"><link rel="prefetch" href="/assets/js/93.14137340.js"><link rel="prefetch" href="/assets/js/94.c8228a63.js"><link rel="prefetch" href="/assets/js/95.bbb7ce03.js"><link rel="prefetch" href="/assets/js/96.ce87793d.js"><link rel="prefetch" href="/assets/js/97.4fdd8a0b.js"><link rel="prefetch" href="/assets/js/98.74cfc635.js"><link rel="prefetch" href="/assets/js/99.abdd1b46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.659f981c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yan's Blog Home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html &amp; CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Frontend/React/" class="sidebar-link">React</a></li><li><a href="/Frontend/React/ReactStart.html" class="sidebar-link">React 项目搭建</a></li><li><a href="/Frontend/React/ReactBasic.html" class="active sidebar-link">React 教程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-是什么" class="sidebar-link">React 是什么</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-组件" class="sidebar-link">React 组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#类组件-class-components" class="sidebar-link">类组件(class components)</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#函数组件-simple-components" class="sidebar-link">函数组件(Simple Components)</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#props-state" class="sidebar-link">Props &amp; State</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#state-与-props-区别" class="sidebar-link">State 与 Props 区别</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#props" class="sidebar-link">Props</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#state" class="sidebar-link">State</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#组件间通信" class="sidebar-link">组件间通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#父组件向子组件通信" class="sidebar-link">父组件向子组件通信</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#子组件向父组件通信" class="sidebar-link">子组件向父组件通信</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#跨级组件通信" class="sidebar-link">跨级组件通信</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#改变-context-对象" class="sidebar-link">改变 context 对象</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#非嵌套组件间通信" class="sidebar-link">非嵌套组件间通信</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-生命周期" class="sidebar-link">React 生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-v16-0前的生命周期" class="sidebar-link">React v16.0前的生命周期</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-v16-4-的生命周期" class="sidebar-link">React v16.4+ 的生命周期</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-diff算法" class="sidebar-link">React Diff算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#传统diff算法" class="sidebar-link">传统Diff算法</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-15的diff算法" class="sidebar-link">React 15的Diff算法</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-16的diff算法" class="sidebar-link">React 16的Diff算法</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#react-router路由" class="sidebar-link">React Router路由</a></li><li class="sidebar-sub-header"><a href="/Frontend/React/ReactBasic.html#redux" class="sidebar-link">Redux</a></li></ul></li><li><a href="/Frontend/React/ReactCase.html" class="sidebar-link">React 实例</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>uni-app</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React Native</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/index/" class="sidebar-link">&lt; 首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-教程"><a href="#react-教程" class="header-anchor">#</a> React 教程</h1> <div class="custom-block tip"><p class="custom-block-title">转载、参考</p> <ul><li><a href="https://www.taniarascia.com/getting-started-with-react/" target="_self" rel="noopener noreferrer">https://www.taniarascia.com/getting-started-with-react/</a></li> <li><a href="https://react.docschina.org/" target="_self" rel="noopener noreferrer">https://react.docschina.org</a></li> <li><a href="https://github.com/bailicangdu/react-pxq" target="_self" rel="noopener noreferrer">https://github.com/bailicangdu/react-pxq</a></li> <li><a href="https://blog.csdn.net/b954960630/article/details/79822639" target="_self" rel="noopener noreferrer">https://blog.csdn.net/b954960630/article/details/79822639</a></li> <li>...</li></ul></div> <h2 id="react-是什么"><a href="#react-是什么" class="header-anchor">#</a> React 是什么</h2> <ul><li>React 是一个声明式，高效且灵活的用于构建用户界面的 JavaScript 库。</li> <li>React 不是一个框架 (unlike Angular, which is more opinionated)</li> <li>React is used to build user interfaces (UI) on the front end</li> <li>React is the <strong>view</strong> layer of an MVC application (Model View Controller)</li></ul> <h2 id="react-组件"><a href="#react-组件" class="header-anchor">#</a> React 组件</h2> <p>有一个重要的点是，使用 React 可以将一些简短、独立的代码片段组合成复杂的 UI 界面，这些代码片段被称作“组件”。React 中拥有多种不同类型的组件，我们先从 <code>React.Component</code> 的子类开始介绍：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">ShoppingList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>shopping-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Shopping List for </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Instagram</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">WhatsApp</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Oculus</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用法示例: &lt;ShoppingList name=&quot;Mark&quot; /&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>我们马上会讨论这些又奇怪、又像 XML 的标签。我们通过使用组件来告诉 React 我们希望在屏幕上看到什么。当数据发生改变时，React 会高效地更新并重新渲染我们的组件。<br>其中，ShoppingList 是一个 <strong>React 组件类</strong>，或者说是一个 <strong>React 组件类型</strong>。一个组件接收一些参数，我们把这些参数叫做 <code>props</code>（“props” 是 “properties” 简写），然后通过 <code>render</code> 方法返回需要展示在屏幕上的视图的层次结构。<br><code>render</code> 方法的返回值<em>描述</em>了你希望在屏幕上看到的内容。React 根据描述，然后把结果展示出来。更具体地来说，<code>render</code> 返回了一个 <strong>React 元素</strong>，这是一种对渲染内容的轻量级描述。大多数的 React 开发者使用了一种名为 “JSX” 的特殊语法，JSX 可以让你更轻松地书写这些结构。语法 <code>&lt;div /&gt;</code> 会被编译成 <code>React.createElement('div')</code>。上述的代码等同于：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>className<span class="token punctuation">:</span> <span class="token string">'shopping-list'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token comment">/* ... h1 children ... */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token comment">/* ... ul children ... */</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><br> <p>Almost everything in React consists of components, which can be <strong>class components</strong> or <strong>simple components</strong>.</p> <blockquote style="color:orange;border-left:0.2rem solid orange;padding:0.25rem 0 0.25rem 1rem;margin:1rem 0;line-height:1.7;">
React元素构成组件，组件又构成应用。<br>
React核心思想是组件化，其中 组件 通过属性(props) 和 状态(state)传递数据。
</blockquote> <h3 id="类组件-class-components"><a href="#类组件-class-components" class="header-anchor">#</a> 类组件(<strong>class components</strong>)</h3> <p>Let's create another component. We're going to create a table. Make <code>Table.js</code>, and fill it with the following data.</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Job</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Charlie</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Janitor</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Mac</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Bouncer</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Dee</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Aspiring actress</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Dennis</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Bartender</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Table
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>This component we created is a custom class component. We capitalize custom components to differentiate them from regular HTML elements. Back in <code>App.js</code>, we can load in the Table, first by importing it in, and Then by loading it into the <code>render()</code> of <code>App</code>, where before we had &quot;Hello, React!&quot;. I also changed the class of the outer container.</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>Component<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Table <span class="token keyword">from</span> <span class="token string">'./Table'</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Table</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="函数组件-simple-components"><a href="#函数组件-simple-components" class="header-anchor">#</a> 函数组件(Simple Components)</h3> <p>The other type of component in React is the <strong>simple component</strong>, which is a <strong>function</strong>. This component doesn't use the <code>class</code> keyword. Let's take our <code>Table</code> and make two simple components for it - a table header, and a table body. (We're going to use ES6 arrow functions to create these simple components. First, the table header.)</p> <blockquote><p>before ES6, we can define fuction as example:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Welcome</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">TableHeader</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Job</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">TableBody</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Charlie</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Janitor</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Mac</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Bouncer</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Dee</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Aspiring actress</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Dennis</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Bartender</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Now our <code>Table</code> file will look like this. Note that the <code>TableHeader</code> and <code>TableBody</code> components are all in the same file, and being used by the <code>Table</code> class component.</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token function-variable function">TableHeader</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">TableBody</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Table</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TableHeader</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TableBody</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Everything should appear as it did before. As you can see, components can be nested in other components, and simple and class components can be mixed.</p> <blockquote><p>A class component must include <code>render()</code>, and the <code>return</code> can only return one parent element.</p></blockquote> <h2 id="props-state"><a href="#props-state" class="header-anchor">#</a> Props &amp; State</h2> <h3 id="state-与-props-区别"><a href="#state-与-props-区别" class="header-anchor">#</a> State 与 Props 区别</h3> <p><code>props 是组件对外的接口，state 是组件对内的接口</code>。组件内可以引用其他组件，组件之间的引用形成了一个树状结构（组件树），如果下层组件需要使用上层组件的数据或方法，上层组件就可以通过下层组件的props属性进行传递，因此props是组件对外的接口。组件除了使用上层组件传递的数据外，自身也可能需要维护管理数据，这就是组件对内的接口state。根据对外接口props 和对内接口state，组件计算出对应界面的UI。</p> <p><strong><code>主要区别</code></strong>：</p> <ul><li>State是可变的，是一组用于反映组件UI变化的状态集合；</li> <li>而Props对于使用它的组件来说，是只读的，要想修改Props，只能通过该组件的父组件修改。
在组件状态上移的场景中，父组件正是通过子组件的Props, 传递给子组件其所需要的状态。</li></ul> <h3 id="props"><a href="#props" class="header-anchor">#</a> Props</h3> <p>当一个组件被注入一些属性（Props ）值时，属性值来源于它的父级元素，所以人们常说，属性在 React 中是单向流动的：从父级到子元素。</p> <h4 id="▎1、props-属性-默认为-“true”"><a href="#▎1、props-属性-默认为-“true”" class="header-anchor">#</a> ▎1、props(属性) 默认为 “true”</h4> <p>如果你没给 prop(属性) 传值，那么他默认为 true 。下面两个 JSX 表达式是等价的：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyTextBox</span></span> <span class="token attr-name">autocomplete</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyTextBox</span></span> <span class="token attr-name">autocomplete</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通常情况下，我们不建议使用这种类型，因为这会与ES6中的对象shorthand混淆 。ES6 shorthand 中 {foo} 指的是 {foo: foo} 的简写，而不是 {foo: true} 。这种行为只是为了与 HTML 的行为相匹配。<br>
(举个例子，在 HTML 中，&lt; input type=“radio” value=“1” disabled /&gt; 与 &lt; input type=“radio” value=“1” disabled=“true” /&gt; 是等价的。JSX 中的这种行为就是为了匹配 HTML 的行为。)</p> <h4 id="▎2、props扩展"><a href="#▎2、props扩展" class="header-anchor">#</a> ▎<strong>2、props扩展</strong></h4> <p>如果你已经有一个 object 类型的 props，并且希望在 JSX 中传入，你可以使用扩展操作符 … 传入整个 props 对象。这两个组件是等效的：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">function</span> <span class="token function">App1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token attr-name">firstName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Ben<span class="token punctuation">&quot;</span></span> <span class="token attr-name">lastName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Hector<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">App2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>firstName<span class="token punctuation">:</span> <span class="token string">'Ben'</span><span class="token punctuation">,</span> lastName<span class="token punctuation">:</span> <span class="token string">'Hector'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>显然下面的方法更方便：<code>因为它将数据进行了包装，而且还简化了赋值的书写</code></p> <h3 id="state"><a href="#state" class="header-anchor">#</a> State</h3> <h4 id="▎state是什么？"><a href="#▎state是什么？" class="header-anchor">#</a> ▎State是什么？</h4> <p>React 的<code>核心思想是组件化</code>，而组件中最重要的概念是State（状态），State是一个组件的UI数据模型，是组件渲染时的数据依据。<br>状态（state） 和 属性（props） 类似，都是一个组件所需要的一些数据集合，但是state是私有的，可以认为state是组件的“私有属性（或者是局部属性）”。</p> <h4 id="▎如何判断是否为state-？"><a href="#▎如何判断是否为state-？" class="header-anchor">#</a> ▎<strong>如何判断是否为State ？</strong></h4> <p>组件中用到的一个变量是不是应该作为组件State，可以通过下面的4条依据进行判断：</p> <ul><li>这个变量是否是通过Props从父组件中获取？如果是，那么它不是一个状态。</li> <li>这个变量是否在组件的整个生命周期中都保持不变？如果是，那么它不是一个状态。</li> <li>这个变量是否可以通过其他状态（State）或者属性(Props)计算得到？如果是，那么它不是一个状态。</li> <li>这个变量是否在组件的render方法中使用？如果<strong>不是</strong>，那么它不是一个状态。这种情况下，这个变量更适合定义为组件的一个普通属性，例如组件中用到的定时器，就应该直接定义为this.timer，而不是this.state.timer。</li></ul> <blockquote><p><code>并不是组件中用到的所有变量都是组件的状态！</code>当存在多个组件共同依赖一个状态时，一般的做法是状态上移，将这个状态放到这几个组件的公共父组件中。</p></blockquote> <h4 id="▎如何正确使用-state"><a href="#▎如何正确使用-state" class="header-anchor">#</a> ▎如何正确使用 State</h4> <p><strong>1、用setState 修改State</strong></p> <p>直接修改state，组件并不会重新触发render()</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 错误</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>comment <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>正确的修改方式是使用setState()</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 正确</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>comment<span class="token punctuation">:</span> <span class="token string">'Hello'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>2、State 的更新是异步的</strong></p> <ul><li>调用setState后，setState会把要修改的状态放入一个队列中（因而 组件的state并不会立即改变）；</li> <li>之后React 会优化真正的执行时机，来优化性能，所以优化过程中有可能会将多个 setState 的状态修改合并为一次状态修改，因而state更新可能是异步的。</li> <li>所以不要依赖当前的State，计算下个State。当真正执行状态修改时，依赖的this.state并不能保证是最新的State，因为React会把多次State的修改合并成一次，这时，this.state将还是这几次State修改前的State。<br>
另外需要注意的事，同样不能依赖当前的Props计算下个状态，因为Props一般也是从父组件的State中获取，依然无法确定在组件状态更新时的值。</li></ul> <p><strong><code>综上所述：</code></strong><br><font color="#b30000">this.props 和 this.state 可能是异步更新的，你不能依赖他们的值计算下一个state(状态)</font></p> <p><strong>例</strong>：这样 counter(计数器)会更新失败</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 错误</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>increment<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>要弥补这个问题，使用 setState() 的另一种形式，它接受一个函数而不是一个对象。这个函数有两个参数：<br>
（1）第一个参数: 是当前最新状态的前一个状态（本次组件状态修改前的状态）<br>
（2）第二个参数：是当前最新的属性props</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 正确</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token punctuation">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> props<span class="token punctuation">.</span>increment
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//注意：下面这样是错的</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">//没将{}用()括起来，所以会解析成代码块</span>
  counter<span class="token punctuation">:</span> prevState<span class="token punctuation">.</span>counter <span class="token operator">+</span> props<span class="token punctuation">.</span>increment
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果你还不懂没关系，看下面例子：我们现在渲染出一个button，想每点击一下，counter就+3 <br>
看下面代码：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> counter <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token comment">//或者 const counter = this.state.counter;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        counter is: </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">点我</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>counter is: 0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>每点击一下，加+1，并不是+3</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>counter is: 1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>之所以+1,不是+3，是因为 state 的更新可能是异步的，React 会把传入多个 setState的多个 Object “batch” 起来合并成一个。<code>合并成一个就相当于把传入 setState 的多个 Object 进行 shallow merge</code>,像这样：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">const</span> update <span class="token operator">=</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
    counter<span class="token punctuation">:</span> counter <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment">//因为上面三句话都一样，所以会当一句话执行</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我们可以这么做就会成功：看下面</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    counter<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> prev<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> prev<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> counter<span class="token punctuation">:</span> prev<span class="token punctuation">.</span>counter <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//这样是错的 this.setState(prev =&gt; {counter: prev.counter + 1});</span>
    <span class="token comment">//这样是错的 this.setState(prev =&gt; {counter:++prev.counter});</span>
    <span class="token comment">//这样是错的 this.setState(prev =&gt; {counter:prev.counter++});</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        counter is: </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>counter<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">点我</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>之所以成功是因为：<code>传入多个 setState 的多个 Object 会被 shallow Merge，而传入多个 setState 的多个 function 会被 &quot;queue&quot; 起来，queue 里的 function 接收到的 state(上面是 prev )都是前一个 function 操作过的 state。</code></p> <p><strong>3、State更新会被合并</strong></p> <p>官方文档看不懂不要紧，直接举个例子你就懂了。例如一个组件的状态为：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  title <span class="token punctuation">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>
  content <span class="token punctuation">:</span> <span class="token string">'React is an wonderful JS library!'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当只需要修改状态title时，只需要将修改后的title传给setState</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">'Reactjs'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>React会合并新的title到原来的组件状态中，同时保留原有的状态content，合并后的State为：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
  title <span class="token punctuation">:</span> <span class="token string">'Reactjs'</span><span class="token punctuation">,</span>
  content <span class="token punctuation">:</span> <span class="token string">'React is an wonderful JS library!'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>4、setState里顺序更新</strong></p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">//history 为数组</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       history<span class="token punctuation">:</span> history<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">//(1)</span>
       current<span class="token punctuation">:</span> history<span class="token punctuation">.</span>length<span class="token punctuation">,</span>       <span class="token comment">//(2)</span>
       nextPlayer<span class="token punctuation">:</span> <span class="token operator">!</span>nextPlayer<span class="token punctuation">,</span>       <span class="token comment">//(3)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>执行setState时：先更新history，然后<code>再用更新改变后的history计算current的值</code>，最后再更新nextPlayer</p> <h4 id="▎根据state类型更新"><a href="#▎根据state类型更新" class="header-anchor">#</a> ▎根据State类型更新</h4> <p>当状态发生变化时，如何创建新的状态？根据状态的类型，可以分成三种情况：</p> <p><strong>1、 状态的类型是不可变类型（数字，字符串，布尔值，null， undefined）</strong></p> <p>这种情况最简单，直接给要修改的状态赋一个新值即可</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">//原state</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  title <span class="token punctuation">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>
  success<span class="token punctuation">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token comment">//改变state</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> <span class="token string">'bty'</span><span class="token punctuation">,</span>
  success<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>2、 状态的类型是数组</strong></p> <p><code>数组是一个引用，React 执行 diff 算法时比较的是两个引用，而不是引用的对象。所以直接修改原对象，引用值不发生改变的话，React 不会重新渲染。因此，修改状态的数组或对象时，要返回一个新的数组或对象。</code><br>
（1）增加 <br>
如有一个数组类型的状态books，当向books中增加一本书(chinese)时，使用数组的concat方法或ES6的数组扩展语法</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 方法一：将state先赋值给另外的变量，然后使用concat创建新数组</span>
<span class="token keyword">let</span> books <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>books<span class="token punctuation">;</span> 
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> books<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'chinese'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 方法二：使用preState、concat创建新数组</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">preState</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> preState<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'chinese'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 方法三：ES6 spread syntax</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">preState</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>preState<span class="token punctuation">.</span>books<span class="token punctuation">,</span> <span class="token string">'chinese'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>（2）截取 <br>
当从books中截取部分元素作为新状态时，使用数组的slice方法：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 方法一：将state先赋值给另外的变量，然后使用slice创建新数组</span>
<span class="token keyword">let</span> books <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>books<span class="token punctuation">;</span> 
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> books<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// </span>
<span class="token comment">// 方法二：使用preState、slice创建新数组</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">preState</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> preState<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>（3）条件过滤 <br>
当从books中过滤部分元素后，作为新状态时，使用数组的filter方法：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 方法一：将state先赋值给另外的变量，然后使用filter创建新数组</span>
<span class="token keyword">var</span> books <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>books<span class="token punctuation">;</span> 
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> books<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item <span class="token operator">!=</span> <span class="token string">'React'</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 方法二：使用preState、filter创建新数组</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">preState</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  books<span class="token punctuation">:</span> preState<span class="token punctuation">.</span>books<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item <span class="token operator">!=</span> <span class="token string">'React'</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>注意：不要使用push、pop、shift、unshift、splice等方法修改数组类型的状态，因为这些方法都是在原数组的基础上修改，而concat、slice、filter会返回一个新的数组。</p></blockquote> <p><strong>3、状态的类型是普通对象（不包含字符串、数组）</strong></p> <p><code>对象是一个引用，React 执行 diff 算法时比较的是两个引用，而不是引用的对象。所以直接修改原对象，引用值不发生改变的话，React 不会重新渲染。因此，修改状态的数组或对象时，要返回一个新的对象。</code></p> <p>使用ES6 的Object.assgin方法</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 方法一：将state先赋值给另外的变量，然后使用Object.assign创建新对象</span>
<span class="token keyword">var</span> owner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>owner<span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  owner<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> owner<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Jason'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 方法二：使用preState、Object.assign创建新对象</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">preState</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  owner<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> preState<span class="token punctuation">.</span>owner<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">'Jason'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用对象扩展语法（object spread properties）</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 方法一：将state先赋值给另外的变量，然后使用对象扩展语法创建新对象</span>
<span class="token keyword">var</span> owner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>owner<span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  owner<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span>owner<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Jason'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 方法二：使用preState、对象扩展语法创建新对象</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">preState</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  owner<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token operator">...</span>preState<span class="token punctuation">.</span>owner<span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'Jason'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong><code>综上所述</code></strong>：<br>
创建新的状态对象的关键是，<code>避免使用会直接修改原对象的方法，而是使用可以返回一个新对象的方法。</code></p> <h4 id="▎state向下流动"><a href="#▎state向下流动" class="header-anchor">#</a> ▎State向下流动</h4> <p>我们说 props 是组件对外的接口，state 是组件对内的接口。<br>
一个组件可以选择将 state(状态) 向下传递，作为其子组件的 props(属性)：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponent</span></span> <span class="token attr-name">title</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>title<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这通常称为一个“从上到下”，或者“单向”的数据流。任何 state(状态) 始终由某个特定组件所有，并且从该 state(状态) 导出的任何数据 或 UI 只能影响树中 “下方” 的组件。</p> <p>如果把组件树想像为 props(属性) 的瀑布，所有组件的 state(状态) 就如同一个额外的水源汇入主流，且只能随着主流的方向向下流动。</p> <h2 id="组件间通信"><a href="#组件间通信" class="header-anchor">#</a> 组件间通信</h2> <div class="custom-block tip"><p class="custom-block-title">转载</p> <ul><li><a href="https://www.jianshu.com/p/fb915d9c99c4" target="_self" rel="noopener noreferrer">https://www.jianshu.com/p/fb915d9c99c4</a></li></ul></div> <p>组件间通信大体有下面几种情况：</p> <ul><li>父组件向子组件通信</li> <li>子组件向父组件通信</li> <li>跨级组件之间通信</li> <li>非嵌套组件间通信</li></ul> <h3 id="父组件向子组件通信"><a href="#父组件向子组件通信" class="header-anchor">#</a> 父组件向子组件通信</h3> <p>这是最简单也是最常用的一种通信方式：父组件通过向子组件传递 props，子组件得到 props 后进行相应的处理。下面是演示代码：</p> <p>父组件 App.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Sub <span class="token keyword">from</span> <span class="token string">&quot;./SubComponent.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                &lt;Sub title = &quot;今年过节不收礼&quot; /&gt;
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>子组件 SubComponent.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span> props<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Sub<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="子组件向父组件通信"><a href="#子组件向父组件通信" class="header-anchor">#</a> 子组件向父组件通信</h3> <p>利用回调函数，可以实现子组件向父组件通信：父组件将一个函数作为 props 传递给子组件，子组件调用该回调函数，便可以向父组件通信。下面是演示代码：</p> <p>SubComponent.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            props<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            &lt;button onClick = </span><span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">&quot;我们通信把&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">&gt;点击我</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Sub<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>App.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Sub <span class="token keyword">from</span> <span class="token string">&quot;./SubComponent.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                &lt;Sub callback = </span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text"> /&gt;
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="跨级组件通信"><a href="#跨级组件通信" class="header-anchor">#</a> 跨级组件通信</h3> <p>所谓跨级组件通信，就是父组件向子组件的子组件通信，向更深层的子组件通信。跨级组件通信可以采用下面两种方式：</p> <ul><li>中间组件层层传递 props</li> <li>使用 context 对象</li></ul> <p>对于第一种方式，如果父组件结构较深，那么中间的每一层组件都要去传递 props，增加了复杂度，并且这些  props 并不是这些中间组件自己所需要的。不过这种方式也是可行的，当组件层次在三层以内可以采用这种方式，当组件嵌套过深时，采用这种方式就需要斟酌了。</p> <p>使用 context 是另一种可行的方式，context 相当于一个全局变量，是一个大容器，我们可以把要通信的内容放在这个容器中，这样一来，不管嵌套有多深，都可以随意取用。使用 context 也很简单，需要满足两个条件：</p> <ul><li>上级组件要声明自己支持 context，并提供一个函数来返回相应的 context 对象</li> <li>子组件要声明自己需要使用 context</li></ul> <p>下面以代码说明，我们新建 3 个文件：父组件 App.js，子组件 Sub.js，子组件的子组件 SubSub.js。</p> <p>App.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">&quot;prop-types&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Sub <span class="token keyword">from</span> <span class="token string">&quot;./Sub&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token comment">// 父组件声明自己支持 context</span>
    <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
        color<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
        callback<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 父组件提供一个函数，用来返回相应的 context 对象</span>
    <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>
            callback<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Sub</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Sub</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Sub.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SubSub <span class="token keyword">from</span> <span class="token string">&quot;./SubSub&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SubSub</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Sub<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>SubSub.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">&quot;prop-types&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SubSub</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token comment">// 子组件声明自己需要使用 context</span>
    <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
        color<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
        callback<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>color <span class="token punctuation">}</span>
        <span class="token keyword">const</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div style <span class="token operator">=</span> <span class="token punctuation">{</span> style <span class="token punctuation">}</span><span class="token operator">&gt;</span>
                <span class="token constant">SUBSUB</span>
                <span class="token operator">&lt;</span>button onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">&quot;我胡汉三又回来了！&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>如果是父组件向子组件单向通信，可以使用变量，如果子组件想向父组件通信，同样可以由父组件提供一个回调函数，供子组件调用，回传参数。在使用 context 时，有两点需要注意：</p> <ul><li>父组件需要声明自己支持 context，并提供 context 中属性的 PropTypes</li> <li>子组件需要声明自己需要使用 context，并提供其需要使用的 context 属性的 PropTypes</li> <li>父组件需提供一个 getChildContext 函数，以返回一个初始的 context 对象</li></ul> <p><strong>如果组件中使用构造函数（constructor），还需要在构造函数中传入第二个参数 context，并在 super 调用父类构造函数是传入 context，否则会造成组件中无法使用 context</strong>。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">...</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="改变-context-对象"><a href="#改变-context-对象" class="header-anchor">#</a> 改变 context 对象</h3> <p>我们不应该也不能直接改变 context 对象中的属性，要想改变 context 对象，<strong>只有让其和父组件的 state 或者 props 进行关联，在父组件的 state 或 props 变化时，会自动调用 getChildContext 方法，返回新的 context 对象</strong>，而后子组件进行相应的渲染。修改 App.js，让 context 对象可变：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">&quot;prop-types&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Sub <span class="token keyword">from</span> <span class="token string">&quot;./Sub&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            color<span class="token punctuation">:</span><span class="token string">&quot;red&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 父组件声明自己支持 context</span>
    <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
        color<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
        callback<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 父组件提供一个函数，用来返回相应的 context 对象</span>
    <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">{</span>
            color<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>color<span class="token punctuation">,</span>
            callback<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 在此回调中修改父组件的 state</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            color<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Sub</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Sub</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>此时，在子组件的 cb 方法中，传入相应的颜色参数，就可以改变 context 对象了，进而影响到子组件：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token operator">...</span>
<span class="token keyword">return</span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style <span class="token operator">=</span> <span class="token punctuation">{</span> style <span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token constant">SUBSUB</span>
        <span class="token operator">&lt;</span>button onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>context 同样可以应在无状态组件上，只需将 context 作为第二个参数传入：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">&quot;prop-types&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">SubSub</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">{</span> color<span class="token punctuation">:</span>context<span class="token punctuation">.</span>color <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div style <span class="token operator">=</span> <span class="token punctuation">{</span> style <span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token constant">SUBSUB</span>
            <span class="token operator">&lt;</span>button onClick <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">&quot;我胡汉三又回来了！&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span>点击我<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

SubSub<span class="token punctuation">.</span>contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    color<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>
    callback<span class="token punctuation">:</span>PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> SubSub<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="非嵌套组件间通信"><a href="#非嵌套组件间通信" class="header-anchor">#</a> 非嵌套组件间通信</h3> <p>非嵌套组件，就是没有任何包含关系的组件，包括兄弟组件以及不在同一个父级中的非兄弟组件。对于非嵌套组件，可以采用下面两种方式：</p> <ul><li>利用二者共同父组件的 context 对象进行通信</li> <li>使用自定义事件的方式</li></ul> <p>如果采用组件间共同的父级来进行中转，会增加子组件和父组件之间的耦合度，如果组件层次较深的话，找到二者公共的父组件不是一件容易的事，当然还是那句话，也不是不可以...</p> <p>这里我们采用自定义事件的方式来实现非嵌套组件间的通信。我们需要使用一个 events 包：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> events --save
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>新建一个 ev.js，引入 events 包，并向外提供一个事件对象，供通信时使用：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;events&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>App.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&quot;./Foo&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Boo <span class="token keyword">from</span> <span class="token string">&quot;./Boo&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Foo</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Boo</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Foo.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">&quot;./ev&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            msg<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 声明一个自定义事件</span>
        <span class="token comment">// 在组件装载完成以后</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventEmitter <span class="token operator">=</span> emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;callMe&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                msg
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 组件销毁前移除事件监听</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        emitter<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventEmitter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg <span class="token punctuation">}</span><span class="token plain-text">
                我是非嵌套 1 号
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Boo.js：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">&quot;./ev&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Boo</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span><span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token function-variable function">cb</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 触发自定义事件</span>
                emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;callMe&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                我是非嵌套 2 号
                &lt;button onClick = </span><span class="token punctuation">{</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">&quot;blue&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token plain-text">&gt;点击我</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>自定义事件是典型的发布/订阅模式，通过向事件对象上添加监听器和触发事件来实现组件间通信。</p> <p>测试结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 初始值
我是非嵌套 1 号
我是非嵌套 2 号 [点击我]

// 点击button [点击我] 后的值
Hello, 我是非嵌套 1 号
我是非嵌套 2 号 [点击我]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>总结了 React 中组件的几种通信方式，分别是：</p> <ul><li>父组件向子组件通信：使用 props</li> <li>子组件向父组件通信：使用 props 回调</li> <li>跨级组件间通信：使用 context 对象</li> <li>非嵌套组件间通信：使用事件订阅</li></ul> <h2 id="react-生命周期"><a href="#react-生命周期" class="header-anchor">#</a> React 生命周期</h2> <div class="custom-block tip"><p class="custom-block-title">转载</p> <ul><li><a href="https://www.jianshu.com/p/514fe21b9914" target="_self" rel="noopener noreferrer">https://www.jianshu.com/p/514fe21b9914</a></li></ul></div> <h3 id="react-v16-0前的生命周期"><a href="#react-v16-0前的生命周期" class="header-anchor">#</a> React v16.0前的生命周期</h3> <p>其实大部分团队不见得会跟进升到16版本，所以16前的生命周期还是很有必要掌握的，何况16也是基于之前的修改</p> <div style="display:flex;"><img src="/assets/img/reactlife-1.ba8f8792.jpg" alt="" align="left" style="zoom:100%;display:block;"></div> <h4 id="第一个是组件初始化-initialization-阶段"><a href="#第一个是组件初始化-initialization-阶段" class="header-anchor">#</a> 第一个是组件初始化(initialization)阶段</h4> <p>也就是以下代码中类的构造方法( constructor() ),Test类继承了react Component这个基类，也就继承这个react的基类，才能有render(),生命周期等方法可以使用，这也说明为什么<code>函数组件不能使用这些方法</code>的原因。</p> <p><code>super(props)</code>用来调用基类的构造方法( constructor() ), 也将父组件的props注入给子组件，功子组件读取(组件中props只读不可变，state可变)。而<code>constructor()</code>用来做一些组件的初始化工作，如定义this.state的初始内容。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="第二个是组件的挂载-mounting-阶段"><a href="#第二个是组件的挂载-mounting-阶段" class="header-anchor">#</a> 第二个是组件的挂载(Mounting)阶段</h4> <p><strong>此阶段分为componentWillMount，render，componentDidMount三个时期。</strong></p> <ul><li>componentWillMount:	在组件挂载到DOM前调用，且只会被调用一次，在这边调用this.setState不会引起组件重新渲染，也可以把写在这边的内容提前到<code>constructor()</code>中，所以项目中很少用。</li> <li>render: 根据组件的props和state（无两者的重传递和重赋值，论值是否有变化，都可以引起组件重新render） ，return 一个React元素（描述组件，即UI），不负责组件实际渲染工作，之后由React自身根据此元素去渲染出页面DOM。render是纯函数（Pure function：函数的返回结果只依赖于它的参数；函数执行过程里面没有副作用），不能在里面执行<code>this.setState</code>，会有改变组件状态的副作用。</li> <li>componentDidMount: 组件挂载到DOM后调用，且只会被调用一次</li></ul> <h4 id="第三个是组件的更新-update-阶段"><a href="#第三个是组件的更新-update-阶段" class="header-anchor">#</a> 第三个是组件的更新(update)阶段</h4> <p>在讲述此阶段前需要先明确下react组件更新机制。setState引起的state更新或父组件重新render引起的props更新，更新后的state和props相对之前无论是否有变化，都将引起子组件的重新render。</p> <p><strong>造成组件更新有两类（三种）情况：</strong></p> <ul><li><p>1.父组件重新render</p> <p>父组件重新render引起子组件重新render的情况有两种</p> <p>a. 直接使用,每当父组件重新render导致的重传props，子组件将直接跟着重新渲染，无论props是否有变化。可通过<code>shouldComponentUpdate</code>方法优化。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
   <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 应该使用这个方法，否则无论props是否有变化都将会导致组件跟着重新渲染</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>someThings <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>someThings<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>someThings<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>b.在componentWillReceiveProps方法中，将props转换成自己的state</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
            someThings<span class="token punctuation">:</span> props<span class="token punctuation">.</span>someThings
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 父组件重传props时就会调用这个方法</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>someThings<span class="token punctuation">:</span> nextProps<span class="token punctuation">.</span>someThings<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>someThings<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>根据官网的描述</p> <blockquote><p>在该函数(componentWillReceiveProps)中调用 this.setState() 将不会引起第二次渲染。</p></blockquote> <p>是因为<code>componentWillReceiveProps</code>中判断<code>props</code>是否变化了，若变化了，<code>this.setState</code>将引起<code>state</code>变化，从而引起<code>render</code>，此时就没必要再做第二次因重传<code>props</code>引起的<code>render</code>了，不然重复做一样的渲染了。</p></li> <li><p>2.组件本身调用setState，无论state有没有变化。可通过<code>shouldComponentUpdate</code>方法优化。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
   <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
          someThings<span class="token punctuation">:</span><span class="token number">1</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextStates</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 应该使用这个方法，否则无论state是否有变化都将会导致组件重新渲染</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>nextStates<span class="token punctuation">.</span>someThings <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>someThings<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

   <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 虽然调用了setState ，但state并无变化</span>
        <span class="token keyword">const</span> preSomeThings <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>someThings
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            someThings<span class="token punctuation">:</span> preSomeThings
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div onClick <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>someThings<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li></ul> <p><strong>此阶段分为componentWillReceiveProps，shouldComponentUpdate，componentWillUpdate，render，componentDidUpdate</strong></p> <ul><li><p>componentWillReceiveProps(nextProps)</p> <p>此方法只调用于props引起的组件更新过程中，响应 Props 变化之后进行更新的唯一方式，参数nextProps是父组件传给当前组件的新props。但父组件render方法的调用不能保证重传给当前组件的props是有变化的，所以在此方法中根据<code>nextProps</code>和<code>this.props</code>来查明重传的props是否改变，以及如果改变了要执行啥，比如根据新的props调用this.setState出发当前组件的重新render</p></li> <li><p>shouldComponentUpdate(nextProps, nextState)</p> <p>此方法通过比较nextProps，nextState及当前组件的this.props，this.state，返回true时当前组件将继续执行更新过程，返回false则当前组件更新停止，以此可用来减少组件的不必要渲染，优化组件性能。<br>ps：这边也可以看出，就算<code>componentWillReceiveProps()</code>中执行了<code>this.setState</code>，更新了state，但在render前（如<code>shouldComponentUpdate</code>，<code>componentWillUpdate</code>），<code>this.state</code>依然指向更新前的state，不然<code>nextState</code>及当前组件的this.state的对比就一直是true了。<br>如果<code>shouldComponentUpdate</code> 返回false，那就一定不用rerender(重新渲染 )这个组件了，组件的React elements(React 元素) 也不用去比对。 但是如果<code>shouldComponentUpdate</code> 返回true，会进行组件的React elements比对，如果相同，则不用rerender这个组件，如果不同，会调用render函数进行rerender。</p></li> <li><p>componentWillUpdate(nextProps, nextState)</p> <p>此方法在调用render方法前执行，在这边可执行一些组件更新发生前的工作，一般较少用。</p></li> <li><p>render</p> <p>render方法在上文讲过，这边只是重新调用。</p></li> <li><p>componentDidUpdate(prevProps, prevState)</p> <p>此方法在组件更新后被调用，可以操作组件更新的DOM，prevProps和prevState这两个参数指的是组件更新前的props和state</p></li></ul> <h4 id="卸载阶段"><a href="#卸载阶段" class="header-anchor">#</a> 卸载阶段</h4> <p>此阶段只有一个生命周期方法：<code>componentWillUnmount</code></p> <ul><li><p>componentWillUnmount</p> <p>此方法在组件被卸载前调用，可以在这里执行一些清理工作，比如清楚组件中使用的定时器，清楚<code>componentDidMount</code>中手动创建的DOM元素等，以避免引起内存泄漏。</p></li></ul> <h3 id="react-v16-4-的生命周期"><a href="#react-v16-4-的生命周期" class="header-anchor">#</a> React v16.4+ 的生命周期</h3> <p><strong>变更缘由</strong></p> <p>原来（React v16.0前）的生命周期在React v16推出的[<strong>Fiber</strong>]之后就不合适了，因为如果要开启<code>async rendering</code>，在render函数之前的所有函数，都有可能被执行多次。</p> <p>原来（React v16.0前）的生命周期有哪些是在render前执行的呢？</p> <ul><li>componentWillMount</li> <li>componentWillReceiveProps</li> <li>shouldComponentUpdate</li> <li>componentWillUpdate</li></ul> <p>如果开发者开了async rendering，而且又在以上这些render前执行的生命周期方法做AJAX请求的话，那AJAX将被无谓地多次调用。。。明显不是我们期望的结果。而且在<code>componentWillMount</code>里发起AJAX，不管多快得到结果也赶不上首次render，而且componentWillMount在服务器端渲染也会被调用到（当然，也许这是预期的结果），这样的IO操作放在<code>componentDidMount</code>里更合适。</p> <p>禁止不能用比劝导开发者不要这样用的效果更好，所以除了<code>shouldComponentUpdate</code>，其他在render函数之前的所有函数（<code>componentWillMount</code>，<code>componentWillReceiveProps</code>，<code>componentWillUpdate</code>）都被<code>getDerivedStateFromProps</code>替代。</p> <p>也就是用一个静态函数<code>getDerivedStateFromProps</code>来取代被deprecate的几个生命周期函数，就是强制开发者在render之前只做无副作用的操作，而且能做的操作局限在根据props和state决定新的state</p> <p>React v16.0刚推出的时候，是增加了一个<code>componentDidCatch</code>生命周期函数，这只是一个增量式修改，完全不影响原有生命周期函数；但是，到了React v16.3，大改动来了，引入了两个新的生命周期函数： <code>getDerivedStateFromProps</code>，<code>getSnapshotBeforeUpdate</code></p> <h4 id="getderivedstatefromprops"><a href="#getderivedstatefromprops" class="header-anchor">#</a> getDerivedStateFromProps</h4> <p><code>getDerivedStateFromProps</code>本来（React v16.3中）是只在创建和更新（由父组件引发部分）中调用。如果不是由父组件引发，那么<code>getDerivedStateFromProps</code>也不会被调用，如自身setState引发或者forceUpdate引发。</p> <p><strong>React v16.3 的生命周期图</strong></p> <div style="display:flex;"><img src="/assets/img/reactlife-2.d18e86f6.jpg" alt="" align="left" style="zoom:100%;display:block;"></div> <p>这样的话理解起来有点乱，在React v16.4中改正了这一点，让<code>getDerivedStateFromProps</code>无论是Mounting还是Updating，也无论是因为什么引起的Updating，全部都会被调用，具体可看React v16.4 的生命周期图。</p> <h4 id="react-v16-4-的生命周期图"><a href="#react-v16-4-的生命周期图" class="header-anchor">#</a> React v16.4+ 的生命周期图</h4> <div style="display:flex;"><img src="/assets/img/reactlife-3.a5ae7cc1.jpg" alt="" align="left" style="zoom:100%;display:block;"></div> <h4 id="react-v16-4后的getderivedstatefromprops"><a href="#react-v16-4后的getderivedstatefromprops" class="header-anchor">#</a> <strong>React v16.4后的getDerivedStateFromProps</strong></h4> <p><em><strong>static getDerivedStateFromProps(props, state)</strong></em> 在组件创建时和更新时的render方法之前调用，它应该返回一个对象来更新状态，或者返回null来不更新任何内容。</p> <p><strong>注意：</strong></p> <ol><li>getDerivedStateFromProps前面要加上static保留字，声明为静态方法，不然会被react忽略掉</li> <li>getDerivedStateFromProps里面的this为undefined</li></ol> <p>static静态方法只能Class(构造函数)来调用(App.staticMethod✅)，而实例是不能的( (new App()).staticMethod ❌ )；
当调用React Class组件时，该组件会实例化；<br>所以，React Class组件中，静态方法getDerivedStateFromProps无权访问Class实例的this，即this为undefined。</p> <h4 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" class="header-anchor">#</a> getSnapshotBeforeUpdate</h4> <p><em><strong>getSnapshotBeforeUpdate()</strong></em> 被调用于render之后，可以读取但无法使用DOM的时候。它使您的组件可以在可能更改之前从DOM捕获一些信息（例如滚动位置）。此生命周期返回的任何值都将作为参数传递给<code>componentDidUpdate（）</code>。</p> <p>官网给的例子：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token keyword">class</span> <span class="token class-name">ScrollingList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>listRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//我们是否要添加新的 items 到列表?</span>
    <span class="token comment">// 捕捉滚动位置，以便我们可以稍后调整滚动.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
      <span class="token keyword">return</span> list<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> list<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果我们有snapshot值, 我们已经添加了 新的items.</span>
    <span class="token comment">// 调整滚动以至于这些新的items 不会将旧items推出视图。</span>
    <span class="token comment">// (这边的snapshot是 getSnapshotBeforeUpdate方法的返回值)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
      list<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> list<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> snapshot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>listRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token comment">/* ...contents... */</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="react-diff算法"><a href="#react-diff算法" class="header-anchor">#</a> React Diff算法</h2> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>Diff算法也在一直演进中，所以请总是查阅最新文档。</p> <br></div> <div class="custom-block tip"><p class="custom-block-title">转载、参考 - 帮助理解</p> <ul><li><a href="http://www.gaoyunjiao.fun/?p=170" target="_self" rel="noopener noreferrer">http://www.gaoyunjiao.fun/?p=170</a></li></ul></div> <p>Diff算法一直是React系统最核心的部分，并且由于演化自传统diff，使得比较方式从O(n^3)降级到O(n)，然后又改成了链表方式，所以需要查阅相关文档，了解对应版本/最新版本所使用的算法。</p> <h3 id="传统diff算法"><a href="#传统diff算法" class="header-anchor">#</a> 传统Diff算法</h3> <p>传统diff算法需要循环比较两棵树，所有节点的循环，那么单纯比较次数就是O(n^2)，n*n</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>P                         L
          A                     A  
         / \                   / \
        /   \                 /   \
       B     D     ====&gt;     D     B
      /                             \
     C                               C
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>刷刷刷，每次都需要循环遍历，于是有以下的查找过程：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PA-&gt;LA
PA-&gt;LB
PA-&gt;LC
PA-&gt;LD
PB-&gt;LA
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>除了查找过程消耗了O(n^2)之外，找到差异后还要计算最小转换方式，最终结果为O(n^3)。<br>所以，传统的diff算法的时间复杂度为O(n^3)。</p> <p>如果React运用这种算法，那么节点过多，将会有大量的开销，虽然CPU的秒速达到30亿次计算，但依旧是非常耗费性能的。</p> <p>有没有什么方式可以降低时间复杂度呢？<br>于是，React15对传统的diff做了一些限制，使得时间复杂度变为了O(n)。</p> <h3 id="react-15的diff算法"><a href="#react-15的diff算法" class="header-anchor">#</a> React 15的Diff算法</h3> <p>《深入React技术栈》这本书，给出了三种Diff策略分析，文字描述太过抽象，直接表述如下：<strong>Tree diff</strong>、<strong>Component diff</strong>、<strong>Element diff</strong></p> <h4 id="tree-diff"><a href="#tree-diff" class="header-anchor">#</a> Tree diff</h4> <p>什么是Tree diff？先上图：</p> <div style="display:flex;"><img src="data:image/png;base64,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" alt="" align="left" style="zoom:100%;display:block;"></div> <p>首先，进行同级比较，并非循环比较。这样比较次数就降为一层一次，时间复杂度直接降为O(n)。<br>如果同级相同位置节点不一样，则直接删除替换，简单粗暴。<br>而对于节点移动，同样道理，也是简单粗暴的删除重建。如下图所示（图中第四步应该是删除左侧的整棵A树）：</p> <div style="display:flex;"><img src="/assets/img/reactdiff-2.65d8a818.png" alt="" align="left" style="zoom:80%;display:block;"></div> <br> <h4 id="component-diff"><a href="#component-diff" class="header-anchor">#</a> Component diff</h4> <p>不多说，先上图：</p> <div style="display:flex;"><img src="/assets/img/reactdiff-3.73b5be95.png" alt="" align="left" style="zoom:120%;display:block;"></div> <p>其实component diff相当于是子树的diff，基本方案和tree diff是一致的，如果如上图D变为G，那么直接删除D这一整棵树，然后重新渲染G树。依旧是简单粗暴。</p> <h4 id="element-diff"><a href="#element-diff" class="header-anchor">#</a> Element diff</h4> <p>对于同一节点的元素，diff算法提供了三种操作：插入、移动、删除。还是先上图：</p> <div style="display:flex;"><img src="/assets/img/reactdiff-4.98c6380c.png" alt="" align="left" style="zoom:100%;display:block;"></div> <p>此时的操作，是B、D不做任何操作，AC移动到相应位置【前提是都有相同的key】<br>如果，此时的key不相同，全都发生了变化，那么节点全都是要删除重新构建，将会消耗大量性能。</p> <h3 id="react-16的diff算法"><a href="#react-16的diff算法" class="header-anchor">#</a> React 16的Diff算法</h3> <p>React16相比React15的Diff算法发生了很大的变化，其中最主要就是引入了Fiber循环任务调度算法。</p> <h4 id="fiber"><a href="#fiber" class="header-anchor">#</a> Fiber</h4> <p><strong>Fiber是什么</strong>？<strong>干了什么</strong>？Fiber在diff阶段，做了如下的操作：</p> <ol><li>可以随时将diff操作进行任务拆分。</li> <li>diff阶段的每个任务可以随时执行或者中止。</li> <li>diff阶段任务调度优先级控制。</li></ol> <p>所以，Fiber相当于是，在15的diff算法阶段，做了优先级的任务调度控制。Fiber是根据一个fiber节点（VDOM节点）来拆分，以fiber node为一个任务单元，一个组件实例都是一个任务单元。任务循环中，每处理完一个fiber node，可以中断/挂起/恢复。</p> <p>它又是如何能够进行这样的异步操作的呢？这就不得不说一个方法：<code>requestIdleCallback</code><br>浏览器提供的requestIdleCallback API中的Cooperative Scheduling可以让浏览器在空闲时间执行回调（开发者传入的方法），在回调参数中可以获取到当前帧（16ms）剩余的时间。利用这个信息可以合理的安排当前帧需要做的事情，如果时间足够，那继续做下一个任务，如果时间不够就歇一歇，调用requestIdleCallback来获知主线程不忙的时候，再继续做任务</p> <p><strong>Fiber Node是什么？</strong></p> <p>链表！将要处理的节点，存在链表结构，那么就能够做到节点复用。【这大概是Fiber的核心吧】<br>大体上的Diff引入了Fiber之后，我们就增加了更多的链表复用功能，通过这一点，我们可以使得React Diff的性能得到提升。</p> <br> <p><em><strong>更多16的Diff算法参考文章</strong></em>:</p> <ul><li><a href="https://www.jianshu.com/p/7e8ee5dba3c5" target="_self" rel="noopener noreferrer">https://www.jianshu.com/p/7e8ee5dba3c5</a></li> <li>... ...</li></ul> <br> <h2 id="react-router路由"><a href="#react-router路由" class="header-anchor">#</a> React Router路由</h2> <p>to be added ...</p> <br> <h2 id="redux"><a href="#redux" class="header-anchor">#</a> Redux</h2> <p>to be added ...</p> <br></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Frontend/React/ReactStart.html" class="prev">React 项目搭建</a></span> <span class="next"><a href="/Frontend/React/ReactCase.html">React 实例</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2ba1140b.js" defer></script><script src="/assets/js/2.858e58ff.js" defer></script><script src="/assets/js/27.98408441.js" defer></script>
  </body>
</html>
