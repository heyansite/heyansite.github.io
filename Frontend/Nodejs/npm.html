<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>npm 基本使用 | Yan&#39;s Blog Home</title>
    <meta name="description" content="Personal blog site">
    
    
    <link rel="preload" href="/assets/css/0.styles.659f981c.css" as="style"><link rel="preload" href="/assets/js/app.2ba1140b.js" as="script"><link rel="preload" href="/assets/js/2.858e58ff.js" as="script"><link rel="preload" href="/assets/js/181.d5bcbada.js" as="script"><link rel="prefetch" href="/assets/js/10.5dcc1f52.js"><link rel="prefetch" href="/assets/js/100.0327e00b.js"><link rel="prefetch" href="/assets/js/101.404f187c.js"><link rel="prefetch" href="/assets/js/102.d78878ec.js"><link rel="prefetch" href="/assets/js/103.a682f6f1.js"><link rel="prefetch" href="/assets/js/104.d831bcb5.js"><link rel="prefetch" href="/assets/js/105.afbf1884.js"><link rel="prefetch" href="/assets/js/106.8e9709d3.js"><link rel="prefetch" href="/assets/js/107.9712aa22.js"><link rel="prefetch" href="/assets/js/108.4158fdb6.js"><link rel="prefetch" href="/assets/js/109.ae61a303.js"><link rel="prefetch" href="/assets/js/11.34e3d90e.js"><link rel="prefetch" href="/assets/js/110.0abce6c9.js"><link rel="prefetch" href="/assets/js/111.b5c958e5.js"><link rel="prefetch" href="/assets/js/112.fdacfaf6.js"><link rel="prefetch" href="/assets/js/113.9d95243d.js"><link rel="prefetch" href="/assets/js/114.f759f9b9.js"><link rel="prefetch" href="/assets/js/115.1b1f9f3d.js"><link rel="prefetch" href="/assets/js/116.1e5e62e4.js"><link rel="prefetch" href="/assets/js/117.952db9d4.js"><link rel="prefetch" href="/assets/js/118.ed9df468.js"><link rel="prefetch" href="/assets/js/119.f19ee9e0.js"><link rel="prefetch" href="/assets/js/12.cd237cda.js"><link rel="prefetch" href="/assets/js/120.24dbecef.js"><link rel="prefetch" href="/assets/js/121.0aa2d47c.js"><link rel="prefetch" href="/assets/js/122.5205ca42.js"><link rel="prefetch" href="/assets/js/123.25aa20a6.js"><link rel="prefetch" href="/assets/js/124.420b2a92.js"><link rel="prefetch" href="/assets/js/125.091331f4.js"><link rel="prefetch" href="/assets/js/126.471b335f.js"><link rel="prefetch" href="/assets/js/127.60ffdb36.js"><link rel="prefetch" href="/assets/js/128.9c5c36ef.js"><link rel="prefetch" href="/assets/js/129.36fd802b.js"><link rel="prefetch" href="/assets/js/13.de2ffe9f.js"><link rel="prefetch" href="/assets/js/130.822de8a4.js"><link rel="prefetch" href="/assets/js/131.697750e2.js"><link rel="prefetch" href="/assets/js/132.fd5faa78.js"><link rel="prefetch" href="/assets/js/133.cf327ef4.js"><link rel="prefetch" href="/assets/js/134.6cdb8690.js"><link rel="prefetch" href="/assets/js/135.906c8800.js"><link rel="prefetch" href="/assets/js/136.43585d13.js"><link rel="prefetch" href="/assets/js/137.3c7ddb41.js"><link rel="prefetch" href="/assets/js/138.e3274ead.js"><link rel="prefetch" href="/assets/js/139.7fa38b58.js"><link rel="prefetch" href="/assets/js/14.9d6406e7.js"><link rel="prefetch" href="/assets/js/140.1b026dad.js"><link rel="prefetch" href="/assets/js/141.c1adfec5.js"><link rel="prefetch" href="/assets/js/142.ed2a4a22.js"><link rel="prefetch" href="/assets/js/143.af96e2f9.js"><link rel="prefetch" href="/assets/js/144.923a7d38.js"><link rel="prefetch" href="/assets/js/145.d88163de.js"><link rel="prefetch" href="/assets/js/146.2134dd3e.js"><link rel="prefetch" href="/assets/js/147.9925c468.js"><link rel="prefetch" href="/assets/js/148.109297cc.js"><link rel="prefetch" href="/assets/js/149.ae529d47.js"><link rel="prefetch" href="/assets/js/15.fe3428fa.js"><link rel="prefetch" href="/assets/js/150.6bf9657f.js"><link rel="prefetch" href="/assets/js/151.603cf1f9.js"><link rel="prefetch" href="/assets/js/152.b64ef399.js"><link rel="prefetch" href="/assets/js/153.fd5cde7c.js"><link rel="prefetch" href="/assets/js/154.8cedd5d3.js"><link rel="prefetch" href="/assets/js/155.042308eb.js"><link rel="prefetch" href="/assets/js/156.1f58dd5a.js"><link rel="prefetch" href="/assets/js/157.69e07481.js"><link rel="prefetch" href="/assets/js/158.40b656df.js"><link rel="prefetch" href="/assets/js/159.823c56a4.js"><link rel="prefetch" href="/assets/js/16.7976352c.js"><link rel="prefetch" href="/assets/js/160.93aba24e.js"><link rel="prefetch" href="/assets/js/161.3ae7729a.js"><link rel="prefetch" href="/assets/js/162.8092cc22.js"><link rel="prefetch" href="/assets/js/163.3c82e51b.js"><link rel="prefetch" href="/assets/js/164.d358ee7b.js"><link rel="prefetch" href="/assets/js/165.60d778eb.js"><link rel="prefetch" href="/assets/js/166.54d7340a.js"><link rel="prefetch" href="/assets/js/167.5fd6aaa3.js"><link rel="prefetch" href="/assets/js/168.205929f8.js"><link rel="prefetch" href="/assets/js/169.873b90b1.js"><link rel="prefetch" href="/assets/js/17.72e8ffa6.js"><link rel="prefetch" href="/assets/js/170.68c49359.js"><link rel="prefetch" href="/assets/js/171.d8f93304.js"><link rel="prefetch" href="/assets/js/172.6b496cc7.js"><link rel="prefetch" href="/assets/js/173.f276a0ce.js"><link rel="prefetch" href="/assets/js/174.09cb41e2.js"><link rel="prefetch" href="/assets/js/175.c77ce8d9.js"><link rel="prefetch" href="/assets/js/176.01ab9f3f.js"><link rel="prefetch" href="/assets/js/177.2f91a2a4.js"><link rel="prefetch" href="/assets/js/178.5f0a0527.js"><link rel="prefetch" href="/assets/js/179.0d14e948.js"><link rel="prefetch" href="/assets/js/18.8264b169.js"><link rel="prefetch" href="/assets/js/180.9a15f295.js"><link rel="prefetch" href="/assets/js/182.571b87a8.js"><link rel="prefetch" href="/assets/js/183.b87f5a38.js"><link rel="prefetch" href="/assets/js/184.90ecbd35.js"><link rel="prefetch" href="/assets/js/185.3a38f733.js"><link rel="prefetch" href="/assets/js/186.881a0fab.js"><link rel="prefetch" href="/assets/js/187.17663dea.js"><link rel="prefetch" href="/assets/js/188.471fcd9b.js"><link rel="prefetch" href="/assets/js/189.6d486653.js"><link rel="prefetch" href="/assets/js/19.e6227b20.js"><link rel="prefetch" href="/assets/js/190.357b4cc8.js"><link rel="prefetch" href="/assets/js/191.ccf9ae83.js"><link rel="prefetch" href="/assets/js/192.3ee45cf5.js"><link rel="prefetch" href="/assets/js/193.2fbcbc68.js"><link rel="prefetch" href="/assets/js/194.61d0acd9.js"><link rel="prefetch" href="/assets/js/195.33b772c3.js"><link rel="prefetch" href="/assets/js/196.7d35848a.js"><link rel="prefetch" href="/assets/js/197.4b958d27.js"><link rel="prefetch" href="/assets/js/198.dfbfba98.js"><link rel="prefetch" href="/assets/js/199.f6c7aacb.js"><link rel="prefetch" href="/assets/js/20.65ad9b00.js"><link rel="prefetch" href="/assets/js/200.6a05302e.js"><link rel="prefetch" href="/assets/js/201.be446c97.js"><link rel="prefetch" href="/assets/js/202.d058ca1d.js"><link rel="prefetch" href="/assets/js/203.ef2b609c.js"><link rel="prefetch" href="/assets/js/204.dab38ee5.js"><link rel="prefetch" href="/assets/js/21.300f7dfb.js"><link rel="prefetch" href="/assets/js/22.0ed457bc.js"><link rel="prefetch" href="/assets/js/23.9cf0f43d.js"><link rel="prefetch" href="/assets/js/24.f151ffcb.js"><link rel="prefetch" href="/assets/js/25.680a763b.js"><link rel="prefetch" href="/assets/js/26.6a5f804d.js"><link rel="prefetch" href="/assets/js/27.98408441.js"><link rel="prefetch" href="/assets/js/28.acbefbd1.js"><link rel="prefetch" href="/assets/js/29.fbd2340a.js"><link rel="prefetch" href="/assets/js/3.753236a7.js"><link rel="prefetch" href="/assets/js/30.30b44255.js"><link rel="prefetch" href="/assets/js/31.510d262b.js"><link rel="prefetch" href="/assets/js/32.c204bc79.js"><link rel="prefetch" href="/assets/js/33.5fa66039.js"><link rel="prefetch" href="/assets/js/34.6db47b26.js"><link rel="prefetch" href="/assets/js/35.fcb88dd5.js"><link rel="prefetch" href="/assets/js/36.e294e99d.js"><link rel="prefetch" href="/assets/js/37.fe541556.js"><link rel="prefetch" href="/assets/js/38.94af8189.js"><link rel="prefetch" href="/assets/js/39.e7017f9b.js"><link rel="prefetch" href="/assets/js/4.1c3159e6.js"><link rel="prefetch" href="/assets/js/40.b7a1deeb.js"><link rel="prefetch" href="/assets/js/41.ae4d7d1e.js"><link rel="prefetch" href="/assets/js/42.5dc5c7f6.js"><link rel="prefetch" href="/assets/js/43.73610732.js"><link rel="prefetch" href="/assets/js/44.2b0e19f3.js"><link rel="prefetch" href="/assets/js/45.903efdc0.js"><link rel="prefetch" href="/assets/js/46.0684656f.js"><link rel="prefetch" href="/assets/js/47.6425b35e.js"><link rel="prefetch" href="/assets/js/48.43663ba9.js"><link rel="prefetch" href="/assets/js/49.34841bc0.js"><link rel="prefetch" href="/assets/js/5.d3774f5f.js"><link rel="prefetch" href="/assets/js/50.48ce1d7e.js"><link rel="prefetch" href="/assets/js/51.1820aa29.js"><link rel="prefetch" href="/assets/js/52.5317c537.js"><link rel="prefetch" href="/assets/js/53.71b86df9.js"><link rel="prefetch" href="/assets/js/54.31ed2a5e.js"><link rel="prefetch" href="/assets/js/55.4f9933ab.js"><link rel="prefetch" href="/assets/js/56.beb74e07.js"><link rel="prefetch" href="/assets/js/57.705bc19e.js"><link rel="prefetch" href="/assets/js/58.f5fd656b.js"><link rel="prefetch" href="/assets/js/59.cc8ae217.js"><link rel="prefetch" href="/assets/js/6.f082ca37.js"><link rel="prefetch" href="/assets/js/60.fc3cf484.js"><link rel="prefetch" href="/assets/js/61.b5032b43.js"><link rel="prefetch" href="/assets/js/62.64d7637a.js"><link rel="prefetch" href="/assets/js/63.2a71075b.js"><link rel="prefetch" href="/assets/js/64.21eb4820.js"><link rel="prefetch" href="/assets/js/65.11535a8c.js"><link rel="prefetch" href="/assets/js/66.d9c62638.js"><link rel="prefetch" href="/assets/js/67.5782c958.js"><link rel="prefetch" href="/assets/js/68.35886dae.js"><link rel="prefetch" href="/assets/js/69.934aa057.js"><link rel="prefetch" href="/assets/js/7.9a79fd87.js"><link rel="prefetch" href="/assets/js/70.53c7c7a2.js"><link rel="prefetch" href="/assets/js/71.0e82b1c6.js"><link rel="prefetch" href="/assets/js/72.1da0eaf9.js"><link rel="prefetch" href="/assets/js/73.3dabc9cd.js"><link rel="prefetch" href="/assets/js/74.b2ae43f6.js"><link rel="prefetch" href="/assets/js/75.55bf2044.js"><link rel="prefetch" href="/assets/js/76.2f88e50b.js"><link rel="prefetch" href="/assets/js/77.d916e87e.js"><link rel="prefetch" href="/assets/js/78.0e80a77d.js"><link rel="prefetch" href="/assets/js/79.03bce65e.js"><link rel="prefetch" href="/assets/js/8.60d5a8a9.js"><link rel="prefetch" href="/assets/js/80.96678f59.js"><link rel="prefetch" href="/assets/js/81.75ffa4d3.js"><link rel="prefetch" href="/assets/js/82.41c1aeb7.js"><link rel="prefetch" href="/assets/js/83.16d5e455.js"><link rel="prefetch" href="/assets/js/84.195ca01f.js"><link rel="prefetch" href="/assets/js/85.d850d4dd.js"><link rel="prefetch" href="/assets/js/86.32d87d56.js"><link rel="prefetch" href="/assets/js/87.5f97a4f6.js"><link rel="prefetch" href="/assets/js/88.f5b0bbdb.js"><link rel="prefetch" href="/assets/js/89.9f9150f5.js"><link rel="prefetch" href="/assets/js/9.74db15a0.js"><link rel="prefetch" href="/assets/js/90.f69286ce.js"><link rel="prefetch" href="/assets/js/91.c9995055.js"><link rel="prefetch" href="/assets/js/92.e992da4f.js"><link rel="prefetch" href="/assets/js/93.14137340.js"><link rel="prefetch" href="/assets/js/94.c8228a63.js"><link rel="prefetch" href="/assets/js/95.bbb7ce03.js"><link rel="prefetch" href="/assets/js/96.ce87793d.js"><link rel="prefetch" href="/assets/js/97.4fdd8a0b.js"><link rel="prefetch" href="/assets/js/98.74cfc635.js"><link rel="prefetch" href="/assets/js/99.abdd1b46.js">
    <link rel="stylesheet" href="/assets/css/0.styles.659f981c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yan's Blog Home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html &amp; CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nodejs</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Frontend/Nodejs/" class="sidebar-link">Nodejs</a></li><li><a href="/Frontend/Nodejs/npm.html" class="active sidebar-link">npm 基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#基本介绍" class="sidebar-link">基本介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#升级现有npm版本" class="sidebar-link">升级现有npm版本</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#更换npm镜像站点" class="sidebar-link">更换npm镜像站点</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#安装模块" class="sidebar-link">安装模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#本地安装-默认" class="sidebar-link">本地安装(默认)</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#全局安装" class="sidebar-link">全局安装</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#创建全局链接" class="sidebar-link">创建全局链接</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#常用命令" class="sidebar-link">常用命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#使用-package-json" class="sidebar-link">使用 package.json</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#创建package-json文件" class="sidebar-link">创建package.json文件</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#package-json-属性说明" class="sidebar-link">package.json 属性说明</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#指定依赖包" class="sidebar-link">指定依赖包</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#设置默认配置" class="sidebar-link">设置默认配置</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#更改全局安装目录" class="sidebar-link">更改全局安装目录</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#多版本管理器" class="sidebar-link">多版本管理器</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#发布包" class="sidebar-link">发布包</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#npm-scripts-使用指南" class="sidebar-link">npm scripts 使用指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#什么是-npm-脚本？" class="sidebar-link">什么是 npm 脚本？</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#通配符" class="sidebar-link">通配符</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#传参" class="sidebar-link">传参</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#执行顺序" class="sidebar-link">执行顺序</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#默认值" class="sidebar-link">默认值</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#钩子" class="sidebar-link">钩子</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#简写形式" class="sidebar-link">简写形式</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#变量" class="sidebar-link">变量</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#常用脚本示例" class="sidebar-link">常用脚本示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#npm-模块安装机制简介" class="sidebar-link">npm 模块安装机制简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#从-npm-install-说起" class="sidebar-link">从 npm install 说起</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#npm-update" class="sidebar-link">npm update</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#registry" class="sidebar-link">registry</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#缓存目录" class="sidebar-link">缓存目录</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#模块的安装过程" class="sidebar-link">模块的安装过程</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#cache-min-参数" class="sidebar-link">--cache-min 参数</a></li><li class="sidebar-sub-header"><a href="/Frontend/Nodejs/npm.html#离线安装的解决方案" class="sidebar-link">离线安装的解决方案</a></li></ul></li></ul></li><li><a href="/Frontend/Nodejs/Nodejs.html" class="sidebar-link">Node.Js 基本使用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>uni-app</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React Native</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/index/" class="sidebar-link">&lt; 首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="npm-基本使用"><a href="#npm-基本使用" class="header-anchor">#</a> npm 基本使用</h1> <div class="custom-block tip"><p class="custom-block-title">此文为转载 （通常一篇文章会参考多处，也会添加自己的理解，引用地址如有遗漏，请指出）</p> <ul><li><a href="https://www.jianshu.com/p/60ac7fe6edce" target="_self" rel="noopener noreferrer">https://www.jianshu.com/p/60ac7fe6edce</a></li> <li><a href="http://www.ruanyifeng.com/blog/2016/01/npm-install.html" target="_self" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2016/01/npm-install.html</a></li> <li><a href="http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html" target="_self" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html</a></li> <li><a href="https://www.runoob.com/nodejs/nodejs-npm.html" target="_self" rel="noopener noreferrer">https://www.runoob.com/nodejs/nodejs-npm.html</a></li></ul></div> <h2 id="基本介绍"><a href="#基本介绍" class="header-anchor">#</a> 基本介绍</h2> <p>npm 最初它只是被称为 Node Package Manager，用来作为Node.js的包管理器。但是随着其它构建工具(webpack、browserify)的发展，npm已经变成了 &quot;the package manager for JavaScript&quot;，它用来安装、管理和分享JavaScript包，同时会自动处理多个包之间的依赖。</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>新版的nodejs已经集成了npm， nodejs分为了长期支持版和当前版本。</p> <p>安装好后，你可以查看版本</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> -v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="升级现有npm版本"><a href="#升级现有npm版本" class="header-anchor">#</a> 升级现有npm版本</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token function">npm</span> -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="更换npm镜像站点"><a href="#更换npm镜像站点" class="header-anchor">#</a> 更换npm镜像站点</h3> <p>配置 npm 的国内镜像站点为：<code>https://registry.npm.taobao.org</code>。</p> <p>方法一：在系统的<code>HOME</code>目录新建.npmrc文件并添加 <code>registry = https://registry.npm.taobao.org</code><br>方法二：你可以使用淘宝定制的 <code>cnpm</code> 命令行工具代替默认的 npm:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> -g cnpm --registry<span class="token operator">=</span>https://registry.npm.taobao.org

//之后即可使用cnpm来安装包
cnpm <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="安装模块"><a href="#安装模块" class="header-anchor">#</a> 安装模块</h2> <p>npm 的包安装分为本地安装（local）、全局安装（global）两种。</p> <h3 id="本地安装-默认"><a href="#本地安装-默认" class="header-anchor">#</a> 本地安装(默认)</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span>      <span class="token comment"># 本地安装</span>
<span class="token comment"># 或者</span>
<span class="token function">npm</span> i <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>将安装包放在<code>./node_modules</code>下（运行 npm 命令时所在的目录），如果没有<code>node_modules</code> 目录，会在当前执行 npm 命令的目录下生成<code>node_modules</code>目录。</li> <li>js代码中可以通过 <code>require()</code> 来引入本地安装的包。</li></ul> <h3 id="全局安装"><a href="#全局安装" class="header-anchor">#</a> 全局安装</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span> -g   <span class="token comment"># 全局安装</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>将安装包放在<code>/usr/local</code>下或者你<code>node</code>的安装目录。</li> <li>可以直接在命令行里使用。这是使用全局安装的主要原因。</li></ul> <p>使用下面的命令来查看全局的包安装的位置：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> prefix -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="创建全局链接"><a href="#创建全局链接" class="header-anchor">#</a> 创建全局链接</h3> <p>如果你希望具备两者功能（本地安装和全局安装的功能），则需要在两个地方安装它或使用<code>npm link</code>。</p> <p><code>npm link</code>的功能是在本地包和全局包之间创建符号链接。我们说过使用全局模式安装的包不能直接通过<code>require</code>使用,但通过<code>npm link</code>命令可以打破这一限制。</p> <p>比如我们将express安装到了全局环境，使用下面的命令可以将其链接到本地环境：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">link</span> express
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用<code>npm link</code>命令还可以将本地的包链接到全局。使用方法是在包目录(<code>package.json</code>所在目录)中运行<code>npm link</code>命令。</p> <p>如果你的项目不再需要该模块，可以在项目目录内使用npm unlink命令，删除符号链接。</p> <blockquote><p>像gem 或 pip 总是以全局模式安装，使包可以供所有的程序使用，而 npm 默认会把包安装到当前目录下。这反映了 npm 不同的设计哲学。如果把包安装到全局，可以提高程序的重复利用程度,避免同样的内容的多份副本，但坏处是难以处理不同的版本依赖。</p></blockquote> <h3 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 查看命令帮助</span>
<span class="token function">npm</span> <span class="token builtin class-name">help</span> <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span>

<span class="token comment"># 列出各命令</span>
<span class="token function">npm</span> -l

<span class="token comment"># 查看安装信息和它们的依赖</span>
<span class="token function">npm</span> <span class="token function">ls</span> -g   <span class="token comment"># 列出当前项目中的包</span>
<span class="token function">npm</span> <span class="token function">ls</span>      <span class="token comment"># 列出当前项目中的包</span>

<span class="token comment"># 卸载模块</span>
<span class="token function">npm</span> uninstall <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span>

<span class="token comment"># 更新模块</span>
<span class="token function">npm</span> update <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span> <span class="token comment"># 更新当前项目中安装的某个包</span>
<span class="token function">npm</span> update <span class="token comment"># 更新当前项目中安装的所有包</span>
<span class="token function">npm</span> update <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span> -g <span class="token comment"># 更新全局安装的包</span>

<span class="token comment"># 搜索模块</span>
<span class="token function">npm</span> search <span class="token operator">&lt;</span>关键字<span class="token operator">&gt;</span>

<span class="token comment"># 列出npm的配置</span>
<span class="token function">npm</span> config list -l

<span class="token comment"># 列出bin目录</span>
<span class="token function">npm</span> bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="使用-package-json"><a href="#使用-package-json" class="header-anchor">#</a> 使用 package.json</h2> <p>当你的项目需要依赖多个包时，推荐使用 package.json。其优点为：</p> <ul><li>它以文档的形式规定了项目所依赖的包</li> <li>可以确定每个包所使用的版本</li> <li>项目的构建可以重复，在多人协作时更加方便</li></ul> <p><code>package.json</code> 位于模块的目录下，用于定义包的属性。例如之前我们安装的 <code>express</code> 包，它的 <code>package.json</code> 文件位于 <code>node_modules/express/package.json</code>。</p> <h3 id="创建package-json文件"><a href="#创建package-json文件" class="header-anchor">#</a> 创建package.json文件</h3> <ul><li>手动创建</li> <li>或者 通过<code>npm init</code>命令生成遵守规范的<code>package.json</code>文件</li></ul> <p>文件中必须包含：<code>name</code> 和 <code>version</code></p> <h3 id="package-json-属性说明"><a href="#package-json-属性说明" class="header-anchor">#</a> package.json 属性说明</h3> <ul><li><strong>name</strong> - 包名。</li> <li><strong>version</strong> - 包的版本号。</li> <li><strong>description</strong> - 包的描述。</li> <li><strong>homepage</strong> - 包的官网 url 。</li> <li><strong>author</strong> - 包的作者姓名。</li> <li><strong>contributors</strong> - 包的其他贡献者姓名。</li> <li><strong>dependencies</strong> - 依赖包列表。如果依赖包没有安装，npm 会自动将依赖包安装在 node_module 目录下。</li> <li><strong>repository</strong> - 包代码存放的地方的类型，可以是 git 或 svn，git 可在 Github 上。</li> <li><strong>main</strong> - main 字段指定了程序的主入口文件，require('moduleName') 就会加载这个文件。这个字段的默认值是模块根目录下面的 index.js。</li> <li><strong>keywords</strong> - 关键字</li></ul> <h3 id="指定依赖包"><a href="#指定依赖包" class="header-anchor">#</a> 指定依赖包</h3> <p>两种依赖包：</p> <ul><li><code>dependencies</code>: 在生产环境中需要依赖的包。通过<code>npm install &lt;packge&gt; --save</code>命令自动添加依赖到文件（或者使用简写的参数 <code>-S</code>）。</li> <li><code>devDependencies</code>：仅在开发和测试环节中需要依赖的包。通过<code>npm install &lt;packge&gt; --save-dev</code>命令自动添加依赖到文件（或者使用简写的参数 <code>-D</code>）。</li></ul> <blockquote><p>当然你也可以在文件中手动添加依赖</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">一般使用方法：</p> <p><strong>如果其他人也需要这个项目，只需要把这个 <code>package.json</code> 文件给他，然后进行简单的 <code>npm install</code> 即可。</strong> <br>(<em>如本人的blog项目，只需要从github clone代码到本地，然后在目录下直接运行<code>npm install</code>即可自动安装依赖包，并创建<code>/node_modules</code>目录；测试，即可直接<code>npm start xxx</code>运行代码了</em>)</p> <br></div> <h3 id="设置默认配置"><a href="#设置默认配置" class="header-anchor">#</a> 设置默认配置</h3> <p>使用 <code>npm set</code> 命令用来设置环境变量。也可以用它来为 <code>npm init</code> 设置默认值，这些值会保存在 <code>~/.npmrc</code> 文件中。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token builtin class-name">set</span> init-author-name <span class="token string">'Your name'</span>
$ <span class="token function">npm</span> <span class="token builtin class-name">set</span> init-author-email <span class="token string">'Your email'</span>
$ <span class="token function">npm</span> <span class="token builtin class-name">set</span> init-author-url <span class="token string">'http://yourdomain.com'</span>
$ <span class="token function">npm</span> <span class="token builtin class-name">set</span> init-license <span class="token string">'MIT'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="更改全局安装目录"><a href="#更改全局安装目录" class="header-anchor">#</a> 更改全局安装目录</h3> <p>使用 <code>npm config</code> 命令可以达到此目的。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> config <span class="token builtin class-name">set</span> prefix <span class="token operator">&lt;</span>目录<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者手动在 <code>~/.npmrc</code> 文件中进行配置：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>prefix <span class="token operator">=</span> /home/yourUsername/npm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>更改目录后记得在系统环境变量 <code>PATH</code> 中添加该路径：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># .bashrc 文件</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>~/npm/bin:<span class="token environment constant">$PATH</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="多版本管理器"><a href="#多版本管理器" class="header-anchor">#</a> 多版本管理器</h2> <p><code>Node.js</code> 的社区开发了多版本管理器，用于在一台机器上维护多个版本的 <code>Node.js</code> 实例，方便按需切换。Node 多版本管理器(Node Version Manager，nvm)是一个通用的叫法，它目前有许多不同的实现。这里使用<code>visionmedia/n</code>。<code>n</code> 是一个十分简洁的 Node 多版本管理器。</p> <p>如果已经安装好npm则可以简单的使用 <code>npm install -g n</code> 来安装n。事实上，n 并不需要 Node.js 驱动，它只是 bash 脚本；我们可以在 <a href="https://github.com/visionmedia/n" target="_self" rel="noopener noreferrer">https://github.com/visionmedia/n</a> 下载它的代码，然后使用 make install 命令安装。</p> <p>n的常用命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 查看帮助 </span>
n --help

<span class="token comment"># 安装 6.9.5版本的nodejs。 </span>
<span class="token comment"># 通过 n 获取的 Node.js 实例都会安装在 /usr/local/n/versions/ 目录中（看情况吧）</span>
n <span class="token number">6.9</span>.5

<span class="token comment"># 列出已经安装的 Node.js 。结果中 * 表示默认版本</span>
n

<span class="token comment"># 版本切换，与安装node.js一样</span>
n <span class="token number">6.9</span>.5

<span class="token comment"># 指明使用某版本的 node.js 执行某脚本(比如 script.js)</span>
n use <span class="token number">6.9</span>.5 script.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>PREFIX=$CUSTOM_LOCATION make install； 自定义 n 的安装路径（避免使用sudo）</li> <li>自定义node.js的安装路径(通过n安装)；通过设置环境变量 export N_PREFIX=$HOME</li> <li>自定义 source。（镜像站点）</li> <li>自定义 架构(architecture)</li> <li>如果使用n切换了node.js的版本后，npm没有正确运行，通过运行相关脚本解决。（见 n: working-with-npm）</li></ul> <blockquote><p>详细用法见 ： <a href="https://github.com/tj/n" target="_self" rel="noopener noreferrer">n: Node version management</a> <br>
注意：<br>
n 无法管理通过其他方式安装的 Node.js 版本实例(如官方提供的安装包、发行版软件源、手动编译)，也就说无法管理不是用 n 安装的node.js。<br>
n 不支持在Windows上使用</p></blockquote> <h2 id="发布包"><a href="#发布包" class="header-anchor">#</a> 发布包</h2> <p>在发布之前,首先需要让我们的包符合 npm 的规范,npm 有一套以 CommonJS 为基础包规范,但与 CommonJS并不完全一致,其主要差别在于必填字段的不同。通过使用 npm init 可以根据交互问答产生一个符合标准的 package.json。</p> <p>npm init 运行示例：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> init
name: <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token builtin class-name">test</span>
version: <span class="token punctuation">(</span><span class="token number">1.0</span>.0<span class="token punctuation">)</span> 
description: 
entry point: <span class="token punctuation">(</span>index.js<span class="token punctuation">)</span> 
<span class="token builtin class-name">test</span> command: 
<span class="token function">git</span> repository: 
keywords: 
author: 
license: <span class="token punctuation">(</span>ISC<span class="token punctuation">)</span> 
About to <span class="token function">write</span> to /tmp/node/package.json:

<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test&quot;</span>,
  <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1.0.0&quot;</span>,
  <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
  <span class="token string">&quot;main&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;index.js&quot;</span>,
  <span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;echo <span class="token entity" title="\&quot;">\&quot;</span>Error: no test specified<span class="token entity" title="\&quot;">\&quot;</span> &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
  <span class="token string">&quot;license&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>


Is this ok? <span class="token punctuation">(</span>yes<span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>该文件就是一个符合 npm 规范的 package.json 文件。这里的 index.js 作为包的接口。</p> <blockquote><p>也可简单的使用 <code>npm init -y</code>。其中-y（代表yes）</p></blockquote> <p>创建帐号：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> adduser
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试是否取得帐号：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">whoami</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>发布</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>更新包：修改 version字段，再重新发布</p> <p>取消发布：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> unpublish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="npm-scripts-使用指南"><a href="#npm-scripts-使用指南" class="header-anchor">#</a> npm scripts 使用指南</h2> <p>Node 开发离不开 npm，而脚本功能是 npm 最强大、最常用的功能之一。
本文介绍如何使用 npm 脚本（npm scripts）。</p> <h3 id="什么是-npm-脚本？"><a href="#什么是-npm-脚本？" class="header-anchor">#</a> 什么是 npm 脚本？</h3> <p>npm 允许在package.json文件里面，使用scripts字段定义脚本命令。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node build.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上面代码是package.json文件的一个片段，里面的scripts字段是一个对象。它的每一个属性，对应一段脚本。比如，build命令对应的脚本是node build.js。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> run build
<span class="token comment"># 等同于执行</span>
$ node build.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这些定义在package.json里面的脚本，就称为 npm 脚本。它的优点很多:</p> <ul><li>项目的相关脚本，可以集中在一个地方。</li> <li>不同项目的脚本命令，只要功能相同，就可以有同样的对外接口。用户不需要知道怎么测试你的项目，只要运行npm run test即可。</li> <li>可以利用 npm 提供的很多辅助功能。</li></ul> <p>查看当前项目的所有 npm 脚本命令，可以使用不带任何参数的npm run命令。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> run
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>npm 脚本的原理非常简单。每当执行npm run，就会自动新建一个 Shell，在这个 Shell 里面执行指定的脚本命令。因此，只要是 Shell（一般是 Bash）可以运行的命令，就可以写在 npm 脚本里面。</p> <p>比较特别的是，<code>npm run</code>新建的这个 Shell，会将当前目录的<code>node_modules/.bin</code>子目录加入<code>PATH</code>变量，执行结束后，再将<code>PATH</code>变量恢复原样。<br>
这意味着，当前目录的<code>node_modules/.bin</code>子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径。比如，当前项目的依赖里面有 Mocha，只要直接写<code>mocha test</code>就可以了。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mocha test&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而不用写成下面这样:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./node_modules/.bin/mocha test&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于 npm 脚本的唯一要求就是可以在 Shell 执行，因此它不一定是 Node 脚本，任何可执行文件都可以写在里面。<br>
npm 脚本的退出码，也遵守 Shell 脚本规则。如果退出码不是<code>0</code>，npm 就认为这个脚本执行失败。</p> <h3 id="通配符"><a href="#通配符" class="header-anchor">#</a> 通配符</h3> <p>由于 npm 脚本就是 Shell 脚本，因为可以使用 Shell 通配符。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jshint *.js&quot;</span>
<span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jshint **/*.js&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上面代码中，*表示任意文件名，**表示任意一层子目录。<br>
如果要将通配符传入原始命令，防止被 Shell 转义，要将星号转义。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tap test/\*.js&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="传参"><a href="#传参" class="header-anchor">#</a> 传参</h3> <p>向 npm 脚本传入参数，要使用<code>--</code>标明。</p> <h3 id="执行顺序"><a href="#执行顺序" class="header-anchor">#</a> 执行顺序</h3> <p>如果 npm 脚本里面需要执行多个任务，那么需要明确它们的执行顺序。如果是并行执行（即同时的平行执行），可以使用 <code>&amp;</code> 符号。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> run script1.js <span class="token operator">&amp;</span> <span class="token function">npm</span> run script2.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果是继发执行（即只有前一个任务成功，才执行下一个任务），可以使用&amp;&amp;符号。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> run script1.js <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run script2.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="默认值"><a href="#默认值" class="header-anchor">#</a> 默认值</h3> <p>一般来说，npm 脚本由用户提供。但是，npm 对两个脚本提供了默认值。也就是说，这两个脚本不用定义，就可以直接使用。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server.js&quot;</span>，
<span class="token property">&quot;install&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-gyp rebuild&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上面代码中，<code>npm run start</code>的默认值是<code>node server.j</code>s，前提是项目根目录下有<code>server.js</code>这个脚本；<code>npm run install</code>的默认值是<code>node-gyp rebuild</code>，前提是项目根目录下有<code>binding.gyp</code>文件。</p> <h3 id="钩子"><a href="#钩子" class="header-anchor">#</a> 钩子</h3> <p>npm 脚本有<code>pre</code>和<code>post</code>两个钩子。举例来说，<code>build</code>脚本命令的钩子就是<code>prebuild</code>和<code>postbuild</code>。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;prebuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo I run before the build script&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;postbuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo I run after the build script&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>用户执行npm run build的时候，会自动按照下面的顺序执行。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> run prebuild <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run postbuild
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此，可以在这两个钩子里面，完成一些准备工作和清理工作。下面是一个例子:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;clean&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf ./dist &amp;&amp; mkdir dist&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;prebuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run clean&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production webpack&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>npm 默认提供下面这些钩子。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>prepublish，postpublish
preinstall，postinstall
preuninstall，postuninstall
preversion，postversion
pretest，posttest
prestop，poststop
prestart，poststart
prerestart，postrestart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>自定义的脚本命令也可以加上<code>pre</code>和<code>post</code>钩子。比如，<code>myscript</code>这个脚本命令，也有<code>premyscript</code>和<code>postmyscript</code>钩子。不过，双重的<code>pre</code>和<code>post</code>无效，比如<code>prepretest</code>和<code>postposttest</code>是无效的。</p> <p>npm 提供一个<code>npm_lifecycle_event</code>变量，返回当前正在运行的脚本名称，比如<code>pretest</code>、<code>test</code>、<code>posttest</code>等等。所以，可以利用这个变量，在同一个脚本文件里面，为不同的<code>npm scripts</code>命令编写代码。请看下面的例子:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>const TARGET <span class="token operator">=</span> process.env.npm_lifecycle_event<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>TARGET <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Running the <span class="token builtin class-name">test</span> task<span class="token operator">!</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>TARGET <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'pretest'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Running the pretest task<span class="token operator">!</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>TARGET <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'posttest'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Running the posttest task<span class="token operator">!</span><span class="token variable">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="简写形式"><a href="#简写形式" class="header-anchor">#</a> 简写形式</h3> <p>四个常用的 npm 脚本有简写形式。</p> <ul><li><code>npm start</code>是<code>npm run start</code>的简写</li> <li><code>npm stop</code>是<code>npm run stop</code>的简写</li> <li><code>npm test</code>是<code>npm run test</code>的简写</li> <li><code>npm restart</code>是<code>npm run stop &amp;&amp; npm run restart &amp;&amp; npm run start</code>的简写</li></ul> <p><code>npm start</code>、<code>npm stop</code>和<code>npm restart</code>都比较好理解，而<code>npm restart</code>是一个复合命令，实际上会执行三个脚本命令：<code>stop</code>、<code>restart</code>、<code>start</code>。具体的执行顺序如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>prerestart
prestop
stop
poststop
restart
prestart
start
poststart
postrestart
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="变量"><a href="#变量" class="header-anchor">#</a> 变量</h3> <p>npm 脚本有一个非常强大的功能，就是可以使用 npm 的内部变量。</p> <p>首先，通过<code>npm_package_</code>前缀，npm 脚本可以拿到<code>package.json</code>里面的字段。比如，下面是一个<code>package.json</code></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> 
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.5&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node view.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>那么，变量npm_package_name返回foo，变量npm_package_version返回1.2.5。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// view.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_package_version<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.2.5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面代码中，我们通过环境变量<code>process.env</code>对象，拿到<code>package.json</code>的字段值。如果是 Bash 脚本，可以用<code>$npm_package_name</code>和<code>$npm_package_version</code>取到这两个值。</p> <p><code>npm_package_</code>前缀也支持嵌套的<code>package.json</code>字段。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;repository&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxx&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
scripts<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo $npm_package_repository_type&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面代码中，<code>repository</code>字段的<code>type</code>属性，可以通过<code>npm_package_repository_type</code>取到</p> <p>下面是另外一个例子</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;install&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面代码中，<code>npm_package_scripts_install</code>变量的值等于<code>foo.js</code>。</p> <p>然后，npm 脚本还可以通过<code>npm_config_</code>前缀，拿到 npm 的配置变量，即<code>npm config get xxx</code>命令返回的值。比如，当前模块的发行标签，可以通过<code>npm_config_tag</code>取到。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo $npm_config_tag&quot;</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意，package.json里面的config对象，可以被环境变量覆盖。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> 
  <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;config&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;port&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;8080&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;start&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;node server.js&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上面代码中，npm_package_config_port变量返回的是8080。这个值可以用下面的方法覆盖。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> config <span class="token builtin class-name">set</span> foo:port <span class="token number">80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最后，env命令可以列出所有环境变量。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;env&quot;</span><span class="token operator">:</span> <span class="token string">&quot;env&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="常用脚本示例"><a href="#常用脚本示例" class="header-anchor">#</a> 常用脚本示例</h3> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// 删除目录</span>
<span class="token property">&quot;clean&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rimraf dist/*&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 本地搭建一个 HTTP 服务</span>
<span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http-server -p 9090 dist/&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 打开浏览器</span>
<span class="token property">&quot;open:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;opener http://localhost:9090&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 实时刷新</span>
 <span class="token property">&quot;livereload&quot;</span><span class="token operator">:</span> <span class="token string">&quot;live-reload --port 9091 dist/&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 构建 HTML 文件</span>
<span class="token property">&quot;build:html&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jade index.jade &gt; dist/index.html&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 只要 CSS 文件有变动，就重新执行构建</span>
<span class="token property">&quot;watch:css&quot;</span><span class="token operator">:</span> <span class="token string">&quot;watch 'npm run build:css' assets/styles/&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 只要 HTML 文件有变动，就重新执行构建</span>
<span class="token property">&quot;watch:html&quot;</span><span class="token operator">:</span> <span class="token string">&quot;watch 'npm run build:html' assets/html&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 部署到 Amazon S3</span>
<span class="token property">&quot;deploy:prod&quot;</span><span class="token operator">:</span> <span class="token string">&quot;s3-cli sync ./dist/ s3://example-com/prod-site/&quot;</span><span class="token punctuation">,</span>

<span class="token comment">// 构建 favicon</span>
<span class="token property">&quot;build:favicon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node scripts/favicon.js&quot;</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="npm-模块安装机制简介"><a href="#npm-模块安装机制简介" class="header-anchor">#</a> npm 模块安装机制简介</h2> <p>npm 是 Node 的模块管理器，功能极其强大。它是 Node 获得成功的重要原因之一。正因为有了npm，我们只要一行命令，就能安装别人写好的模块:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token function">install</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>本文介绍 npm 模块安装机制的细节，以及如何解决安装速度慢的问题。</p> <h3 id="从-npm-install-说起"><a href="#从-npm-install-说起" class="header-anchor">#</a> 从 npm install 说起</h3> <p><code>npm install</code> 命令用来安装模块到<code>node_modules</code>目录。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>packageName<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装之前，<code>npm install</code>会先检查，<code>node_modules</code>目录之中是否已经存在指定模块。如果存在，就不再重新安装了，即使远程仓库已经有了一个新版本，也是如此。<br>
如果你希望，一个模块不管是否安装过，npm 都要强制重新安装，可以使用-f或--force参数。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token function">install</span> <span class="token operator">&lt;</span>packageName<span class="token operator">&gt;</span> --force
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="npm-update"><a href="#npm-update" class="header-anchor">#</a> npm update</h3> <p>如果想更新已安装模块，就要用到<code>npm update</code>命令。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> update <span class="token operator">&lt;</span>packageName<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它会先到远程仓库查询最新版本，然后查询本地版本。如果本地版本不存在，或者远程版本较新，就会安装。</p> <h3 id="registry"><a href="#registry" class="header-anchor">#</a> registry</h3> <p><code>npm update</code>命令怎么知道每个模块的最新版本呢？</p> <p>答案是 npm 模块仓库提供了一个查询服务，叫做 <code>registry</code> 。以 <code>npmjs.org</code> 为例，它的查询服务网址是 <a href="https://registry.npmjs.org/" target="_self" rel="noopener noreferrer">https://registry.npmjs.org/</a>。<br>
这个网址后面跟上模块名，就会得到一个 JSON 对象，里面是该模块所有版本的信息。比如，访问 <a href="https://registry.npmjs.org/react" target="_self" rel="noopener noreferrer">https://registry.npmjs.org/react</a>，就会看到 react 模块所有版本的信息。它跟下面命令的效果是一样的:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> view react

<span class="token comment"># npm view 的别名</span>
$ <span class="token function">npm</span> info react
$ <span class="token function">npm</span> show react
$ <span class="token function">npm</span> <span class="token function">v</span> react
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>registry 网址的模块名后面，还可以跟上版本号或者标签，用来查询某个具体版本的信息。比如， 访问 <code>https://registry.npmjs.org/react/v0.14.6</code> ，就可以看到 React 的 0.14.6 版。<br>返回的 JSON 对象里面，有一个dist.tarball属性，是该版本压缩包的网址。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>dist<span class="token operator">:</span> <span class="token punctuation">{</span>
  shasum<span class="token operator">:</span> '<span class="token number">2</span>a<span class="token number">57</span>c<span class="token number">2</span>cf<span class="token number">8747</span>b<span class="token number">483759</span>ad<span class="token number">8</span>de<span class="token number">0</span>fa<span class="token number">47</span>fb<span class="token number">0</span>c<span class="token number">5</span>cf<span class="token number">5</span>c<span class="token number">6</span>a'<span class="token punctuation">,</span>
  tarball<span class="token operator">:</span> 'http<span class="token operator">:</span><span class="token comment">//registry.npmjs.org/react/-/react-0.14.6.tgz' </span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>到这个网址下载压缩包，在本地解压，就得到了模块的源码。<code>npm install</code>和<code>npm update</code>命令，都是通过这种方式安装模块的。</p> <h3 id="缓存目录"><a href="#缓存目录" class="header-anchor">#</a> 缓存目录</h3> <p><code>npm install</code>或<code>npm update</code>命令，从 registry 下载压缩包之后，都存放在本地的缓存目录。</p> <p>这个缓存目录，在 Linux 或 Mac 默认是用户主目录下的<code>.npm</code>目录，在 Windows 默认是<code>%AppData%/npm-cache</code>。通过配置命令，可以查看这个目录的具体位置</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> config get cache
<span class="token environment constant">$HOME</span>/.npm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>你最好浏览一下这个目录</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">ls</span> ~/.npm 
<span class="token comment"># 或者</span>
$ <span class="token function">npm</span> cache <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你会看到里面存放着大量的模块，储存结构是{cache}/{name}/{version}。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> cache <span class="token function">ls</span> react
~/.npm/react/react/0.14.6/
~/.npm/react/react/0.14.6/package.tgz
~/.npm/react/react/0.14.6/package/
~/.npm/react/react/0.14.6/package/package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>每个模块的每个版本，都有一个自己的子目录，里面是代码的压缩包<code>package.tgz</code>文件，以及一个描述文件<code>package/package.json</code>。</p> <p>除此之外，还会生成一个<code>{cache}/{hostname}/{path}/.cache.json</code>文件。比如，从 npm 官方仓库下载 react 模块的时候，就会生成<code>registry.npmjs.org/react/.cache.json</code>文件。
这个文件保存的是，所有版本的信息，以及该模块最近修改的时间和最新一次请求时服务器返回的 ETag</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;time&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;modified&quot;</span><span class="token operator">:</span><span class="token string">&quot;2016-01-06T23:52:45.571Z&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_etag&quot;</span><span class="token operator">:</span><span class="token string">&quot;\&quot;7S37I0775YLURCFIO8N85FO0F\&quot;&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对于一些不是很关键的操作（比如<code>npm search</code>或<code>npm view</code>），npm会先查看<code>.cache.jso</code>n里面的模块最近更新时间，跟当前时间的差距，是不是在可接受的范围之内。如果是的，就不再向远程仓库发出请求，而是直接返回<code>.cache.json</code>的数据。</p> <p><code>.npm</code>目录保存着大量文件，清空它的命令如下</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">rm</span> -rf ~/.npm/*
<span class="token comment"># 或者</span>
$ <span class="token function">npm</span> cache clean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="模块的安装过程"><a href="#模块的安装过程" class="header-anchor">#</a> 模块的安装过程</h3> <p>总结一下，Node模块的安装过程是这样的。</p> <ul><li>发出npm install命令</li> <li>npm 向 registry 查询模块压缩包的网址</li> <li>下载压缩包，存放在~/.npm目录</li> <li>解压压缩包到当前项目的node_modules目录</li></ul> <p>注意，一个模块安装以后，本地其实保存了两份。一份是<code>~/.npm</code>目录下的压缩包，另一份是<code>node_modules</code>目录下解压后的代码。<br>
但是，运行npm install的时候，只会检查node_modules目录，而不会检查~/.npm目录。也就是说，如果一个模块在～/.npm下有压缩包，但是没有安装在node_modules目录中，npm 依然会从远程仓库下载一次新的压缩包。<br>
这种行为固然可以保证总是取得最新的代码，但有时并不是我们想要的。最大的问题是，它会极大地影响安装速度。即使某个模块的压缩包就在缓存目录中，也要去远程仓库下载，这怎么可能不慢呢？</p> <h3 id="cache-min-参数"><a href="#cache-min-参数" class="header-anchor">#</a> --cache-min 参数</h3> <p>为了解决这些问题，npm 提供了一个--cache-min参数，用于从缓存目录安装模块。</p> <p><code>--cache-min</code>参数指定一个时间（单位为分钟），只有超过这个时间的模块，才会从 registry 下载</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --cache-min <span class="token number">9999999</span> <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
<span class="token comment"># 上面命令指定，只有超过999999分钟的模块，才从 registry 下载。实际上就是指定，所有模块都从缓存安装，这样就大大加快了下载速度。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>它还有另一种写法。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token function">install</span> --cache-min Infinity <span class="token operator">&lt;</span>package-name<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但是，这并不等于离线模式，这时仍然需要网络连接。因为现在的<code>--cache-min</code>实现有一些问题。</p> <blockquote><p>（1）如果指定模块不在缓存目录，那么 npm 会连接 registry，下载最新版本。这没有问题，但是如果指定模块在缓存目录之中，npm 也会连接 registry，发出指定模块的 etag ，服务器返回状态码304，表示不需要重新下载压缩包。<br>
（2）如果某个模块已经在缓存之中，但是版本低于要求，npm会直接报错，而不是去 registry 下载最新版本。</p></blockquote> <blockquote><p>npm 团队知道存在这些问题，正在重写 cache。并且，将来会提供一个<code>--offlin</code>e参数，使得 npm 可以在离线情况下使用。<br>
不过，这些改进没有日程表。所以，当前使用--cache-min改进安装速度，是有问题的。</p></blockquote> <h3 id="离线安装的解决方案"><a href="#离线安装的解决方案" class="header-anchor">#</a> 离线安装的解决方案</h3> <p>社区已经为npm的离线使用，提出了几种解决方案。它们可以大大加快模块安装的速度。</p> <p>解决方案大致分成三类:</p> <p><strong>第一类，Registry 代理</strong></p> <ul><li>npm-proxy-cache</li> <li>local-npm</li> <li>npm-lazy</li></ul> <p>上面三个模块的用法很类似，都是在本机起一个 Registry 服务，所有npm install命令都要通过这个服务代理。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># npm-proxy-cache</span>
$ <span class="token function">npm</span> --proxy http://localhost:8080 <span class="token punctuation">\</span>
  --https-proxy http://localhost:8080 <span class="token punctuation">\</span>
  --strict-ssl <span class="token boolean">false</span> <span class="token punctuation">\</span>
  <span class="token function">install</span>

<span class="token comment"># local-npm</span>
$ <span class="token function">npm</span> <span class="token builtin class-name">set</span> registry http://127.0.0.1:5080

<span class="token comment"># npm-lazy</span>
$ <span class="token function">npm</span> --registry http://localhost:8080/ <span class="token function">install</span> socket.io
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>有了本机的Registry服务，就能完全实现缓存安装，可以实现离线使用。</p> <p><strong>第二类，npm install替代</strong></p> <p>如果能够改变<code>npm install</code>的行为，就能实现缓存安装。<code>npm-cache</code> 工具就是这个思路。凡是使用<code>npm install</code>的地方，都可以使用<code>npm-cache</code>替代。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ npm-cache <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>第三类，node_modules作为缓存目录</strong></p> <p>这个方案的思路是，不使用.npm缓存，而是使用项目的node_modules目录作为缓存</p> <ul><li>Freight</li> <li>npmbox</li></ul> <p>上面两个工具，都能将项目的node_modules目录打成一个压缩包，以后安装的时候，就从这个压缩包之中取出文件</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Frontend/Nodejs/" class="prev router-link-active">Nodejs</a></span> <span class="next"><a href="/Frontend/Nodejs/Nodejs.html">Node.Js 基本使用</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2ba1140b.js" defer></script><script src="/assets/js/2.858e58ff.js" defer></script><script src="/assets/js/181.d5bcbada.js" defer></script>
  </body>
</html>
