<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES Index-Mapping &amp; Setting | Yan&#39;s Blog Home</title>
    <meta name="description" content="Personal blog site">
    
    
    <link rel="preload" href="/assets/css/0.styles.ad4900be.css" as="style"><link rel="preload" href="/assets/js/app.251ed5d9.js" as="script"><link rel="preload" href="/assets/js/2.858e58ff.js" as="script"><link rel="preload" href="/assets/js/37.901c9e05.js" as="script"><link rel="prefetch" href="/assets/js/10.5dcc1f52.js"><link rel="prefetch" href="/assets/js/100.c5640ec8.js"><link rel="prefetch" href="/assets/js/101.323d4ccf.js"><link rel="prefetch" href="/assets/js/102.d94a08aa.js"><link rel="prefetch" href="/assets/js/103.678e430d.js"><link rel="prefetch" href="/assets/js/104.b400bd3a.js"><link rel="prefetch" href="/assets/js/105.b6229a45.js"><link rel="prefetch" href="/assets/js/106.3ee7df20.js"><link rel="prefetch" href="/assets/js/107.4a958290.js"><link rel="prefetch" href="/assets/js/108.3ea2d0fb.js"><link rel="prefetch" href="/assets/js/109.e1eb969c.js"><link rel="prefetch" href="/assets/js/11.ff52cad9.js"><link rel="prefetch" href="/assets/js/110.a6e6e273.js"><link rel="prefetch" href="/assets/js/111.a172e2a2.js"><link rel="prefetch" href="/assets/js/112.dfc2a86d.js"><link rel="prefetch" href="/assets/js/113.6df6d874.js"><link rel="prefetch" href="/assets/js/114.302b8495.js"><link rel="prefetch" href="/assets/js/115.8651aa48.js"><link rel="prefetch" href="/assets/js/116.9e1f9a0b.js"><link rel="prefetch" href="/assets/js/117.9a74f4ce.js"><link rel="prefetch" href="/assets/js/118.121a666c.js"><link rel="prefetch" href="/assets/js/119.ca6819f9.js"><link rel="prefetch" href="/assets/js/12.b633635b.js"><link rel="prefetch" href="/assets/js/120.efe65d91.js"><link rel="prefetch" href="/assets/js/121.72958c2e.js"><link rel="prefetch" href="/assets/js/122.72c5fb33.js"><link rel="prefetch" href="/assets/js/123.e94917c1.js"><link rel="prefetch" href="/assets/js/124.11cc8c85.js"><link rel="prefetch" href="/assets/js/125.437fd863.js"><link rel="prefetch" href="/assets/js/126.207eaa74.js"><link rel="prefetch" href="/assets/js/127.125a30c1.js"><link rel="prefetch" href="/assets/js/128.1af89ad7.js"><link rel="prefetch" href="/assets/js/129.269e955a.js"><link rel="prefetch" href="/assets/js/13.4bfed5d6.js"><link rel="prefetch" href="/assets/js/130.3d2d293b.js"><link rel="prefetch" href="/assets/js/131.59e95e31.js"><link rel="prefetch" href="/assets/js/132.46b0ce06.js"><link rel="prefetch" href="/assets/js/133.f24ba32d.js"><link rel="prefetch" href="/assets/js/134.c8fe20d2.js"><link rel="prefetch" href="/assets/js/135.c7a5061f.js"><link rel="prefetch" href="/assets/js/136.b618e419.js"><link rel="prefetch" href="/assets/js/137.940c57e9.js"><link rel="prefetch" href="/assets/js/138.d59a4686.js"><link rel="prefetch" href="/assets/js/139.b2f4f7fd.js"><link rel="prefetch" href="/assets/js/14.49597bec.js"><link rel="prefetch" href="/assets/js/140.44b06552.js"><link rel="prefetch" href="/assets/js/141.f6a6d207.js"><link rel="prefetch" href="/assets/js/142.c86df684.js"><link rel="prefetch" href="/assets/js/143.5fd6fd83.js"><link rel="prefetch" href="/assets/js/144.c803a4cd.js"><link rel="prefetch" href="/assets/js/145.103c81ef.js"><link rel="prefetch" href="/assets/js/146.cd714a4a.js"><link rel="prefetch" href="/assets/js/147.df610887.js"><link rel="prefetch" href="/assets/js/148.3e704f1c.js"><link rel="prefetch" href="/assets/js/149.9291cd1d.js"><link rel="prefetch" href="/assets/js/15.16f4b9c1.js"><link rel="prefetch" href="/assets/js/150.6bf9657f.js"><link rel="prefetch" href="/assets/js/151.5ba13642.js"><link rel="prefetch" href="/assets/js/152.3f4f4ca8.js"><link rel="prefetch" href="/assets/js/153.b93c66a6.js"><link rel="prefetch" href="/assets/js/154.a398d903.js"><link rel="prefetch" href="/assets/js/155.63f86958.js"><link rel="prefetch" href="/assets/js/156.54044f43.js"><link rel="prefetch" href="/assets/js/157.f0e2bcb3.js"><link rel="prefetch" href="/assets/js/158.5b91c0e7.js"><link rel="prefetch" href="/assets/js/159.ab5444bc.js"><link rel="prefetch" href="/assets/js/16.c616e2b6.js"><link rel="prefetch" href="/assets/js/160.2530c91d.js"><link rel="prefetch" href="/assets/js/161.1df05a75.js"><link rel="prefetch" href="/assets/js/162.dad7fc47.js"><link rel="prefetch" href="/assets/js/163.b2d75a8a.js"><link rel="prefetch" href="/assets/js/164.4b49bb3c.js"><link rel="prefetch" href="/assets/js/165.ac1b34cb.js"><link rel="prefetch" href="/assets/js/166.00826470.js"><link rel="prefetch" href="/assets/js/167.e152507a.js"><link rel="prefetch" href="/assets/js/168.e668c315.js"><link rel="prefetch" href="/assets/js/169.c0832495.js"><link rel="prefetch" href="/assets/js/17.c15fd290.js"><link rel="prefetch" href="/assets/js/170.265153fd.js"><link rel="prefetch" href="/assets/js/171.362c431d.js"><link rel="prefetch" href="/assets/js/172.5e1589e8.js"><link rel="prefetch" href="/assets/js/173.7d1fef7b.js"><link rel="prefetch" href="/assets/js/174.e7293e4a.js"><link rel="prefetch" href="/assets/js/175.b28bdea7.js"><link rel="prefetch" href="/assets/js/176.c2d7977b.js"><link rel="prefetch" href="/assets/js/177.377eb895.js"><link rel="prefetch" href="/assets/js/178.1fa90333.js"><link rel="prefetch" href="/assets/js/179.68c5de48.js"><link rel="prefetch" href="/assets/js/18.db4a03ec.js"><link rel="prefetch" href="/assets/js/180.acb281b9.js"><link rel="prefetch" href="/assets/js/181.2be18ec9.js"><link rel="prefetch" href="/assets/js/182.bc60d6b6.js"><link rel="prefetch" href="/assets/js/183.f2919036.js"><link rel="prefetch" href="/assets/js/184.b38aec29.js"><link rel="prefetch" href="/assets/js/185.9a669ac8.js"><link rel="prefetch" href="/assets/js/186.e779fe45.js"><link rel="prefetch" href="/assets/js/187.468bfbe8.js"><link rel="prefetch" href="/assets/js/188.20d2e93c.js"><link rel="prefetch" href="/assets/js/189.42db30b7.js"><link rel="prefetch" href="/assets/js/19.d3b9b0a8.js"><link rel="prefetch" href="/assets/js/190.dea239ec.js"><link rel="prefetch" href="/assets/js/191.ccf9ae83.js"><link rel="prefetch" href="/assets/js/192.e2d30cca.js"><link rel="prefetch" href="/assets/js/193.62867c3e.js"><link rel="prefetch" href="/assets/js/194.13629983.js"><link rel="prefetch" href="/assets/js/195.4b68f3a0.js"><link rel="prefetch" href="/assets/js/196.ff59e8f6.js"><link rel="prefetch" href="/assets/js/197.15e020f7.js"><link rel="prefetch" href="/assets/js/198.4ea70ef4.js"><link rel="prefetch" href="/assets/js/199.56f0c110.js"><link rel="prefetch" href="/assets/js/20.c35dcf39.js"><link rel="prefetch" href="/assets/js/200.78dd9f28.js"><link rel="prefetch" href="/assets/js/201.91a68593.js"><link rel="prefetch" href="/assets/js/202.8a14b96a.js"><link rel="prefetch" href="/assets/js/203.a23a704a.js"><link rel="prefetch" href="/assets/js/204.dab38ee5.js"><link rel="prefetch" href="/assets/js/21.e43c696c.js"><link rel="prefetch" href="/assets/js/22.393983f9.js"><link rel="prefetch" href="/assets/js/23.e302c532.js"><link rel="prefetch" href="/assets/js/24.f4df4e7f.js"><link rel="prefetch" href="/assets/js/25.85aee522.js"><link rel="prefetch" href="/assets/js/26.f3d4bc2d.js"><link rel="prefetch" href="/assets/js/27.03f420d3.js"><link rel="prefetch" href="/assets/js/28.c8ad758a.js"><link rel="prefetch" href="/assets/js/29.acb65439.js"><link rel="prefetch" href="/assets/js/3.753236a7.js"><link rel="prefetch" href="/assets/js/30.fc1f5f5c.js"><link rel="prefetch" href="/assets/js/31.77e58103.js"><link rel="prefetch" href="/assets/js/32.5ef2f040.js"><link rel="prefetch" href="/assets/js/33.fc4584e7.js"><link rel="prefetch" href="/assets/js/34.71ca5ff9.js"><link rel="prefetch" href="/assets/js/35.bd5aae58.js"><link rel="prefetch" href="/assets/js/36.124f8c76.js"><link rel="prefetch" href="/assets/js/38.61d0edc2.js"><link rel="prefetch" href="/assets/js/39.7921a116.js"><link rel="prefetch" href="/assets/js/4.fdb5e485.js"><link rel="prefetch" href="/assets/js/40.b389d659.js"><link rel="prefetch" href="/assets/js/41.0a58c3f1.js"><link rel="prefetch" href="/assets/js/42.e7961d9e.js"><link rel="prefetch" href="/assets/js/43.af113228.js"><link rel="prefetch" href="/assets/js/44.7560b6a3.js"><link rel="prefetch" href="/assets/js/45.4291ebfa.js"><link rel="prefetch" href="/assets/js/46.65a6b698.js"><link rel="prefetch" href="/assets/js/47.2eb4574c.js"><link rel="prefetch" href="/assets/js/48.b0c68533.js"><link rel="prefetch" href="/assets/js/49.020f0482.js"><link rel="prefetch" href="/assets/js/5.29130c00.js"><link rel="prefetch" href="/assets/js/50.b7cb1a11.js"><link rel="prefetch" href="/assets/js/51.efe2b5f7.js"><link rel="prefetch" href="/assets/js/52.a96f1076.js"><link rel="prefetch" href="/assets/js/53.95f7bac7.js"><link rel="prefetch" href="/assets/js/54.476274a8.js"><link rel="prefetch" href="/assets/js/55.41919574.js"><link rel="prefetch" href="/assets/js/56.beb74e07.js"><link rel="prefetch" href="/assets/js/57.705bc19e.js"><link rel="prefetch" href="/assets/js/58.f5fd656b.js"><link rel="prefetch" href="/assets/js/59.04bd0a11.js"><link rel="prefetch" href="/assets/js/6.192ba4c2.js"><link rel="prefetch" href="/assets/js/60.df29a101.js"><link rel="prefetch" href="/assets/js/61.061546fa.js"><link rel="prefetch" href="/assets/js/62.b733d1a1.js"><link rel="prefetch" href="/assets/js/63.926cae9b.js"><link rel="prefetch" href="/assets/js/64.54761bdd.js"><link rel="prefetch" href="/assets/js/65.f2c05d04.js"><link rel="prefetch" href="/assets/js/66.c50ec6bd.js"><link rel="prefetch" href="/assets/js/67.3f1e9d42.js"><link rel="prefetch" href="/assets/js/68.e6d72026.js"><link rel="prefetch" href="/assets/js/69.2de511ae.js"><link rel="prefetch" href="/assets/js/7.162225cc.js"><link rel="prefetch" href="/assets/js/70.65ac284e.js"><link rel="prefetch" href="/assets/js/71.a21ab478.js"><link rel="prefetch" href="/assets/js/72.1da0eaf9.js"><link rel="prefetch" href="/assets/js/73.fcfaf581.js"><link rel="prefetch" href="/assets/js/74.8edbd39c.js"><link rel="prefetch" href="/assets/js/75.70f5ea97.js"><link rel="prefetch" href="/assets/js/76.557c0bb2.js"><link rel="prefetch" href="/assets/js/77.9ce82f4b.js"><link rel="prefetch" href="/assets/js/78.0d809ae3.js"><link rel="prefetch" href="/assets/js/79.a9b07316.js"><link rel="prefetch" href="/assets/js/8.a12bb62b.js"><link rel="prefetch" href="/assets/js/80.fdc72255.js"><link rel="prefetch" href="/assets/js/81.beb8303a.js"><link rel="prefetch" href="/assets/js/82.0cb6ec59.js"><link rel="prefetch" href="/assets/js/83.0f3e946b.js"><link rel="prefetch" href="/assets/js/84.2e2f1d80.js"><link rel="prefetch" href="/assets/js/85.d850d4dd.js"><link rel="prefetch" href="/assets/js/86.32d87d56.js"><link rel="prefetch" href="/assets/js/87.5f97a4f6.js"><link rel="prefetch" href="/assets/js/88.f5b0bbdb.js"><link rel="prefetch" href="/assets/js/89.9f9150f5.js"><link rel="prefetch" href="/assets/js/9.0d992d03.js"><link rel="prefetch" href="/assets/js/90.f69286ce.js"><link rel="prefetch" href="/assets/js/91.cd415cf2.js"><link rel="prefetch" href="/assets/js/92.30ee9be1.js"><link rel="prefetch" href="/assets/js/93.9fc6f609.js"><link rel="prefetch" href="/assets/js/94.3d6138bf.js"><link rel="prefetch" href="/assets/js/95.d6a20d18.js"><link rel="prefetch" href="/assets/js/96.afb03bd8.js"><link rel="prefetch" href="/assets/js/97.14206eba.js"><link rel="prefetch" href="/assets/js/98.0d5b3805.js"><link rel="prefetch" href="/assets/js/99.d81e6ba7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ad4900be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yan's Blog Home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据和分布式系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统理论</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式协调服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据摄取 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据流 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据存储 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据处理 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据分析 Layer (OLAP)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统基础框架Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data Platform - Splunk</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Data Platform - ELK</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BigDataAndDistributedSystem/ELK/" class="sidebar-link">Data Platform - ELK</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-base.html" class="sidebar-link">ES 概念与总结</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-cluster.html" class="sidebar-link">ES 原理-分布式特性</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-index.html" class="sidebar-link">ES 原理-倒排索引</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-AnalysisAndRelated.html" class="sidebar-link">ES 原理-分词器 &amp; 搜索相关性</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-basicoperation.html" class="sidebar-link">ES Index-基本操作与并发</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html" class="active sidebar-link">ES Index-Mapping &amp; Setting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#es-mapping" class="sidebar-link">ES Mapping</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#什么是-mapping？" class="sidebar-link">什么是 Mapping？</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#mapping-设置" class="sidebar-link">Mapping 设置</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#字段数据类型" class="sidebar-link">字段数据类型</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#什么是-dynamic-mapping？" class="sidebar-link">什么是 Dynamic Mapping？</a></li></ul></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#index-modules" class="sidebar-link">Index modules</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#index-settings" class="sidebar-link">Index Settings</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html#settings-in-other-index-modules" class="sidebar-link">Settings in other index modules</a></li></ul></li></ul></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html" class="sidebar-link">ES Index-Index Template</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-TextAnalysis.html" class="sidebar-link">ES Index-Text Analysis</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IngestAndScript.html" class="sidebar-link">ES Index-Ingest|Script</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESUsage-crud.html" class="sidebar-link">ES 使用-基本CRUD</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESSearch-search.html" class="sidebar-link">ES 搜索-搜索相关</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESSearch-queryDSL.html" class="sidebar-link">ES 搜索-查询DSL</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESSearch-aggregation.html" class="sidebar-link">ES 搜索-聚合</a></li></ul></section></li><li><a href="/index/" class="sidebar-link">&lt; 首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default" data-v-06e88026 data-v-06e88026><h1 id="es-index-mapping-setting" data-v-06e88026><a href="#es-index-mapping-setting" class="header-anchor" data-v-06e88026>#</a> ES Index-Mapping &amp; Setting</h1> <h2 id="es-mapping" data-v-06e88026><a href="#es-mapping" class="header-anchor" data-v-06e88026>#</a> ES Mapping</h2> <div class="custom-block tip" data-v-06e88026><p class="custom-block-title" data-v-06e88026>转载</p> <ul data-v-06e88026><li data-v-06e88026><a href="https://www.cnblogs.com/wupeixuan/p/12514843.html" target="_self" rel="noopener noreferrer" data-v-06e88026>一文搞懂 Elasticsearch 之 Mapping</a></li></ul></div> <p data-v-06e88026>这篇文章主要介绍 Mapping、Dynamic Mapping 以及 ElasticSearch 是如何自动判断字段的类型，同时介绍 Mapping 的相关参数设置。首先来看下什么是 Mapping：</p> <h3 id="什么是-mapping？" data-v-06e88026><a href="#什么是-mapping？" class="header-anchor" data-v-06e88026>#</a> 什么是 Mapping？</h3> <p data-v-06e88026>Mapping 类似于数据库中的表结构定义 <code data-v-06e88026>schema</code>，它有以下几个作用：</p> <ul data-v-06e88026><li data-v-06e88026><strong data-v-06e88026>定义索引中的字段的名称</strong></li> <li data-v-06e88026><strong data-v-06e88026>定义字段的数据类型</strong>，比如字符串、数字、布尔</li> <li data-v-06e88026><strong data-v-06e88026>字段，倒排索引的相关配置</strong>，比如设置某个字段为不被索引、记录 position 等</li></ul> <p data-v-06e88026>在 ES 早期版本，一个索引下是可以有多个 Type 的，从 7.0 开始，一个索引只有一个 Type，也可以说一个 Type 有一个 Mapping 定义。在了解了什么是 Mapping 之后，接下来对 Mapping 的设置做下介绍：</p> <h3 id="mapping-设置" data-v-06e88026><a href="#mapping-设置" class="header-anchor" data-v-06e88026>#</a> Mapping 设置</h3> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>PUT users
<span class="token punctuation" data-v-06e88026>{</span>
	<span class="token property" data-v-06e88026>&quot;mappings&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
		<span class="token property" data-v-06e88026>&quot;_doc&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
			<span class="token property" data-v-06e88026>&quot;dynamic&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token boolean" data-v-06e88026>false</span>
		<span class="token punctuation" data-v-06e88026>}</span>
	<span class="token punctuation" data-v-06e88026>}</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026><span class="line-number" data-v-06e88026>7</span><br data-v-06e88026><span class="line-number" data-v-06e88026>8</span><br data-v-06e88026></div></div><p data-v-06e88026>在创建一个索引的时候，可以对 <code data-v-06e88026>dynamic</code> 进行设置，可以设成 <code data-v-06e88026>false</code>、<code data-v-06e88026>true</code> 或者 <code data-v-06e88026>strict</code>。</p> <div style="display:flex;" data-v-06e88026><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiIAAADWCAMAAADb9hk+AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABFUExURUdwTGxsdJ2domJicZ+fpJ+fooCAgNDQ0ZiYnKqqqv////r6+r6+wOHh4rS0t/T09Orq6xcXF9DQ0F9fX5KSknx8fKSkpOvYwCEAAAAKdFJOUwAiqCHJyQQBsgPcfdlqAAARvElEQVR42uxdiZajuA7t6TnzZhpZlvf//9QnGQgOWXECnarWTU4lxWKwuFxJLqz68UOhUCgUCoVCoVAoFAqFQqFQKBQKhUKhUCgUCoVCoVAoFAqFQqFQKBQKhUKhUCgUCoVCoVAoFAqFQqFQKBQKhaIb//5SfFe8iSF6kyju4tePv/757wPx8+fxh/xm/eGDvkUB/vfvPwR3Xw9W7/RCA0cf0+7bn+F4I9q/3kKRH/8RDAKo7+nH0HyDGz8vP9tvt5dcW3+xFZv0yjZwcR6wbgtW34Yry+DyHGAAC5dGgKt9gdu9hxt9lv7AxYldb3K9HdwxGFxdP52I/fs9FPlJ1UCrE4C5s3CjB3Dls90ZLtZdf53aPV/MJl23cZuo7XbD6htcJcjlOTBFaLgwwrr9yzNZH+dqb2CiPKwsfL3J9XbXTmI46+ilESreRZH/aPhAnKnIIWgo8i36IxR5l6MBUIrMjkYpoiqiKqIq0g1SFVEVURVRFXmRIqoiqiKqIn+mirzr7OkuRV410tspAqoiH+VoXPZ+dUK2HNgfjAiqIqtb5HmThrC7o4GY8fwwMKS8F0UuNmVr+ItOGqcq8iyZcrrLcXi2nTsUcfMVahpL6epfel6mCAzFX5w9EKyOQd487prGIiNyeZeKwG2K4MWy/VTEPNWyD6oiz13XnH3MMfAd5TK5LLe2tSLNWW64kmOhpylCN3xelGNkEfbAn2G616cLaeZFmHI0/Y7TZGmH243R52ilwQyY06gZeXQrVGIu3DFXTyk6VZGnIpGYg5GbHL3xWZQgZ7Z08MT8ibL66Yzmhh3IWF+CYQLJZ5oUpaoIDMabUGQR+oTGm97+GG+ndgKfde1Q4A6lcTfkNZUZvMpHGIg/SgikKvIUUpq9gXfLAuRfjJg8+PCSioyOf6SFCXydvK1BwKQiKcrF5NU5rsKILf3h6JcvvLQDokswxaieWk8HTFEUUatL/RM5jqrIHK6OcRtOtzCkNKlI8iza8Zm47m4sMiYU4zFsit62KhJ8LsJBkiPFmaXb+1PbGZ80sXHaZT7qqCIMVsT5YsGyUlXk2XD1FFNOFHF8ZyI65+BlFZkzmuKTRT8+7DTHIq4wE5GFppBzRN39GduRlm2cnkJa+OZGzcj1mLVDx1Lki4+LjBFdY9G6ILOKWC89S/hiLHK6icdEc1aR8bDByeXiRVF+d4l6VURO3pdWRcLJz8yxSPVjrpIDNKN5niLWOycSjbN35qiPivhx8hld8vgWFZEEyScX8hSLTElv9o5QKBJYRtDH3v5kPulRoCR6IolEcTnzSUUcn4DLlfjsdAjxD1aRLbEIJV+vDM45IHFCWJwEdTJuHvHJ0bM7KnIKVznasFMeWtIU+fCyOopmOBJJ0NufpR1O1fmrkwybmgH46dP7Kf91/LU86JqqyGzdieN0spcMRkK76kUVWbZxsJoY0I583jvY4/6c2uFvY/y0dGj52hwECFRF3hTXvDy6+lH92QBVkTeHyC8/LwLfliL61NmjWERVRFXkPSoyqIp8Z4roPBpVEVURVRGliKqIUkRVRDMaVRFVka9JkZ80fJyMwDdTkaleytd1NKoio0HV0dyodfZTHrv5OARDBx8RLX6r/jDe5miMsXZ+L69m0bWvd5fdeT/zG7+MLRsbfv1dbp9ca56nrNFYce7Pdls9eD+2dfn163/f1tGAVgZ4i6P5pRnNF8lo4HdR5F8dF1EV0XERHRfR0dU/YlxEVURVRFVEYxFVEaWIqshBKrJqCtaT1+FzTaqxyCsqguZ8G6qTIOGJuy5eTCusO4UEu5oUDlIRUBWZL2v25+aLdepztmfmci6EUFKMzeJkTWg3QRsz74ne7WlSytRDkc3EcnlfVYSXOH+kisiEWTgrK1lwrIkxicJgEqMUm7wNGML8/y9CiqV1NWTtWHfnsW1fokiIx6iIyfuqiJ1mcPZ16OBYhEyK2Z0oU5yoSLFzKT9ApKuOhfvoDLZkK1SLTu0qzMl2xSJbKQI57EsRmuYPP11G5zepCKF4DxtcM4W0WMRExQzZLFNMg3FDCvO/1SFkObFZ/ozsZ80g58Ybw+0ai0DELhXZquYuun0pMhXCwE6GHKYixhp0rdGdKZHvnxJsCCcblWSKL0KRWewTuxxPDgfM893mmGm1IZf2VJE+Wd7uaDb4me5YJKaqIR8ei3A0AbE5S45KazWuoRh3KhArOUp0UE7bZawhC9NmKRNEMzP2pAj0+ZkOiuSwfxIPmRW8d1jisFiEMlI828b4wG7FpmLzFIsMmJyNBGVREYAUTRub1I1MzZ93VRHYoP/94yIcUEXaWUXGYmqp2xIHZjSlnEkq5pIK1QA1zGUkIRkp8ljaG4vI4llIF6MJtVgT7kQREu0KGfZWkcqOLX6msz9SnsvE8tsp8khFYKCpeNNp1ME6kuAzmKWG8Wjf1Foi5GxCWQSIpKpsDWj3okjJfO1Kn0k3hKtUJN/PYW+KQC2hRd5+vIoMia/1afwGOONNUmcppRIaRzKFJ+1uJVxqca5ldHfKaEjGarrymU0qwjdVLLTJn/X1x3mJQ8ibD1cRGe1y8VQLUAREhkjqXqthTEhnY6myPqyKCDJpAHC/cZEYc9+OG2MRHzfFCF39qXX2anlE+8EqQqHIUKqUnk0Gp6ER4uvsMNiUz/9PSrA+NIMnTBeWm9QM3lOwNVAI+42uul5Z3pjRbBys6OqPKbO/SfC5KkI0jQGT9T5PVpRozRRrEFcV2XLzt5cQmREiN23hUzPm+GY/FYGAvRTZdhmM250ir+J3Pi9yu6J+Sy5mh18/HTBeP2c/z6T6vMjRT52No/Dh65hUnxfRp85URT7y2VX4ShRRFVEVURXRJ+Bfi0WUIqoi6mhURdTRqIooRVRFdFxEVURV5OtRRCsm7q8i8NUdjarIaFB1NLfL4X0grD38kOWb9Yd79C6KoMOPgwv28LOy36w/6DSj0aGzR47mb81oNKP5Y8dFtNaZjouoiqiKaCyiKnLHSTTf6f56VZFvoyIhuUfX+XojN2asIX6aSUEp8pqKSM0qco09U5b5mrmsH3AnDMY2dEqBzsmFRWbahH0LWYEhVZEjVQSZDWitzcu8usDqYCLmefZsCMwMW1KOKaV8mheEJuZ2fh7ZYrzM8cWHk+pfq3XmO6720xkNhHFuu8wt2pciIZzO7aNVhKKVSf802LmMAVlTnc9w4gyWYgI6cOeFrFydrdlY3tFQEHYvZGV76i08ryLB48iRDXM2+ygyFZ/hA8Enq0hJ9c5xUgliJg26MIQiU3vp3J8vVVlkujJRDoa1pS1xlJafe1EEcuiiyLOXAcRPcve2zOrtqwyAIxl7pykfpSLMB/YPpZ3CmnIJg+V3zrOVWGiSt5BOc3pdMsZ4w9KCft7XJVvs+GXPWmcYaVcVgVFH4pY6Jp3FI/hA0M2Qw1SEBilXVVpvmNhAYCQ6PRWpKtlJjYMl8pAyEsEOpQCyC5qamosu7lvIqsvPbBldhcF43HbheqsUMUdyL0OOHReRC044Xmpg35MMJzSpqeSBhQORsRrAtIcEL67kNnVxZcqL9nU0sWua6JaMZnt9qV6KMEe6GXJgrTOHIUdJV8ZcBapWyN/Om9SVsi2FmnJ4Mv8/2AIBliUlmlQLP+9GEfFzLnYWstqyW4rRDbA7RaYDfbSKIOewhVOaGNqyqxx5DMZRW7wy0EyeZllxIcYmN2KPlW0tZLVPLGLk3u7zM9vGRVj8rd+/SpEcCMyUQH2qisBclpmW4TETpWQI2VRWpw7nhayyLxFpKUojZYukkNVutc5Ysjhkzn3lCLb8pbeGB9bvXzExScX8bWT8PbGI1PZyS7JeIo7llcqwjHrANJrasIbZlWE91j7WOtttXMR52+dntqiIMIQPYnev3pzGvlhPH6wis/2WyBTc6E4oc9R6viuyK2kiOtaL5EYinbIjjGMhq/+3dyXajeJAcHbfZveFbt3H/3/qdgvsADNODBEOcarmeDbGxrRKpZYslQ5L7zjs9KC8NxeRHtNYcEQ1HUsRvdDIkXR2FfFSOWnJF8/KE2lK5jtFmDRrNn0yJBQZ3OyYaGZt7DlwJ4kch4NVxLu3wBxKEX/9fE8nVxFflj2v4qbfal0tdR6medFHHlzWVtS7+eBqOyEeOS6yc9oHnAE+tR+ND2Y5mnb71GUf9AYVyJ8vpJhS1HnW2dEz1TCl6FupyFcAFPn2KvJ8FMEMeKgIVAQqgnQVKgIVgYogF4GK3N2lfi4VIagIcpFzqkgvZwBP7nSgyI/+Vt76p7ofQTeXIntK1Ce7Yv2KGPZraM4HFeb1ofdO//iUP3/U7JH+jHfP9YYPHg933s+tSw2fCdviCTq9yEUel66CIhgXgUsRxkXQ0EBFMC6CXOTnqghBRX6uirSQ+98Dv5yWaP+47Aq5yClVpPWlh36MabYTcbHYhHzknJbbyNe2T0HN/UK6SxCgIneoSFvuaNKH1gv3bmFPUvirFbYm5/me8c36itVowBambiH1YTPNaUMuwheXIl8PpQhFnr6bqydREQ7JEYfwoSQXvmN683SGz6sJ8ynG2bLOaK08i9VQx1pn66HSYybzIBeOpYhcaAw0hXoSFbEhmKEKTzrNb29eE6bEq30NqSdaiT5eblkqonrZULZdhXmXe8T9XmeTk9UWhuxTkYmMPu1cYNhbRdRXRb5RCcvk4SIHNOt70PDbIfkQR8uko4ZClW2hmC+rcNRosVhys8ammsKerZ7PnShidi1v3OJSpEW3ycdqr0uRV47sdDrrryK6VrVUSlXXGNuUWh0xSR61Vd7F5nBZsTvWUpNMTiPBYwrFpnkUuHCU92U3zGuAy6Sn5cmM07EaMUZPnOVwNF1GV/e6FG0ZF6EY4iaG7LwfFaxYyl5R75+L2FSzEYpoVmJNlIZQqktiU9T9TSjj6tQI6ytalVJ1rI2ISK6TNHRVCyvXKB9T6mwlnzWueL7cM7FxVIy0NXYopltDkwwdqiKPdCmSKJ/HpUhVJCZOUVTEqEyoQKitoxoyTBnT5O81MqVlFC5ZfaSSuFqEKUGsQhNj3jIDz2w5mfi2iDkyJ2uoSjoSFxnQzpCy2+lStNG9mUpJ5gEU2X6ho1VEerxVKaLmRKl1gVvBi6ZSo4UNF4o0fmsDlOzYYvKKIpRrzWxjHPLMg8bGpfuMvmy9KMl6Qf++kNpHuRRJRLaZB33OpYjO4lLEwaUQlSI1VPZqmKlPqFnQrihC42tKEY1YSGEVg2yk+H0duM6TERKVmgfWCjdsddLy5B4NTXQifcsrHDK62vKQTeZBOynS7JD4LC5F2qMRbhj1nW3lnfI4BCCphtCgNTSTv2OacpGmMFYdNV1cOWBwJMttbEmYNnMy8qPByKVYpIUqfmA79FER/cK1HO1SRC0MtKno9t3PFG8O5hQqMlFEdI2GlCK3hiaGFE1SKUmSwU4DHG4c0WkKM+UiJeeF0YjuMlKjjq2zWqJdD0tiwjOfTTIqXaQ24NX0yEU0nAe7FGmNuFzrcJeiS8kkOoOKNHspU+R/N/iSEtesSmFTGyiRznC5dnpHwznTyjqrBW+R5qQsDbnUPdEbY2MjnL7kTLTKIw5vHs+kFnbtl77aq0dTD3cpcvPRoCMp4q6GpP4UKrKM13RQlGLadkgExN/Imqilry6scgA20006a7X8nTdjcKOwLl+3JJneY32/0dVdwC+92+aLXLcLubSCFPjdjkTNG4aSyAvcrar5RSHdMrr60yjyXo/q6pp68V+9dVqM/u6g0ilDillnn5519tjpi5h19l1U5MuAXOQbqsgAFYGK/HSKQEWgIlARqMjnchFQ5LaKnI4j9GRbOX9zl6K/qU0wPNefMaT0wL9TLnLUpxt+fJD7uRS5yZjiVP/e9eM4xNFk7S9ygF/K8OAgcg8VeX19/eufFV6mf/PnH+Flw/GXDe9/Srx0Ouej9778/dpDRV4Vv4AnRQeGNIr8Bwh+/fuEd9SHZxARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPiW+B9hYx21Ur0xlQAAAABJRU5ErkJggg==" alt="" align="left" style="display:block;" data-v-06e88026></div> <p data-v-06e88026>比如一个新的文档，这个文档包含一个字段，当 Dynamic 设置为 <code data-v-06e88026>true</code> 时，这个文档可以被索引进 ES，这个字段也可以被索引，也就是这个字段可以被搜索，Mapping 也同时被更新；当 dynamic 被设置为 <code data-v-06e88026>false</code> 时候，存在新增字段的数据写入，该数据可以被索引，但是新增字段被丢弃；当设置成 <code data-v-06e88026>strict</code> 模式时候，数据写入直接出错。</p> <p data-v-06e88026>另外还有 <code data-v-06e88026>index</code> 参数，用来控制当前字段是否被索引，默认为 <code data-v-06e88026>true</code>，如果设为 <code data-v-06e88026>false</code>，则该字段不可被搜索。参数 <code data-v-06e88026>index_options</code> 用于控制倒排索引记录的内容，有如下 4 种配置：</p> <ul data-v-06e88026><li data-v-06e88026>doc：只记录 <code data-v-06e88026>doc id</code></li> <li data-v-06e88026>freqs：记录 <code data-v-06e88026>doc id</code> 和 <code data-v-06e88026>term frequencies</code></li> <li data-v-06e88026>positions：记录 <code data-v-06e88026>doc id</code>、<code data-v-06e88026>term frequencies</code> 和 <code data-v-06e88026>term position</code></li> <li data-v-06e88026>offsets：记录 <code data-v-06e88026>doc id</code>、<code data-v-06e88026>term frequencies</code>、<code data-v-06e88026>term position</code> 和 <code data-v-06e88026>character offects</code></li></ul> <p data-v-06e88026>另外，<code data-v-06e88026>text</code> 类型默认配置为 <code data-v-06e88026>positions</code>，其他类型默认为 <code data-v-06e88026>doc</code>，记录内容越多，占用存储空间越大。<br data-v-06e88026><code data-v-06e88026>null_value</code> 主要是当字段遇到 <code data-v-06e88026>null</code> 值时的处理策略，默认为 <code data-v-06e88026>NULL</code>，即空值，此时 ES 会默认忽略该值，可以通过设定该值设定字段的默认值，另外只有 KeyWord 类型支持设定 <code data-v-06e88026>null_value</code>。<br data-v-06e88026><code data-v-06e88026>copy_to</code> 作用是将该字段的值复制到目标字段，实现类似 <code data-v-06e88026>_all</code> 的作用，它不会出现在 <code data-v-06e88026>_source</code> 中，只用来搜索。</p> <p data-v-06e88026>除了上述介绍的参数，还有许多参数，大家感兴趣的可以在官方文档中进行查看。在学习了 Mapping 的设置之后，让我们来看下字段的数据类型有哪些吧！</p> <h3 id="字段数据类型" data-v-06e88026><a href="#字段数据类型" class="header-anchor" data-v-06e88026>#</a> 字段数据类型</h3> <p data-v-06e88026>ES 字段类型类似于 MySQL 中的字段类型，ES 字段类型主要有：核心类型、复杂类型、地理类型以及特殊类型，具体的数据类型如下图所示：</p> <div style="display:flex;" data-v-06e88026><img src="/assets/img/es-concepts-base-6-2.220060f5.png" alt="" align="left" style="display:block;" data-v-06e88026></div> <br data-v-06e88026> <h4 id="核心类型" data-v-06e88026><a href="#核心类型" class="header-anchor" data-v-06e88026>#</a> 核心类型</h4> <p data-v-06e88026>从图中可以看出核心类型可以划分为字符串类型、数字类型、日期类型、布尔类型、基于 BASE64 的二进制类型、范围类型。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>字符串类型</strong></u></p> <p data-v-06e88026>其中，在 ES 7.x 有两种字符串类型：<code data-v-06e88026>text</code> 和 <code data-v-06e88026>keyword</code>，在 ES 5.x 之后 <code data-v-06e88026>string</code> 类型已经不再支持了。</p> <p data-v-06e88026><code data-v-06e88026>text</code> 类型适用于需要被全文检索的字段，例如新闻正文、邮件内容等比较长的文字，<code data-v-06e88026>text</code> 类型会被 Lucene 分词器（Analyzer）处理为一个个词项，并使用 Lucene 倒排索引存储，<strong data-v-06e88026>text 字段不能被用于排序</strong>，如果需要使用该类型的字段只需要在定义映射时指定 JSON 中对应字段的 <code data-v-06e88026>type</code> 为 <code data-v-06e88026>text</code>。</p> <p data-v-06e88026><code data-v-06e88026>keyword</code> 适合简短、结构化字符串，例如主机名、姓名、商品名称等，<strong data-v-06e88026>可以用于过滤、排序、聚合检索，也可以用于精确查询</strong>。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>数字类型</strong></u></p> <p data-v-06e88026>数字类型分为 <code data-v-06e88026>long、integer、short、byte、double、float、half_float、scaled_float</code>。</p> <p data-v-06e88026>数字类型的字段在满足需求的前提下应当尽量选择范围较小的数据类型，字段长度越短，搜索效率越高，对于浮点数，可以优先考虑使用 <code data-v-06e88026>scaled_float</code> 类型，该类型可以通过缩放因子来精确浮点数，例如 12.34 可以转换为 1234 来存储。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>日期类型</strong></u></p> <p data-v-06e88026>在 ES 中日期可以为以下形式：</p> <ul data-v-06e88026><li data-v-06e88026>格式化的日期字符串，例如 2020-03-17 00:00、2020/03/17</li> <li data-v-06e88026>时间戳（和 1970-01-01 00:00:00 UTC 的差值），单位毫秒或者秒</li></ul> <blockquote data-v-06e88026><p data-v-06e88026>即使是格式化的日期字符串，ES 底层依然采用的是时间戳的形式存储。</p></blockquote> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>布尔类型</strong></u></p> <p data-v-06e88026>JSON 文档中同样存在布尔类型，不过 JSON 字符串类型也可以被 ES 转换为布尔类型存储，前提是字符串的取值为 <code data-v-06e88026>true</code> 或者 <code data-v-06e88026>false</code>，布尔类型常用于检索中的过滤条件。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>二进制类型</strong></u></p> <p data-v-06e88026>二进制类型 <code data-v-06e88026>binary</code> 接受 BASE64 编码的字符串，默认 <code data-v-06e88026>store</code> 属性为 <code data-v-06e88026>false</code>，并且不可以被搜索。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>范围类型</strong></u></p> <p data-v-06e88026>范围类型可以用来表达一个数据的区间，可以分为5种：<code data-v-06e88026>integer_range、float_range、long_range、double_range</code> 以及 <code data-v-06e88026>date_range</code>。</p> <h4 id="复杂类型" data-v-06e88026><a href="#复杂类型" class="header-anchor" data-v-06e88026>#</a> 复杂类型</h4> <p data-v-06e88026>复合类型主要有对象类型（object）和嵌套类型（nested）：</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>对象类型</strong></u></p> <p data-v-06e88026>JSON 字符串允许嵌套对象，一个文档可以嵌套多个、多层对象。可以通过对象类型来存储二级文档，不过由于 Lucene 并没有内部对象的概念，ES 会将原 JSON 文档扁平化，例如文档：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>Copy<span class="token punctuation" data-v-06e88026>{</span>
	<span class="token property" data-v-06e88026>&quot;name&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
		<span class="token property" data-v-06e88026>&quot;first&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;wu&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
		<span class="token property" data-v-06e88026>&quot;last&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;px&quot;</span>
	<span class="token punctuation" data-v-06e88026>}</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026></div></div><p data-v-06e88026>实际上 ES 会将其转换为以下格式，并通过 Lucene 存储，即使 <code data-v-06e88026>name</code> 是 <code data-v-06e88026>object</code> 类型：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>Copy<span class="token punctuation" data-v-06e88026>{</span>
	<span class="token property" data-v-06e88026>&quot;name.first&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;wu&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
	<span class="token property" data-v-06e88026>&quot;name.last&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;px&quot;</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026></div></div><p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>嵌套类型</strong></u></p> <p data-v-06e88026>嵌套类型可以看成是一个特殊的对象类型，可以让对象数组独立检索，例如文档：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>Copy<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;group&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;users&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;username&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>[</span>
	<span class="token punctuation" data-v-06e88026>{</span> <span class="token property" data-v-06e88026>&quot;first&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;wu&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token property" data-v-06e88026>&quot;last&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;px&quot;</span><span class="token punctuation" data-v-06e88026>}</span><span class="token punctuation" data-v-06e88026>,</span>
	<span class="token punctuation" data-v-06e88026>{</span> <span class="token property" data-v-06e88026>&quot;first&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;hu&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token property" data-v-06e88026>&quot;last&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;xy&quot;</span><span class="token punctuation" data-v-06e88026>}</span><span class="token punctuation" data-v-06e88026>,</span>
	<span class="token punctuation" data-v-06e88026>{</span> <span class="token property" data-v-06e88026>&quot;first&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;wu&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token property" data-v-06e88026>&quot;last&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;mx&quot;</span><span class="token punctuation" data-v-06e88026>}</span>
  <span class="token punctuation" data-v-06e88026>]</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026><span class="line-number" data-v-06e88026>7</span><br data-v-06e88026><span class="line-number" data-v-06e88026>8</span><br data-v-06e88026></div></div><p data-v-06e88026><code data-v-06e88026>username</code> 字段是一个 JSON 数组，并且每个数组对象都是一个 JSON 对象。如果将 <code data-v-06e88026>username</code> 设置为对象类型，那么 ES 会将其转换为：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>Copy<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;group&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;users&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;username.first&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>[</span><span class="token string" data-v-06e88026>&quot;wu&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token string" data-v-06e88026>&quot;hu&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token string" data-v-06e88026>&quot;wu&quot;</span><span class="token punctuation" data-v-06e88026>]</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;username.last&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>[</span><span class="token string" data-v-06e88026>&quot;px&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token string" data-v-06e88026>&quot;xy&quot;</span><span class="token punctuation" data-v-06e88026>,</span> <span class="token string" data-v-06e88026>&quot;mx&quot;</span><span class="token punctuation" data-v-06e88026>]</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026></div></div><p data-v-06e88026>可以看出转换后的 JSON 文档中 <code data-v-06e88026>first</code> 和 <code data-v-06e88026>last</code> 的关联丢失了，如果尝试搜索 <code data-v-06e88026>first</code> 为 <code data-v-06e88026>wu</code>，<code data-v-06e88026>last</code> 为 <code data-v-06e88026>xy</code> 的文档，那么成功会检索出上述文档，但是 <code data-v-06e88026>wu</code> 和 <code data-v-06e88026>xy</code> 在原 JSON 文档中并不属于同一个 JSON 对象，应当是不匹配的，即检索不出任何结果。</p> <p data-v-06e88026>嵌套类型就是为了解决这种问题的，嵌套类型将数组中的每个 JSON 对象作为独立的隐藏文档来存储，每个嵌套的对象都能够独立地被搜索，所以上述案例中虽然表面上只有 1 个文档，但实际上是存储了 4 个文档。</p> <h4 id="地理类型" data-v-06e88026><a href="#地理类型" class="header-anchor" data-v-06e88026>#</a> 地理类型</h4> <p data-v-06e88026>地理类型字段分为两种：经纬度类型和地理区域类型：</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>经纬度类型</strong></u></p> <p data-v-06e88026>经纬度类型字段（geo_point）可以存储经纬度相关信息，通过地理类型的字段，可以用来实现诸如查找在指定地理区域内相关的文档、根据距离排序、根据地理位置修改评分规则等需求。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>地理区域类型</strong></u></p> <p data-v-06e88026>经纬度类型可以表达一个点，而 <code data-v-06e88026>geo_shape</code> 类型可以表达一块地理区域，区域的形状可以是任意多边形，也可以是点、线、面、多点、多线、多面等几何类型。</p> <h4 id="特殊类型" data-v-06e88026><a href="#特殊类型" class="header-anchor" data-v-06e88026>#</a> 特殊类型</h4> <p data-v-06e88026>特殊类型包括 IP 类型、过滤器类型、Join 类型、别名类型等，在这里简单介绍下 IP 类型和 Join 类型，其他特殊类型可以查看官方文档。</p> <p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>IP 类型</strong></u></p> <p data-v-06e88026>IP 类型的字段可以用来存储 IPv4 或者 IPv6 地址，如果需要存储 IP 类型的字段，需要手动定义映射：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>Copy<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;mappings&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
	<span class="token property" data-v-06e88026>&quot;properties&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
	  <span class="token property" data-v-06e88026>&quot;my_ip&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
	    <span class="token property" data-v-06e88026>&quot;type&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;ip&quot;</span>
	  <span class="token punctuation" data-v-06e88026>}</span>
	<span class="token punctuation" data-v-06e88026>}</span>
  <span class="token punctuation" data-v-06e88026>}</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026><span class="line-number" data-v-06e88026>7</span><br data-v-06e88026><span class="line-number" data-v-06e88026>8</span><br data-v-06e88026><span class="line-number" data-v-06e88026>9</span><br data-v-06e88026></div></div><p data-v-06e88026><u data-v-06e88026><strong data-v-06e88026>Join 类型</strong></u></p> <p data-v-06e88026>Join 类型是 ES 6.x 引入的类型，以取代淘汰的 <code data-v-06e88026>_parent</code> 元字段，用来实现文档的一对一、一对多的关系，主要用来做父子查询。</p> <p data-v-06e88026>Join 类型的 Mapping 如下：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>CopyPUT my_index
<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;mappings&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
    <span class="token property" data-v-06e88026>&quot;properties&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
      <span class="token property" data-v-06e88026>&quot;my_join_field&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span> 
        <span class="token property" data-v-06e88026>&quot;type&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;join&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
        <span class="token property" data-v-06e88026>&quot;relations&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
          <span class="token property" data-v-06e88026>&quot;question&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;answer&quot;</span> 
        <span class="token punctuation" data-v-06e88026>}</span>
      <span class="token punctuation" data-v-06e88026>}</span>
    <span class="token punctuation" data-v-06e88026>}</span>
  <span class="token punctuation" data-v-06e88026>}</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026><span class="line-number" data-v-06e88026>7</span><br data-v-06e88026><span class="line-number" data-v-06e88026>8</span><br data-v-06e88026><span class="line-number" data-v-06e88026>9</span><br data-v-06e88026><span class="line-number" data-v-06e88026>10</span><br data-v-06e88026><span class="line-number" data-v-06e88026>11</span><br data-v-06e88026><span class="line-number" data-v-06e88026>12</span><br data-v-06e88026><span class="line-number" data-v-06e88026>13</span><br data-v-06e88026></div></div><p data-v-06e88026>其中，<code data-v-06e88026>my_join_field</code> 为 Join 类型字段的名称；<code data-v-06e88026>relations</code> 指定关系：<code data-v-06e88026>question</code> 是 <code data-v-06e88026>answer</code> 的父类。</p> <p data-v-06e88026>例如定义一个 ID 为 1 的父文档：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>CopyPUT my_join_index/<span class="token number" data-v-06e88026>1</span>?refresh
<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;text&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;This is a question&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;my_join_field&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;question&quot;</span> 
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026></div></div><p data-v-06e88026>接下来定义一个子文档，该文档指定了父文档 ID 为 1：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>CopyPUT my_join_index/_doc/<span class="token number" data-v-06e88026>2</span>?routing=<span class="token number" data-v-06e88026>1</span>&amp;refresh 
<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;text&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;This is an answer&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;my_join_field&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>{</span>
    <span class="token property" data-v-06e88026>&quot;name&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;answer&quot;</span><span class="token punctuation" data-v-06e88026>,</span> 
    <span class="token property" data-v-06e88026>&quot;parent&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;1&quot;</span> 
  <span class="token punctuation" data-v-06e88026>}</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026><span class="line-number" data-v-06e88026>7</span><br data-v-06e88026><span class="line-number" data-v-06e88026>8</span><br data-v-06e88026></div></div><p data-v-06e88026>再了解完字段数据类型后，再让我们看下什么是 Dynamic Mapping？</p> <h3 id="什么是-dynamic-mapping？" data-v-06e88026><a href="#什么是-dynamic-mapping？" class="header-anchor" data-v-06e88026>#</a> 什么是 Dynamic Mapping？</h3> <p data-v-06e88026>Dynamic Mapping 机制使我们不需要手动定义 Mapping，ES 会<strong data-v-06e88026>自动根据文档信息来判断字段合适的类型</strong>，但是有时候也会推算的不对，比如地理位置信息有可能会判断为 <code data-v-06e88026>Text</code>，当类型如果设置不对时，会导致一些功能无法正常工作，比如 Range 查询。</p> <h4 id="类型自动识别" data-v-06e88026><a href="#类型自动识别" class="header-anchor" data-v-06e88026>#</a> 类型自动识别</h4> <p data-v-06e88026>ES 类型的自动识别是基于 JSON 的格式，如果输入的是 JSON 是字符串且格式为日期格式，ES 会自动设置成 <code data-v-06e88026>Date</code> 类型；当输入的字符串是数字的时候，ES 默认会当成字符串来处理，可以通过设置来转换成合适的类型；如果输入的是 <code data-v-06e88026>Text</code> 字段的时候，ES 会自动增加 <code data-v-06e88026>keyword</code> 子字段，还有一些自动识别如下图所示：</p> <div style="display:flex;" data-v-06e88026><img src="/assets/img/es-concepts-base-6-3.50d03a51.png" alt="" align="left" style="display:block;" data-v-06e88026></div> <p data-v-06e88026>下面我们通过一个例子是看看是怎么类型自动识别的，输入如下请求，创建索引：</p> <div class="language-json line-numbers-mode" data-v-06e88026><pre class="language-json" data-v-06e88026><code data-v-06e88026>CopyPUT /mapping_test/_doc/<span class="token number" data-v-06e88026>1</span>
<span class="token punctuation" data-v-06e88026>{</span>
  <span class="token property" data-v-06e88026>&quot;uid&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;123&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;username&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;wupx&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;birth&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token string" data-v-06e88026>&quot;2020-03-16&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;married&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token boolean" data-v-06e88026>false</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;age&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token number" data-v-06e88026>18</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;heigh&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token number" data-v-06e88026>180</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;tags&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token punctuation" data-v-06e88026>[</span>
    <span class="token string" data-v-06e88026>&quot;java&quot;</span><span class="token punctuation" data-v-06e88026>,</span>
    <span class="token string" data-v-06e88026>&quot;boy&quot;</span>
  <span class="token punctuation" data-v-06e88026>]</span><span class="token punctuation" data-v-06e88026>,</span>
  <span class="token property" data-v-06e88026>&quot;money&quot;</span><span class="token operator" data-v-06e88026>:</span> <span class="token number" data-v-06e88026>999.9</span>
<span class="token punctuation" data-v-06e88026>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-06e88026><span class="line-number" data-v-06e88026>1</span><br data-v-06e88026><span class="line-number" data-v-06e88026>2</span><br data-v-06e88026><span class="line-number" data-v-06e88026>3</span><br data-v-06e88026><span class="line-number" data-v-06e88026>4</span><br data-v-06e88026><span class="line-number" data-v-06e88026>5</span><br data-v-06e88026><span class="line-number" data-v-06e88026>6</span><br data-v-06e88026><span class="line-number" data-v-06e88026>7</span><br data-v-06e88026><span class="line-number" data-v-06e88026>8</span><br data-v-06e88026><span class="line-number" data-v-06e88026>9</span><br data-v-06e88026><span class="line-number" data-v-06e88026>10</span><br data-v-06e88026><span class="line-number" data-v-06e88026>11</span><br data-v-06e88026><span class="line-number" data-v-06e88026>12</span><br data-v-06e88026><span class="line-number" data-v-06e88026>13</span><br data-v-06e88026><span class="line-number" data-v-06e88026>14</span><br data-v-06e88026></div></div><p data-v-06e88026>然后使用 <code data-v-06e88026>GET /mapping_test/_mapping</code> 可以查看mapping情况。。</p> <p data-v-06e88026>-&gt; 可以从结果中看出，ES 会根据文档信息自动推算出合适的类型。哦豁，万一我想修改 Mapping 的字段类型，能否更改呢？让我们分以下两种情况来探究下。</p> <h4 id="修改-mapping-字段类型？" data-v-06e88026><a href="#修改-mapping-字段类型？" class="header-anchor" data-v-06e88026>#</a> 修改 Mapping 字段类型？</h4> <p data-v-06e88026>如果是新增加的字段，根据 Dynamic 的设置分为以下三种状况：</p> <ul data-v-06e88026><li data-v-06e88026>当 Dynamic 设置为 <code data-v-06e88026>true</code> 时，一旦有新增字段的文档写入，Mapping 也同时被更新。</li> <li data-v-06e88026>当 Dynamic 设置为 <code data-v-06e88026>false</code> 时，索引的 Mapping 是不会被更新的，新增字段的数据无法被索引，也就是无法被搜索，但是信息会出现在 <code data-v-06e88026>_source</code> 中。</li> <li data-v-06e88026>当 Dynamic 设置为 <code data-v-06e88026>strict</code> 时，文档写入会失败。</li></ul> <p data-v-06e88026>另外一种是字段已经存在，这种情况下，ES 是不允许修改字段的类型的，因为 ES 是根据 Lucene 实现的倒排索引，一旦生成后就不允许修改，如果希望改变字段类型，必须使用 Reindex API 重建索引。</p> <p data-v-06e88026>不能修改的原因是如果修改了字段的数据类型，会导致已被索引的无法被搜索，但是如果是增加新的字段，就不会有这样的影响。</p> <h2 id="index-modules" data-v-06e88026><a href="#index-modules" class="header-anchor" data-v-06e88026>#</a> Index modules</h2> <p data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules.html" target="_self" rel="noopener noreferrer" data-v-06e88026>https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules.html</a></p> <p data-v-06e88026><strong data-v-06e88026>官网的”index modules“章节，就是针对index相关的各种维度的设置。</strong></p> <p data-v-06e88026>Index Modules are modules created per index and control all aspects related to an index.</p> <h3 id="index-settings" data-v-06e88026><a href="#index-settings" class="header-anchor" data-v-06e88026>#</a> Index Settings</h3> <p data-v-06e88026>Index level settings can be set per-index. Settings may be:</p> <ul data-v-06e88026><li data-v-06e88026><strong data-v-06e88026>static</strong> <ul data-v-06e88026><li data-v-06e88026>They can only be set at index creation time or on a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-open-close.html" target="_self" rel="noopener noreferrer" data-v-06e88026>closed index</a>.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026>dynamic</strong> <ul data-v-06e88026><li data-v-06e88026>They can be changed on a live index using the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/indices-update-settings.html" target="_self" rel="noopener noreferrer" data-v-06e88026>update-index-settings</a> API.</li></ul></li></ul> <blockquote data-v-06e88026><p data-v-06e88026>Changing static or dynamic index settings on a closed index could result in incorrect settings that are impossible to rectify without deleting and recreating the index.</p></blockquote> <h4 id="static-index-settings" data-v-06e88026><a href="#static-index-settings" class="header-anchor" data-v-06e88026>#</a> <a href="https://github.com/elastic/elasticsearch/edit/7.9/docs/reference/index-modules.asciidoc" target="_self" rel="noopener noreferrer" data-v-06e88026>Static index settings</a></h4> <h4 id="dynamic-index-settings" data-v-06e88026><a href="#dynamic-index-settings" class="header-anchor" data-v-06e88026>#</a> <a href="https://github.com/elastic/elasticsearch/edit/7.9/docs/reference/index-modules.asciidoc" target="_self" rel="noopener noreferrer" data-v-06e88026>Dynamic index settings</a></h4> <h3 id="settings-in-other-index-modules" data-v-06e88026><a href="#settings-in-other-index-modules" class="header-anchor" data-v-06e88026>#</a> Settings in other index modules</h3> <p data-v-06e88026>Other index settings are available in index modules:</p> <ul data-v-06e88026><li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/analysis.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Analysis</a></strong> <ul data-v-06e88026><li data-v-06e88026>Settings to define analyzers, tokenizers, token filters and character filters.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-allocation.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Index shard allocation</a></strong> <ul data-v-06e88026><li data-v-06e88026>Control over where, when, and how shards are allocated to nodes.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-mapper.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Mapping</a></strong> <ul data-v-06e88026><li data-v-06e88026>Enable or disable dynamic mapping for an index.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-merge.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Merging</a></strong> <ul data-v-06e88026><li data-v-06e88026>Control over how shards are merged by the background merge process.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-similarity.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Similarities</a></strong> <ul data-v-06e88026><li data-v-06e88026>Configure custom similarity settings to customize how search results are scored.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-slowlog.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Slowlog</a></strong> <ul data-v-06e88026><li data-v-06e88026>Control over how slow queries and fetch requests are logged.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-store.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Store</a></strong> <ul data-v-06e88026><li data-v-06e88026>Configure the type of filesystem used to access shard data.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-translog.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Translog</a></strong> <ul data-v-06e88026><li data-v-06e88026>Control over the transaction log and background flush operations.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-history-retention.html" target="_self" rel="noopener noreferrer" data-v-06e88026>History retention</a></strong> <ul data-v-06e88026><li data-v-06e88026>Control over the retention of a history of operations in the index.</li></ul></li> <li data-v-06e88026><strong data-v-06e88026><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.9/index-modules-indexing-pressure.html" target="_self" rel="noopener noreferrer" data-v-06e88026>Indexing pressure</a></strong> <ul data-v-06e88026><li data-v-06e88026>Configure indexing back pressure limits.</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BigDataAndDistributedSystem/ELK/ESIndex-basicoperation.html" class="prev">ES Index-基本操作与并发</a></span> <span class="next"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html">ES Index-Index Template</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.251ed5d9.js" defer></script><script src="/assets/js/2.858e58ff.js" defer></script><script src="/assets/js/37.901c9e05.js" defer></script>
  </body>
</html>
