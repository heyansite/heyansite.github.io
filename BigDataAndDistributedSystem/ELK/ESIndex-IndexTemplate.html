<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES Index-Index Template | Yan&#39;s Blog Home</title>
    <meta name="description" content="Personal blog site">
    
    
    <link rel="preload" href="/assets/css/0.styles.ad4900be.css" as="style"><link rel="preload" href="/assets/js/app.251ed5d9.js" as="script"><link rel="preload" href="/assets/js/2.858e58ff.js" as="script"><link rel="preload" href="/assets/js/61.061546fa.js" as="script"><link rel="prefetch" href="/assets/js/10.5dcc1f52.js"><link rel="prefetch" href="/assets/js/100.c5640ec8.js"><link rel="prefetch" href="/assets/js/101.323d4ccf.js"><link rel="prefetch" href="/assets/js/102.d94a08aa.js"><link rel="prefetch" href="/assets/js/103.678e430d.js"><link rel="prefetch" href="/assets/js/104.b400bd3a.js"><link rel="prefetch" href="/assets/js/105.b6229a45.js"><link rel="prefetch" href="/assets/js/106.3ee7df20.js"><link rel="prefetch" href="/assets/js/107.4a958290.js"><link rel="prefetch" href="/assets/js/108.3ea2d0fb.js"><link rel="prefetch" href="/assets/js/109.e1eb969c.js"><link rel="prefetch" href="/assets/js/11.ff52cad9.js"><link rel="prefetch" href="/assets/js/110.a6e6e273.js"><link rel="prefetch" href="/assets/js/111.a172e2a2.js"><link rel="prefetch" href="/assets/js/112.dfc2a86d.js"><link rel="prefetch" href="/assets/js/113.6df6d874.js"><link rel="prefetch" href="/assets/js/114.302b8495.js"><link rel="prefetch" href="/assets/js/115.8651aa48.js"><link rel="prefetch" href="/assets/js/116.9e1f9a0b.js"><link rel="prefetch" href="/assets/js/117.9a74f4ce.js"><link rel="prefetch" href="/assets/js/118.121a666c.js"><link rel="prefetch" href="/assets/js/119.ca6819f9.js"><link rel="prefetch" href="/assets/js/12.b633635b.js"><link rel="prefetch" href="/assets/js/120.efe65d91.js"><link rel="prefetch" href="/assets/js/121.72958c2e.js"><link rel="prefetch" href="/assets/js/122.72c5fb33.js"><link rel="prefetch" href="/assets/js/123.e94917c1.js"><link rel="prefetch" href="/assets/js/124.11cc8c85.js"><link rel="prefetch" href="/assets/js/125.437fd863.js"><link rel="prefetch" href="/assets/js/126.207eaa74.js"><link rel="prefetch" href="/assets/js/127.125a30c1.js"><link rel="prefetch" href="/assets/js/128.1af89ad7.js"><link rel="prefetch" href="/assets/js/129.269e955a.js"><link rel="prefetch" href="/assets/js/13.4bfed5d6.js"><link rel="prefetch" href="/assets/js/130.3d2d293b.js"><link rel="prefetch" href="/assets/js/131.59e95e31.js"><link rel="prefetch" href="/assets/js/132.46b0ce06.js"><link rel="prefetch" href="/assets/js/133.f24ba32d.js"><link rel="prefetch" href="/assets/js/134.c8fe20d2.js"><link rel="prefetch" href="/assets/js/135.c7a5061f.js"><link rel="prefetch" href="/assets/js/136.b618e419.js"><link rel="prefetch" href="/assets/js/137.940c57e9.js"><link rel="prefetch" href="/assets/js/138.d59a4686.js"><link rel="prefetch" href="/assets/js/139.b2f4f7fd.js"><link rel="prefetch" href="/assets/js/14.49597bec.js"><link rel="prefetch" href="/assets/js/140.44b06552.js"><link rel="prefetch" href="/assets/js/141.f6a6d207.js"><link rel="prefetch" href="/assets/js/142.c86df684.js"><link rel="prefetch" href="/assets/js/143.5fd6fd83.js"><link rel="prefetch" href="/assets/js/144.c803a4cd.js"><link rel="prefetch" href="/assets/js/145.103c81ef.js"><link rel="prefetch" href="/assets/js/146.cd714a4a.js"><link rel="prefetch" href="/assets/js/147.df610887.js"><link rel="prefetch" href="/assets/js/148.3e704f1c.js"><link rel="prefetch" href="/assets/js/149.9291cd1d.js"><link rel="prefetch" href="/assets/js/15.16f4b9c1.js"><link rel="prefetch" href="/assets/js/150.6bf9657f.js"><link rel="prefetch" href="/assets/js/151.5ba13642.js"><link rel="prefetch" href="/assets/js/152.3f4f4ca8.js"><link rel="prefetch" href="/assets/js/153.b93c66a6.js"><link rel="prefetch" href="/assets/js/154.a398d903.js"><link rel="prefetch" href="/assets/js/155.63f86958.js"><link rel="prefetch" href="/assets/js/156.54044f43.js"><link rel="prefetch" href="/assets/js/157.f0e2bcb3.js"><link rel="prefetch" href="/assets/js/158.5b91c0e7.js"><link rel="prefetch" href="/assets/js/159.ab5444bc.js"><link rel="prefetch" href="/assets/js/16.c616e2b6.js"><link rel="prefetch" href="/assets/js/160.2530c91d.js"><link rel="prefetch" href="/assets/js/161.1df05a75.js"><link rel="prefetch" href="/assets/js/162.dad7fc47.js"><link rel="prefetch" href="/assets/js/163.b2d75a8a.js"><link rel="prefetch" href="/assets/js/164.4b49bb3c.js"><link rel="prefetch" href="/assets/js/165.ac1b34cb.js"><link rel="prefetch" href="/assets/js/166.00826470.js"><link rel="prefetch" href="/assets/js/167.e152507a.js"><link rel="prefetch" href="/assets/js/168.e668c315.js"><link rel="prefetch" href="/assets/js/169.c0832495.js"><link rel="prefetch" href="/assets/js/17.c15fd290.js"><link rel="prefetch" href="/assets/js/170.265153fd.js"><link rel="prefetch" href="/assets/js/171.362c431d.js"><link rel="prefetch" href="/assets/js/172.5e1589e8.js"><link rel="prefetch" href="/assets/js/173.7d1fef7b.js"><link rel="prefetch" href="/assets/js/174.e7293e4a.js"><link rel="prefetch" href="/assets/js/175.b28bdea7.js"><link rel="prefetch" href="/assets/js/176.c2d7977b.js"><link rel="prefetch" href="/assets/js/177.377eb895.js"><link rel="prefetch" href="/assets/js/178.1fa90333.js"><link rel="prefetch" href="/assets/js/179.68c5de48.js"><link rel="prefetch" href="/assets/js/18.db4a03ec.js"><link rel="prefetch" href="/assets/js/180.acb281b9.js"><link rel="prefetch" href="/assets/js/181.2be18ec9.js"><link rel="prefetch" href="/assets/js/182.bc60d6b6.js"><link rel="prefetch" href="/assets/js/183.f2919036.js"><link rel="prefetch" href="/assets/js/184.b38aec29.js"><link rel="prefetch" href="/assets/js/185.9a669ac8.js"><link rel="prefetch" href="/assets/js/186.e779fe45.js"><link rel="prefetch" href="/assets/js/187.468bfbe8.js"><link rel="prefetch" href="/assets/js/188.20d2e93c.js"><link rel="prefetch" href="/assets/js/189.42db30b7.js"><link rel="prefetch" href="/assets/js/19.d3b9b0a8.js"><link rel="prefetch" href="/assets/js/190.dea239ec.js"><link rel="prefetch" href="/assets/js/191.ccf9ae83.js"><link rel="prefetch" href="/assets/js/192.e2d30cca.js"><link rel="prefetch" href="/assets/js/193.62867c3e.js"><link rel="prefetch" href="/assets/js/194.13629983.js"><link rel="prefetch" href="/assets/js/195.4b68f3a0.js"><link rel="prefetch" href="/assets/js/196.ff59e8f6.js"><link rel="prefetch" href="/assets/js/197.15e020f7.js"><link rel="prefetch" href="/assets/js/198.4ea70ef4.js"><link rel="prefetch" href="/assets/js/199.56f0c110.js"><link rel="prefetch" href="/assets/js/20.c35dcf39.js"><link rel="prefetch" href="/assets/js/200.78dd9f28.js"><link rel="prefetch" href="/assets/js/201.91a68593.js"><link rel="prefetch" href="/assets/js/202.8a14b96a.js"><link rel="prefetch" href="/assets/js/203.a23a704a.js"><link rel="prefetch" href="/assets/js/204.dab38ee5.js"><link rel="prefetch" href="/assets/js/21.e43c696c.js"><link rel="prefetch" href="/assets/js/22.393983f9.js"><link rel="prefetch" href="/assets/js/23.e302c532.js"><link rel="prefetch" href="/assets/js/24.f4df4e7f.js"><link rel="prefetch" href="/assets/js/25.85aee522.js"><link rel="prefetch" href="/assets/js/26.f3d4bc2d.js"><link rel="prefetch" href="/assets/js/27.03f420d3.js"><link rel="prefetch" href="/assets/js/28.c8ad758a.js"><link rel="prefetch" href="/assets/js/29.acb65439.js"><link rel="prefetch" href="/assets/js/3.753236a7.js"><link rel="prefetch" href="/assets/js/30.fc1f5f5c.js"><link rel="prefetch" href="/assets/js/31.77e58103.js"><link rel="prefetch" href="/assets/js/32.5ef2f040.js"><link rel="prefetch" href="/assets/js/33.fc4584e7.js"><link rel="prefetch" href="/assets/js/34.71ca5ff9.js"><link rel="prefetch" href="/assets/js/35.bd5aae58.js"><link rel="prefetch" href="/assets/js/36.124f8c76.js"><link rel="prefetch" href="/assets/js/37.901c9e05.js"><link rel="prefetch" href="/assets/js/38.61d0edc2.js"><link rel="prefetch" href="/assets/js/39.7921a116.js"><link rel="prefetch" href="/assets/js/4.fdb5e485.js"><link rel="prefetch" href="/assets/js/40.b389d659.js"><link rel="prefetch" href="/assets/js/41.0a58c3f1.js"><link rel="prefetch" href="/assets/js/42.e7961d9e.js"><link rel="prefetch" href="/assets/js/43.af113228.js"><link rel="prefetch" href="/assets/js/44.7560b6a3.js"><link rel="prefetch" href="/assets/js/45.4291ebfa.js"><link rel="prefetch" href="/assets/js/46.65a6b698.js"><link rel="prefetch" href="/assets/js/47.2eb4574c.js"><link rel="prefetch" href="/assets/js/48.b0c68533.js"><link rel="prefetch" href="/assets/js/49.020f0482.js"><link rel="prefetch" href="/assets/js/5.29130c00.js"><link rel="prefetch" href="/assets/js/50.b7cb1a11.js"><link rel="prefetch" href="/assets/js/51.efe2b5f7.js"><link rel="prefetch" href="/assets/js/52.a96f1076.js"><link rel="prefetch" href="/assets/js/53.95f7bac7.js"><link rel="prefetch" href="/assets/js/54.476274a8.js"><link rel="prefetch" href="/assets/js/55.41919574.js"><link rel="prefetch" href="/assets/js/56.beb74e07.js"><link rel="prefetch" href="/assets/js/57.705bc19e.js"><link rel="prefetch" href="/assets/js/58.f5fd656b.js"><link rel="prefetch" href="/assets/js/59.04bd0a11.js"><link rel="prefetch" href="/assets/js/6.192ba4c2.js"><link rel="prefetch" href="/assets/js/60.df29a101.js"><link rel="prefetch" href="/assets/js/62.b733d1a1.js"><link rel="prefetch" href="/assets/js/63.926cae9b.js"><link rel="prefetch" href="/assets/js/64.54761bdd.js"><link rel="prefetch" href="/assets/js/65.f2c05d04.js"><link rel="prefetch" href="/assets/js/66.c50ec6bd.js"><link rel="prefetch" href="/assets/js/67.3f1e9d42.js"><link rel="prefetch" href="/assets/js/68.e6d72026.js"><link rel="prefetch" href="/assets/js/69.2de511ae.js"><link rel="prefetch" href="/assets/js/7.162225cc.js"><link rel="prefetch" href="/assets/js/70.65ac284e.js"><link rel="prefetch" href="/assets/js/71.a21ab478.js"><link rel="prefetch" href="/assets/js/72.1da0eaf9.js"><link rel="prefetch" href="/assets/js/73.fcfaf581.js"><link rel="prefetch" href="/assets/js/74.8edbd39c.js"><link rel="prefetch" href="/assets/js/75.70f5ea97.js"><link rel="prefetch" href="/assets/js/76.557c0bb2.js"><link rel="prefetch" href="/assets/js/77.9ce82f4b.js"><link rel="prefetch" href="/assets/js/78.0d809ae3.js"><link rel="prefetch" href="/assets/js/79.a9b07316.js"><link rel="prefetch" href="/assets/js/8.a12bb62b.js"><link rel="prefetch" href="/assets/js/80.fdc72255.js"><link rel="prefetch" href="/assets/js/81.beb8303a.js"><link rel="prefetch" href="/assets/js/82.0cb6ec59.js"><link rel="prefetch" href="/assets/js/83.0f3e946b.js"><link rel="prefetch" href="/assets/js/84.2e2f1d80.js"><link rel="prefetch" href="/assets/js/85.d850d4dd.js"><link rel="prefetch" href="/assets/js/86.32d87d56.js"><link rel="prefetch" href="/assets/js/87.5f97a4f6.js"><link rel="prefetch" href="/assets/js/88.f5b0bbdb.js"><link rel="prefetch" href="/assets/js/89.9f9150f5.js"><link rel="prefetch" href="/assets/js/9.0d992d03.js"><link rel="prefetch" href="/assets/js/90.f69286ce.js"><link rel="prefetch" href="/assets/js/91.cd415cf2.js"><link rel="prefetch" href="/assets/js/92.30ee9be1.js"><link rel="prefetch" href="/assets/js/93.9fc6f609.js"><link rel="prefetch" href="/assets/js/94.3d6138bf.js"><link rel="prefetch" href="/assets/js/95.d6a20d18.js"><link rel="prefetch" href="/assets/js/96.afb03bd8.js"><link rel="prefetch" href="/assets/js/97.14206eba.js"><link rel="prefetch" href="/assets/js/98.0d5b3805.js"><link rel="prefetch" href="/assets/js/99.d81e6ba7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ad4900be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Yan's Blog Home</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Blog Home</a></div><div class="nav-item"><a href="/index/" class="nav-link">Technical Blog Home</a></div><div class="nav-item"><a href="https://heyan.site:8003/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Other Blog Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/comments.html" class="nav-link">留言</a></div><div class="nav-item"><a href="http://heyan.site/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Site Home
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大数据和分布式系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统理论</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式协调服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据摄取 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据流 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据存储 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据处理 Layer</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据分析 Layer (OLAP)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式系统基础框架Hadoop</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data Platform - Splunk</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Data Platform - ELK</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/BigDataAndDistributedSystem/ELK/" class="sidebar-link">Data Platform - ELK</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-base.html" class="sidebar-link">ES 概念与总结</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-cluster.html" class="sidebar-link">ES 原理-分布式特性</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-index.html" class="sidebar-link">ES 原理-倒排索引</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESConcepts-AnalysisAndRelated.html" class="sidebar-link">ES 原理-分词器 &amp; 搜索相关性</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-basicoperation.html" class="sidebar-link">ES Index-基本操作与并发</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html" class="sidebar-link">ES Index-Mapping &amp; Setting</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html" class="active sidebar-link">ES Index-Index Template</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#elasticsearch-index-template" class="sidebar-link">Elasticsearch: Index template</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#定义一个index-template" class="sidebar-link">定义一个Index template</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#index-template和alias" class="sidebar-link">Index template和alias</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#index匹配多个template" class="sidebar-link">Index匹配多个template</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#查询index-template接口" class="sidebar-link">查询Index template接口</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#删除一个index-template" class="sidebar-link">删除一个index template</a></li></ul></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#初探-elasticsearch-index-template（索引模板" class="sidebar-link">初探 Elasticsearch Index Template（索引模板)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_1、模板优先级" class="sidebar-link">1、模板优先级</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_2、索引模板的匹配" class="sidebar-link">2、索引模板的匹配</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_3、setting-部分" class="sidebar-link">3、setting 部分</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_4、索引类型的字段映射" class="sidebar-link">4、索引类型的字段映射</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_5、别名" class="sidebar-link">5、别名</a></li></ul></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#index-template-和-dynamic-template" class="sidebar-link">Index Template 和 Dynamic Template</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_1-index-template" class="sidebar-link">1. Index Template</a></li><li class="sidebar-sub-header"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IndexTemplate.html#_2-dynamic-template" class="sidebar-link">2. Dynamic Template</a></li></ul></li></ul></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-TextAnalysis.html" class="sidebar-link">ES Index-Text Analysis</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESIndex-IngestAndScript.html" class="sidebar-link">ES Index-Ingest|Script</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESUsage-crud.html" class="sidebar-link">ES 使用-基本CRUD</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESSearch-search.html" class="sidebar-link">ES 搜索-搜索相关</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESSearch-queryDSL.html" class="sidebar-link">ES 搜索-查询DSL</a></li><li><a href="/BigDataAndDistributedSystem/ELK/ESSearch-aggregation.html" class="sidebar-link">ES 搜索-聚合</a></li></ul></section></li><li><a href="/index/" class="sidebar-link">&lt; 首页</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default" data-v-51d9266b data-v-51d9266b><h1 id="es-index-index-template" data-v-51d9266b><a href="#es-index-index-template" class="header-anchor" data-v-51d9266b>#</a> ES Index-Index Template</h1> <h2 id="elasticsearch-index-template" data-v-51d9266b><a href="#elasticsearch-index-template" class="header-anchor" data-v-51d9266b>#</a> Elasticsearch: Index template</h2> <div class="custom-block tip" data-v-51d9266b><p class="custom-block-title" data-v-51d9266b>转载1</p> <ul data-v-51d9266b><li data-v-51d9266b><a href="https://www.cnblogs.com/sanduzxcvbnm/p/12085103.html" target="_self" rel="noopener noreferrer" data-v-51d9266b>Elasticsearch: Index template</a></li></ul></div> <p data-v-51d9266b>Index template定义在创建新index时可以自动应用的settings和mappings。 Elasticsearch根据与index名称匹配的index模式将模板应用于新索引。这个对于我们想创建的一系列的Index具有同样的settings及mappings很有帮助。比如我们希望每一天/月的日志的index都具有同样的设置。</p> <div class="language- line-numbers-mode" data-v-51d9266b><pre class="language-text" data-v-51d9266b><code data-v-51d9266b>Log-2020-01
Log-2020-02
Log-2020-03
...
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b></div></div><p data-v-51d9266b>Index template仅在index创建期间应用。 对index template的更改不会影响现有索引。 create index API请求中指定的设置和映射会覆盖索引模板中指定的任何设置或映射。</p> <p data-v-51d9266b>你可以在代码中加入像C语言那样的block注释。你可以把这个注释放在除了开头 “{”和结尾的“}”之间的任何地方。</p> <h3 id="定义一个index-template" data-v-51d9266b><a href="#定义一个index-template" class="header-anchor" data-v-51d9266b>#</a> 定义一个Index template</h3> <p data-v-51d9266b>我们可以使用如下的接口来定义一个index template：</p> <div class="language- line-numbers-mode" data-v-51d9266b><pre class="language-text" data-v-51d9266b><code data-v-51d9266b>PUT /_template/&lt;index-template&gt;
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>我们可以使用_template这个终点来创建，删除，查看一个index template。下面，我们来举一个例子：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    PUT _template/logs_template
    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;logs-*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;order&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span> 
      <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>4</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span>
      <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> 
        <span class="token property" data-v-51d9266b>&quot;properties&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;@timestamp&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;date&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b></div></div><p data-v-51d9266b>在上面，我们可以看到，我们定义了一个叫做logs_template的index template。它的index_patterns定义为“logs-*”，说明，任何以“logs-”为开头的任何一个index将具有在该template里具有的settings及mappings属性。这里的“order”的意思是：如果索引与多个模板匹配，则Elasticsearch应用此模板的顺序。该值为1，表明有最先合并，如果有更高order的template，这个settings或mappings有可能被其它的template所覆盖。</p> <p data-v-51d9266b>下面，我们来测试一下我们刚定义的index template：</p> <div class="language- line-numbers-mode" data-v-51d9266b><pre class="language-text" data-v-51d9266b><code data-v-51d9266b>PUT logs-2020-03-01
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>在这里，我们创建了一个叫做logs-2020-03-01的index。我们使用如下的命令来检查被创建的情况：</p> <div class="language- line-numbers-mode" data-v-51d9266b><pre class="language-text" data-v-51d9266b><code data-v-51d9266b>GET logs-2020-03-01
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显示的结果为：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;logs-2020-03-01&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;properties&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;@timestamp&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;type&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;date&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;index&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;creation_date&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1567652671032&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;4&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;uuid&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;Dz5rqRS4SEyLM_gf5eEolQ&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;version&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;created&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;7030099&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;provided_name&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;logs-2020-03-01&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b></div></div><p data-v-51d9266b>证如上所示，我们已经成功创建了一个我们想要的index，并且它具有我们之前定义的settings及mappings。</p> <h3 id="index-template和alias" data-v-51d9266b><a href="#index-template和alias" class="header-anchor" data-v-51d9266b>#</a> Index template和alias</h3> <p data-v-51d9266b>我们甚至可以为我们的index template添加index alias：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    PUT _template/logs_template
    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;logs-*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;order&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span> 
      <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>4</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span>
      <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> 
        <span class="token property" data-v-51d9266b>&quot;properties&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;@timestamp&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;date&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;{index}-alias&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span><span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b></div></div><p data-v-51d9266b>在上面，我们已经创立了一个叫做{index}-alias的别名。这里的{index}就是实际生成index的文件名来代替。我们下面用一个例子来说明：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>PUT logs<span class="token number" data-v-51d9266b>-2020</span><span class="token number" data-v-51d9266b>-04</span><span class="token number" data-v-51d9266b>-01</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>我们创建一个叫做logs-2020-04-01的index, 那么它同时生成了一个叫做logs-2020-04-01-alias的别名。我们可以通过如下的命令来检查：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>GET logs<span class="token number" data-v-51d9266b>-2020</span><span class="token number" data-v-51d9266b>-04</span><span class="token number" data-v-51d9266b>-01</span>-alias
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显示的结果是：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;logs-2020-04-01&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;logs-2020-04-01-alias&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;properties&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;@timestamp&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;type&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;date&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;index&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;creation_date&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1567653644605&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;4&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;uuid&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;iLf-j_G2T4CYcHCqwz32Ng&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;version&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;created&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;7030099&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;provided_name&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;logs-2020-04-01&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>25</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>26</span><br data-v-51d9266b></div></div><h3 id="index匹配多个template" data-v-51d9266b><a href="#index匹配多个template" class="header-anchor" data-v-51d9266b>#</a> Index匹配多个template</h3> <p data-v-51d9266b>多个索引模板可能与索引匹配，在这种情况下，设置和映射都合并到索引的最终配置中。 可以使用order参数控制合并的顺序，首先应用较低的顺序，并且覆盖它们的较高顺序。 例如：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    PUT /_template/template_<span class="token number" data-v-51d9266b>1</span>
    <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span><span class="token string" data-v-51d9266b>&quot;*&quot;</span><span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;order&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>0</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;_source&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
     
    PUT /_template/template_<span class="token number" data-v-51d9266b>2</span>
    <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span><span class="token string" data-v-51d9266b>&quot;te*&quot;</span><span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;order&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;_source&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>true</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b></div></div><p data-v-51d9266b>以上的template_1将禁用存储<code data-v-51d9266b>_source</code>，但对于以<code data-v-51d9266b>te *</code>开头的索引，仍将启用_source。 注意，对于映射，合并是“深度”的，这意味着可以在高阶模板上轻松添加/覆盖特定的基于对象/属性的映射，而较低阶模板提供基础。</p> <p data-v-51d9266b>我们可以来创建一个例子看看：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>PUT test<span class="token number" data-v-51d9266b>10</span>
GET test<span class="token number" data-v-51d9266b>10</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显示的结果是：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;test10&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;index&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;creation_date&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1567654333181&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;uuid&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;iEwaQFl9RAKyTt79PduN-Q&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;version&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;created&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;7030099&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;provided_name&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;test10&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b></div></div><p data-v-51d9266b>如果我们创建另外一个不是以 “te”开头的index，我们可以看看如下的情况：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>PUT my_test_index
GET my_test_index
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显示的结果是：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;my_test_index&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;_source&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;index&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;creation_date&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1567654713059&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;uuid&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;aSsIZMT2RyWKT44G2dF2zg&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;version&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;created&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;7030099&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;provided_name&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;my_test_index&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显然在mappings里显示source是被禁止的。</p> <p data-v-51d9266b>如果对于两个templates来说，如果order是一样的话，我们可能陷于一种不可知论的合并状态。在实际的使用中必须避免。</p> <h3 id="查询index-template接口" data-v-51d9266b><a href="#查询index-template接口" class="header-anchor" data-v-51d9266b>#</a> 查询Index template接口</h3> <p data-v-51d9266b>我们可以通过如下的接口来查询已经被创建好的index template:</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>GET /_template/&lt;index-template&gt;
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>比如：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>GET /_template/logs_template
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显示的结果是：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>    <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;logs_template&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;order&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span>
          <span class="token string" data-v-51d9266b>&quot;logs-*&quot;</span>
        <span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;index&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;4&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;properties&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;@timestamp&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;type&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;date&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;{index}-alias&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b></div></div><p data-v-51d9266b>显示的内容就是我们之前已经创建的那个index template。</p> <p data-v-51d9266b>你也可以通过如下的方式来同时查询多个template的情况：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>GET /_template/template_<span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>template_<span class="token number" data-v-51d9266b>2</span>
GET /_template/temp*
GET /_template
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b></div></div><h3 id="删除一个index-template" data-v-51d9266b><a href="#删除一个index-template" class="header-anchor" data-v-51d9266b>#</a> 删除一个index template</h3> <p data-v-51d9266b>在之前的练习中，我们匹配“*”，也就是我们以后所有的创建的新的index将不存储source，这个显然不是我们所需要的。我们需要来把这个template进行删除。删除一个template的接口如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>DELETE /_template/&lt;index-template&gt;
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b></div></div><p data-v-51d9266b>那么针对我们的情况，我们可以使用如下的命令来删除我们不需要的template:</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>DELETE _template/template_<span class="token number" data-v-51d9266b>1</span>
DELETE _template/template_<span class="token number" data-v-51d9266b>2</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b></div></div><p data-v-51d9266b>这样我们删除了我们刚才创建的两个templates。</p> <br data-v-51d9266b> <br data-v-51d9266b> <hr data-v-51d9266b> <br data-v-51d9266b> <h2 id="初探-elasticsearch-index-template（索引模板" data-v-51d9266b><a href="#初探-elasticsearch-index-template（索引模板" class="header-anchor" data-v-51d9266b>#</a> 初探 Elasticsearch Index Template（索引模板)</h2> <div class="custom-block tip" data-v-51d9266b><p class="custom-block-title" data-v-51d9266b>转载2</p> <ul data-v-51d9266b><li data-v-51d9266b><a href="https://www.jianshu.com/p/1f67e4436c37" target="_self" rel="noopener noreferrer" data-v-51d9266b>初探 Elasticsearch Index Template（索引模板)</a></li></ul></div> <p data-v-51d9266b>典型使用结构如下所示：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;order&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>0</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;template&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;sample_info*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;64&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
  <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;info&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;dynamic_templates&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span>
        <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;string_fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;mapping&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;only_words_analyzer&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
              <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
              <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
              <span class="token property" data-v-51d9266b>&quot;fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                <span class="token property" data-v-51d9266b>&quot;raw&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                  <span class="token property" data-v-51d9266b>&quot;ignore_above&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>512</span><span class="token punctuation" data-v-51d9266b>,</span>
                  <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;not_analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                  <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span>
                <span class="token punctuation" data-v-51d9266b>}</span>
              <span class="token punctuation" data-v-51d9266b>}</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;match_mapping_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;match&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;*&quot;</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>]</span>，
    <span class="token property" data-v-51d9266b>&quot;properties&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;user_province&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;lowercase_analyzer&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
          <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
          <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
          <span class="token property" data-v-51d9266b>&quot;fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;raw&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
              <span class="token property" data-v-51d9266b>&quot;ignore_above&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>512</span><span class="token punctuation" data-v-51d9266b>,</span>
              <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;not_analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
              <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
          <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
  <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span><span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>25</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>26</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>27</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>28</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>29</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>30</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>31</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>32</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>33</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>34</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>35</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>36</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>37</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>38</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>39</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>40</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>41</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>42</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>43</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>44</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>45</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>46</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>47</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>48</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>49</span><br data-v-51d9266b></div></div><p data-v-51d9266b>上述模板定义，看似复杂，拆分来看，主要为如下几个部分：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;order&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>0</span><span class="token punctuation" data-v-51d9266b>,</span>                               <span class="token comment" data-v-51d9266b>// 模板优先级</span>
  <span class="token property" data-v-51d9266b>&quot;template&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;sample_info*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>               <span class="token comment" data-v-51d9266b>// 模板匹配的名称方式</span>
  <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>...<span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>                        <span class="token comment" data-v-51d9266b>// 索引设置</span>
  <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>...<span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>                        <span class="token comment" data-v-51d9266b>// 索引中各字段的映射定义</span>
  <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>...<span class="token punctuation" data-v-51d9266b>}</span>                          <span class="token comment" data-v-51d9266b>// 索引的别名</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b></div></div><h3 id="_1、模板优先级" data-v-51d9266b><a href="#_1、模板优先级" class="header-anchor" data-v-51d9266b>#</a> 1、模板优先级</h3> <p data-v-51d9266b>有时候，一个模板可能绝大部分符合新建索引的需求，但是局部需要微调，此时，如果复制旧的模板，修改该模板后，成为一个新的索引模板即可达到我们的需求，但是这操作略显重复。此时，可以采用模板叠加与覆盖来操作。模板的优先级是通过模板中的 order 字段定义的，数字越大，优先级越高。</p> <p data-v-51d9266b>如下为定义所有以 te 开头的索引的模板：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;order&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>0</span>
    <span class="token property" data-v-51d9266b>&quot;template&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;te*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span>
    <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type1&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;_source&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b></div></div><p data-v-51d9266b>索引模板是有序合并的。如何想单独修改某一小类索引的一两处单独设置，可以在累加一层模板。</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;order&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;template&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;tete*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>2</span>
    <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type1&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;_all&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b></div></div><p data-v-51d9266b>上述第一个模板的 order 为0，第二个模板的 order 为1，优先级高于第一个模板，其会覆盖第一个模板中的相同项。所以对于所有以 tete 开头的索引模板效果如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>2</span>
    <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type1&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;_source&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;_all&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;enabled&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span> <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b></div></div><p data-v-51d9266b>两个模板叠加了，项目的字段，优先级高的覆盖了优先级低的，如分片数。</p> <h3 id="_2、索引模板的匹配" data-v-51d9266b><a href="#_2、索引模板的匹配" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>2、索引模板的匹配</strong></h3> <p data-v-51d9266b>索引模板中的 &quot;template&quot; 字段定义的是该索引模板所应用的索引情况。如 &quot;template&quot;: &quot;tete*&quot; 所表示的含义是，当新建索引时，所有以 tete 开头的索引都会自动匹配到该索引模板。利用该模板进行相应的设置和字段添加等。</p> <h3 id="_3、setting-部分" data-v-51d9266b><a href="#_3、setting-部分" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>3、setting 部分</strong></h3> <p data-v-51d9266b>索引模板中的 setting 部分一般定义的是索引的主分片、拷贝分片、刷新时间、自定义分析器等。常见的 setting 部分结构如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;analysis&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>...<span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>                <span class="token comment" data-v-51d9266b>// 自定义的分析器</span>
      <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;32&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>         <span class="token comment" data-v-51d9266b>// 主分片的个数</span>
      <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>        <span class="token comment" data-v-51d9266b>// 主分片的拷贝分片个数</span>
      <span class="token property" data-v-51d9266b>&quot;refresh_interval&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;5s&quot;</span>          <span class="token comment" data-v-51d9266b>// 刷新时间</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
  <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b></div></div><p data-v-51d9266b>建立的索引，不会立马查到，这是为什么 Elasticsearch 为 near-real-time（接近实时）的原因，需要配置刷新时间，默认的是 1s。setting 的设置中，重点是自定义分析器的设置。
分析器是三个顺序执行的组件的结合。他们分别是字符过滤器、分词器、标记过滤器。</p> <ul data-v-51d9266b><li data-v-51d9266b>字符过滤器是让字符串在被分词前变得更加整洁。一个分析器可能包含零到多个字符过滤器（character_filter）。</li> <li data-v-51d9266b>分词器将字符串分割成单独的词（terms）或标记（tokens）。一个分析器必须包含一个分词器。</li> <li data-v-51d9266b>分词器分词的结果的标记流会根据各自的情况，传递给特定的标记过滤器。标记过滤器可能修改、添加或删除标记。</li></ul> <p data-v-51d9266b>创建的创建自定义分析器结构如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;analysis&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
           <span class="token property" data-v-51d9266b>&quot;char_filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>  <span class="token punctuation" data-v-51d9266b>{</span> ... <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>             <span class="token comment" data-v-51d9266b>// 用户自定义字符过滤器</span>
            <span class="token property" data-v-51d9266b>&quot;tokenizer&quot;</span><span class="token operator" data-v-51d9266b>:</span>   <span class="token punctuation" data-v-51d9266b>{</span> ... <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>             <span class="token comment" data-v-51d9266b>// 用户自定义分词器</span>
            <span class="token property" data-v-51d9266b>&quot;filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>      <span class="token punctuation" data-v-51d9266b>{</span> ... <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>             <span class="token comment" data-v-51d9266b>// 用户自定义标记过滤器</span>
            <span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span>    <span class="token punctuation" data-v-51d9266b>{</span> ... <span class="token punctuation" data-v-51d9266b>}</span>              <span class="token comment" data-v-51d9266b>// 用户自定义分析器</span>
      <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
      ...
    <span class="token punctuation" data-v-51d9266b>}</span>
  <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b></div></div><h4 id="_1）字符过滤器" data-v-51d9266b><a href="#_1）字符过滤器" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>1）字符过滤器</strong></h4> <p data-v-51d9266b>目前字符过滤器共分为三种：映射字符过滤器（mapping char filter）、HTML过滤器（HTML Strip char filter）、格式替换过滤器（Pattern Replace char filter）。html_strip 字符过滤器去除所有的 HTML 标签。</p> <p data-v-51d9266b>如下定义一个 mapping 字符过去器。将 &amp; 替换成 and。</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;char_filter&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;&amp;_to_and&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>       <span class="token string" data-v-51d9266b>&quot;mapping&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;&amp;=&gt; and &quot;</span><span class="token punctuation" data-v-51d9266b>]</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b></div></div><p data-v-51d9266b>mapping 字符过滤器的格式如上，其中 type 字段定义该字符过滤器的类型是 mapping 。其中 mappings 对应的数组为索要替换的字段。</p> <p data-v-51d9266b>如下在定义一个格式替换过滤器（Pattern Replace Char Filter），将点 &quot;.&quot; 替换成空格。</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;char_filter&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;replace_dot&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;pattern&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;\\.&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;pattern_replace&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;replacement&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot; &quot;</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b></div></div><p data-v-51d9266b>格式替换过滤器的格式如上、必须包含 &quot;pattern&quot;、&quot;type&quot;、&quot;replacement&quot; 三个字段。其中 pattern 定义的是满足替换的格式，type 则定义为格式替换类型。replacement 则是对于满足格式的字符串，要替换成的字符串。</p> <h4 id="_2）分词器" data-v-51d9266b><a href="#_2）分词器" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>2）分词器</strong></h4> <p data-v-51d9266b>常用的分词器有 standard、keyword、whitespace、pattern等。</p> <p data-v-51d9266b>standard 分词器将字符串分割成单独的字词，删除大部分标点符号。keyword 分词器输出和它接收到的相同的字符串，不做任何分词处理。whitespace 分词器只通过空格俩分割文本。pattern 分词器可以通过正则表达式来分割文本。最常用的一般为 standard 分词器。</p> <p data-v-51d9266b>更多的分词器详见官方文档：<a href="https://link.jianshu.com?t=https%3A%2F%2Fwww.elastic.co%2Fguide%2Fen%2Felasticsearch%2Freference%2F2.4%2Fanalysis-standard-tokenizer.html" target="_self" rel="noopener noreferrer" data-v-51d9266b>https://www.elastic.co/guide/en/elasticsearch/reference/2.4/analysis-standard-tokenizer.html</a></p> <p data-v-51d9266b><strong data-v-51d9266b>3）标记过滤器</strong></p> <p data-v-51d9266b>常用的标记过滤器有 lowercase 和 stop 。lowercase 标记过滤器将词转换为小写，stop 标记过滤器用户去除一些自定义停用词或者是语言内定义的停用词。</p> <p data-v-51d9266b>stop 标记过滤器的常用结构如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;filter&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;my_stopwords&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>        <span class="token string" data-v-51d9266b>&quot;stop&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;stopwords&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;the&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;a&quot;</span> <span class="token punctuation" data-v-51d9266b>]</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b></div></div><p data-v-51d9266b>上述标记过滤器是自定义的过滤掉 &quot;the&quot; 、&quot;a&quot; 两词。除了自定义，还有特定的语言停用词过滤，相应的有：<em data-v-51d9266b>spanish</em> 、<em data-v-51d9266b>english</em>等。具体用法如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;filter&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;my_stop&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>        <span class="token string" data-v-51d9266b>&quot;stop&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;stopwords&quot;</span><span class="token operator" data-v-51d9266b>:</span> _spanish_
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b></div></div><p data-v-51d9266b>更多的语言停用词参考官方网址：<a href="https://link.jianshu.com?t=https%3A%2F%2Fwww.elastic.co%2Fguide%2Fen%2Felasticsearch%2Freference%2F2.4%2Fanalysis-stop-tokenfilter.html" target="_self" rel="noopener noreferrer" data-v-51d9266b>https://www.elastic.co/guide/en/elasticsearch/reference/2.4/analysis-stop-tokenfilter.html</a>/</p> <p data-v-51d9266b><strong data-v-51d9266b>4）分析器组合</strong></p> <p data-v-51d9266b>如上定义了字符过滤器、分词器、标记过滤器之后，就该用户自定义分析器。分析器是由三者按顺序组合而成。</p> <p data-v-51d9266b>将上述组件组合起来便是：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;my_analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
        <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>           <span class="token string" data-v-51d9266b>&quot;custom&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;char_filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>  <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;html_strip&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;&amp;_to_and&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;replace_dot&quot;</span> <span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;tokenizer&quot;</span><span class="token operator" data-v-51d9266b>:</span>      <span class="token string" data-v-51d9266b>&quot;standard&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>       <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;lowercase&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;my_stopwords&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;my_stop&quot;</span> <span class="token punctuation" data-v-51d9266b>]</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b></div></div><p data-v-51d9266b>将自定义分析器各部分完整表示如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;analysis&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
           <span class="token property" data-v-51d9266b>&quot;char_filter&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                <span class="token property" data-v-51d9266b>&quot;&amp;_to_and&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>       <span class="token string" data-v-51d9266b>&quot;mapping&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;&amp;=&gt; and &quot;</span><span class="token punctuation" data-v-51d9266b>]</span>
                <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
                <span class="token property" data-v-51d9266b>&quot;replace_dot&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;pattern&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;\\.&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;pattern_replace&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;replacement&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot; &quot;</span>
                <span class="token punctuation" data-v-51d9266b>}</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>      <span class="token punctuation" data-v-51d9266b>{</span>
                <span class="token property" data-v-51d9266b>&quot;my_stop&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>        <span class="token string" data-v-51d9266b>&quot;stop&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;stopwords&quot;</span><span class="token operator" data-v-51d9266b>:</span> _spanish_
                <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
                <span class="token property" data-v-51d9266b>&quot;my_stopwords&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>        <span class="token string" data-v-51d9266b>&quot;stop&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;stopwords&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;the&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;a&quot;</span> <span class="token punctuation" data-v-51d9266b>]</span>
                <span class="token punctuation" data-v-51d9266b>}</span>
            <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span>    <span class="token punctuation" data-v-51d9266b>{</span>
                <span class="token property" data-v-51d9266b>&quot;my_analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span>           <span class="token string" data-v-51d9266b>&quot;custom&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;char_filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>  <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;html_strip&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;&amp;_to_and&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;replace_dot&quot;</span> <span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;tokenizer&quot;</span><span class="token operator" data-v-51d9266b>:</span>      <span class="token string" data-v-51d9266b>&quot;standard&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;filter&quot;</span><span class="token operator" data-v-51d9266b>:</span>       <span class="token punctuation" data-v-51d9266b>[</span> <span class="token string" data-v-51d9266b>&quot;lowercase&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;my_stopwords&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token string" data-v-51d9266b>&quot;my_stop&quot;</span> <span class="token punctuation" data-v-51d9266b>]</span>
                <span class="token punctuation" data-v-51d9266b>}</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
      <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
      ...
    <span class="token punctuation" data-v-51d9266b>}</span>
  <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>25</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>26</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>27</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>28</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>29</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>30</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>31</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>32</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>33</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>34</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>35</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>36</span><br data-v-51d9266b></div></div><h3 id="_4、索引类型的字段映射" data-v-51d9266b><a href="#_4、索引类型的字段映射" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>4、索引类型的字段映射</strong></h3> <p data-v-51d9266b>索引模板中，映射字段所对应的常用结构是：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;my_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                            <span class="token comment" data-v-51d9266b>// 索引下的类型 my_type 应用该映射</span>
      <span class="token property" data-v-51d9266b>&quot;dynamic_templates&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span> ... <span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>         <span class="token comment" data-v-51d9266b>// 动态映射部分，用于未定义的 my_type 下字段</span>
      <span class="token property" data-v-51d9266b>&quot;properties&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> ... <span class="token punctuation" data-v-51d9266b>}</span>                 <span class="token comment" data-v-51d9266b>// 自定义字段的响应映射</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b></div></div><p data-v-51d9266b>&quot;my_type&quot; 是索引下的一个类型，如果采用上述定义的索引模板，则索引下仅仅 my_type 类型应用了该索引模板。如果想要索引下的所有模板应用定义的映射，则可以将 &quot;my_type&quot; 替换成 &quot;<em data-v-51d9266b>default</em>&quot; 字段。</p> <h4 id="_1）动态映射" data-v-51d9266b><a href="#_1）动态映射" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>1）动态映射</strong></h4> <p data-v-51d9266b>动态映射 &quot;dynamic_templates&quot; 字段对应的是一个数组，数组中的元素是一个个字段的映射模板。每个字段的映射模板都有一个名字用户描述这个模板的用途，一个 mapping 字段由于指明这个映射如何使用，和至少一个参数（例如 match）来定义这个模板适用于哪个字段。</p> <p data-v-51d9266b>dynamic_templates 字段对应的字段模板结构如下：</p> <div class="language-cpp line-numbers-mode" data-v-51d9266b><pre class="language-cpp" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token string" data-v-51d9266b>&quot;string_fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                                  <span class="token comment" data-v-51d9266b>// 字段映射模板的名称，一般为&quot;类型_fields&quot;的命名方式</span>
        <span class="token string" data-v-51d9266b>&quot;match&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                                   <span class="token comment" data-v-51d9266b>// 匹配的字段名为所有</span>
        <span class="token string" data-v-51d9266b>&quot;match_mapping_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                 <span class="token comment" data-v-51d9266b>// 限制匹配的字段类型，只能是 string 类型</span>
        <span class="token string" data-v-51d9266b>&quot;mapping&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token punctuation" data-v-51d9266b>.</span><span class="token punctuation" data-v-51d9266b>.</span><span class="token punctuation" data-v-51d9266b>.</span> <span class="token punctuation" data-v-51d9266b>}</span>                              <span class="token comment" data-v-51d9266b>// 字段的处理方式</span>
 <span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b></div></div><p data-v-51d9266b>如下为一个定义实例：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;my_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;dynamic_templates&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span>
         <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;string_fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                                  <span class="token comment" data-v-51d9266b>// 字段映射模板的名称，一般为</span><span class="token string" data-v-51d9266b>&quot;类型_fields&quot;</span>的命名方式
                <span class="token property" data-v-51d9266b>&quot;match&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                                   <span class="token comment" data-v-51d9266b>// 匹配的字段名为所有</span>
                <span class="token property" data-v-51d9266b>&quot;match_mapping_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                 <span class="token comment" data-v-51d9266b>// 限制匹配的字段类型，只能是 string 类型</span>
                <span class="token property" data-v-51d9266b>&quot;mapping&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;fielddata&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;format&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;disabled&quot;</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>      <span class="token comment" data-v-51d9266b>// fielddata 不可用，对于分析字段，其默认值是可用</span>
                    <span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;only_words_analyzer&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>          <span class="token comment" data-v-51d9266b>// 字段采用的分析器名，默认值为 standard 分析器</span>
                    <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                        <span class="token comment" data-v-51d9266b>// 索引方式定义为索引，默认值是分析</span>
                    <span class="token property" data-v-51d9266b>&quot;omit_norms&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>true</span><span class="token punctuation" data-v-51d9266b>,</span>                         <span class="token comment" data-v-51d9266b>// omit_norms 为真表示考虑字段的加权，可分析字段默认值 false</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                           <span class="token comment" data-v-51d9266b>// 字段类型限定为 string</span>
                    <span class="token property" data-v-51d9266b>&quot;fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                                 <span class="token comment" data-v-51d9266b>// 定义一个嵌套字段，将该字段应用于不分析的场景</span>
                        <span class="token property" data-v-51d9266b>&quot;raw&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                            <span class="token property" data-v-51d9266b>&quot;ignore_above&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>256</span><span class="token punctuation" data-v-51d9266b>,</span>                <span class="token comment" data-v-51d9266b>// 忽略字段对应的值长度大于256的字段</span>
                            <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;not_analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>            <span class="token comment" data-v-51d9266b>// 索引方式为不分析</span>
                            <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                   <span class="token comment" data-v-51d9266b>// 字段的类型为 string</span>
                            <span class="token property" data-v-51d9266b>&quot;doc_values&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>true</span>                  <span class="token comment" data-v-51d9266b>// 对于不分析字段，doc_values 对应的是一种列式存储结构，默认false</span>
                        <span class="token punctuation" data-v-51d9266b>}</span>
                    <span class="token punctuation" data-v-51d9266b>}</span>
                <span class="token punctuation" data-v-51d9266b>}</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
        <span class="token punctuation" data-v-51d9266b>}</span>，
        ...
      <span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;properties&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> ... <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>25</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>26</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>27</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>28</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>29</span><br data-v-51d9266b></div></div><p data-v-51d9266b>可以看到，内部的字段模板的 mapping 字段下包含 fielddata、analyzer、index、omit_norms、type、fields 等六个字段，下面分别解释这六个字段。</p> <p data-v-51d9266b>对于基本的 Elasticsearch 做个了解，一般的 es 用户搜索字段，其反应数据非常快，接近实时，这个效果得益于其倒排索引的数据结构，然而倒排索引这个数据结构在做聚合分析时，却不是那么容易。因而在做传统分析时，需要一种我们常见的行式存储结构，这一结构在排序和巨额和分析时，具有明显的优势。这一部分详见 <a href="https://www.jianshu.com/p/76ab92de2786" target="_self" rel="noopener noreferrer" data-v-51d9266b>Elasticsearch 搜索与聚合在数据存储结构方面的理解</a> 。</p> <p data-v-51d9266b><strong data-v-51d9266b>fielddata</strong> 这一字段就是对于分析字段，除了倒排索引的数据存储方式，仍定义一种形式上看着是行式结构的存储样式，数据存储在内存中，用于对字段的排序和聚合分析。对于分析字段 fielddata 的默认值是可用的。如果确定一个分析字段不需要排序或者聚合分析，则该字段就设置为不可用。这样可以节省内存。</p> <p data-v-51d9266b><strong data-v-51d9266b>analyzer</strong> 定义的是该字段的分析器，默认的分析器是 standard 标准分析器，这个地方可定义为自定义的分析器。</p> <p data-v-51d9266b><strong data-v-51d9266b>index</strong> 定义的是字段的索引方式。默认的 ，Elasticsearch 对字段采取的是分析索引，即会对字段进行倒排索引。</p> <p data-v-51d9266b><strong data-v-51d9266b>omit_norms</strong> 定义的是字段在分析过程中，是否考虑加权。例如如果权重为2，字段出现的频率在计算时会翻倍，以提高计算的匹配度。对于分析字段，默认的是不考虑加权。</p> <p data-v-51d9266b><strong data-v-51d9266b>type</strong> 定义的是字段的数据类型。</p> <p data-v-51d9266b><strong data-v-51d9266b>fields</strong> 是字段应以一个嵌入字段。以  title 字段为例，Elasticsearch 会自动生成两个字段，分别是 title 和 title.raw 。这样，在有可能同时需要分词和不分词结果的环境，就可以很灵活的使用不同的索引字段。比如，查看标题中最常用的单词，应该是使用 title 字段，查看阅读数最多的文章标题，应该是使用 title.raw 字段。</p> <p data-v-51d9266b><strong data-v-51d9266b>ignore_above</strong> 字段是索引时忽略长度超过定义值的字段。</p> <p data-v-51d9266b><strong data-v-51d9266b>doc_values</strong> 字段与 fielddata 相对应，都是为了字段方便排序和聚合分析而重新定义的一种数据存储方式，不同的是，fielddata 应用于分析字段，存储在内存中；doc_values 应用于不分析字段，存储于磁盘中。</p> <p data-v-51d9266b>上述是针对字段数据类型为 string 的动态模板定义，对于其他数据类型，其动态模板的定义方式一般如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;float_fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                               <span class="token comment" data-v-51d9266b>// 命名方式 </span><span class="token string" data-v-51d9266b>&quot;类型_fields&quot;</span>
        <span class="token property" data-v-51d9266b>&quot;match&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;*&quot;</span>，
        <span class="token property" data-v-51d9266b>&quot;match_mapping_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;float&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token property" data-v-51d9266b>&quot;mapping&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;float&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;doc_values&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>true</span>                      <span class="token comment" data-v-51d9266b>// doc_values 定义为 true，便于排序与聚合分析</span>
        <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b></div></div><h4 id="_2）自定义字段映射" data-v-51d9266b><a href="#_2）自定义字段映射" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>2）自定义字段映射</strong></h4> <p data-v-51d9266b>针对索引类型中存在的字段，除了可以采用动态模板的方式，还可以采用定义定义的方式，常见的自定义结构如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;my_type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;dynamic_templates&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span> ... <span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;properties&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
          <span class="token property" data-v-51d9266b>&quot;user_city&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                                <span class="token comment" data-v-51d9266b>// 字段名</span>
             <span class="token property" data-v-51d9266b>&quot;analyzer&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;lowercase_analyzer&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>          <span class="token comment" data-v-51d9266b>// 字段分析器</span>
             <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                       <span class="token comment" data-v-51d9266b>// 字段索引方式定义索引</span>
             <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>                          <span class="token comment" data-v-51d9266b>// 字段数据类型定义为 string</span>
             <span class="token property" data-v-51d9266b>&quot;fields&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>                                <span class="token comment" data-v-51d9266b>// 定义一个名为 user_city.raw 的嵌入的不分析字段</span>
                <span class="token property" data-v-51d9266b>&quot;raw&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
                    <span class="token property" data-v-51d9266b>&quot;ignore_above&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>512</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;not_analyzed&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
                    <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;string&quot;</span>
                <span class="token punctuation" data-v-51d9266b>}</span>
            <span class="token punctuation" data-v-51d9266b>}</span>
         <span class="token punctuation" data-v-51d9266b>}</span>，
         <span class="token property" data-v-51d9266b>&quot;money&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token punctuation" data-v-51d9266b>{</span>
            <span class="token property" data-v-51d9266b>&quot;type&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;double&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
            <span class="token property" data-v-51d9266b>&quot;doc_values&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>true</span>
         <span class="token punctuation" data-v-51d9266b>}</span>
         ...
      <span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b></div></div><p data-v-51d9266b>复杂一些的是 string 类型的字段，对于其他类型的字段，定义方式类似于上述的 money 字段定义方式。</p> <h3 id="_5、别名" data-v-51d9266b><a href="#_5、别名" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>5、别名</strong></h3> <p data-v-51d9266b>即使你认为现在的索引设计已经是完美的了，当你的应用在生产环境使用时，还是有可能在今后有一些改变的。所以请做好准备：在应用中使用别名而不是索引。然后你就可以在任何时候重建索引。别名的开销很小，应当广泛使用。利用索引别名，可以实现零停机时间重新索引。</p> <p data-v-51d9266b>定义方式如下：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b><span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;order&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>0</span><span class="token punctuation" data-v-51d9266b>,</span>                               <span class="token comment" data-v-51d9266b>// 模板优先级</span>
  <span class="token property" data-v-51d9266b>&quot;template&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;sample_info*&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>               <span class="token comment" data-v-51d9266b>// 模板匹配的名称方式</span>
  <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>...<span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>                        <span class="token comment" data-v-51d9266b>// 索引设置</span>
  <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>...<span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>                        <span class="token comment" data-v-51d9266b>// 索引中各字段的映射定义</span>
  <span class="token property" data-v-51d9266b>&quot;aliases&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
     <span class="token property" data-v-51d9266b>&quot;my_index&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token punctuation" data-v-51d9266b>{</span><span class="token punctuation" data-v-51d9266b>}</span>
  <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b></div></div><p data-v-51d9266b>零停机时间实现重新索引方式：</p> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>POST /_aliases
<span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;actions&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span>
        <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;remove&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;my_index_v1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token property" data-v-51d9266b>&quot;alias&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;my_index&quot;</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
        <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;add&quot;</span><span class="token operator" data-v-51d9266b>:</span>    <span class="token punctuation" data-v-51d9266b>{</span> <span class="token property" data-v-51d9266b>&quot;index&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;my_index_v2&quot;</span><span class="token punctuation" data-v-51d9266b>,</span> <span class="token property" data-v-51d9266b>&quot;alias&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token string" data-v-51d9266b>&quot;my_index&quot;</span> <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>}</span>
    <span class="token punctuation" data-v-51d9266b>]</span>
<span class="token punctuation" data-v-51d9266b>}</span>
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b></div></div><br data-v-51d9266b> <br data-v-51d9266b> <hr data-v-51d9266b> <br data-v-51d9266b> <p data-v-51d9266b>集群上的索引会随着时间越来越多，例如，会为你的日志每天创建一个索引。使用多个素银可以更好的管理数据，提高性能，例如：logs-2019-05-01、logs-2019-05-02。</p> <h2 id="index-template-和-dynamic-template" data-v-51d9266b><a href="#index-template-和-dynamic-template" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>Index Template 和 Dynamic Template</strong></h2> <div class="custom-block tip" data-v-51d9266b><p class="custom-block-title" data-v-51d9266b>转载3</p> <ul data-v-51d9266b><li data-v-51d9266b><a href="https://www.yuque.com/xiongsanxiansheng/qfvqxo/llgddg" target="_self" rel="noopener noreferrer" data-v-51d9266b><strong data-v-51d9266b>Index Template 和 Dynamic Template</strong></a></li></ul></div> <h3 id="_1-index-template" data-v-51d9266b><a href="#_1-index-template" class="header-anchor" data-v-51d9266b>#</a> <strong data-v-51d9266b>1. Index Template</strong></h3> <h4 id="_1-1-什么是index-template？" data-v-51d9266b><a href="#_1-1-什么是index-template？" class="header-anchor" data-v-51d9266b>#</a> 1.1 什么是Index Template？</h4> <ul data-v-51d9266b><li data-v-51d9266b>Index Template：帮助你设定 Mapping 和 Settings，并按照一定的规则自动匹配到新创建的索引上
<ul data-v-51d9266b><li data-v-51d9266b>Mappings 主要作用于字段的信息说明；</li> <li data-v-51d9266b>Settings 主要作用于 index 的一些相关配置信息，如分片数、副本数，tranlog 同步条件、refresh 等；</li> <li data-v-51d9266b>模板尽在一个索引被新创建时，才会产生作用。修改模板不会影响已创建的索引；</li> <li data-v-51d9266b>你可以设定多个索引模板，这些设置会被 &quot;merge&quot; 在一起；</li> <li data-v-51d9266b>你可以指定 &quot;order&quot; 的数值，控制 &quot;merging&quot; 的过程；</li></ul></li></ul> <h4 id="_1-2-index-template的工作方式" data-v-51d9266b><a href="#_1-2-index-template的工作方式" class="header-anchor" data-v-51d9266b>#</a> 1.2 Index Template的工作方式</h4> <ul data-v-51d9266b><li data-v-51d9266b>当一个索引被新创建时
<ul data-v-51d9266b><li data-v-51d9266b>使用 Elasticsearch 默认的 settings 和 mappings</li> <li data-v-51d9266b>使用 order 数值低的 Index Template 中的设定</li> <li data-v-51d9266b>使用 order 数值高的 Index Template 中的设定，之前的设定会被覆盖</li> <li data-v-51d9266b>创建索引时，用户如果自己配置 settings 和 mappings，并覆盖之前模板中的设定</li></ul></li></ul> <blockquote data-v-51d9266b><p data-v-51d9266b>只要索引名字满足模板中的正则表达式，就会在索引创建时自动触发索引模板。</p></blockquote> <div class="language-json line-numbers-mode" data-v-51d9266b><pre class="language-json" data-v-51d9266b><code data-v-51d9266b>#插入数据
PUT ttemplate/_doc/<span class="token number" data-v-51d9266b>1</span>
<span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;someNumber&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;someDate&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token string" data-v-51d9266b>&quot;2019/01/01&quot;</span>
<span class="token punctuation" data-v-51d9266b>}</span>

#查看Dynamic Mapping，数字字符串被映射成text，日期字符串被映射成日期
GET ttemplate/_mapping

#创建<span class="token number" data-v-51d9266b>2</span>个Index Template
#创建一个默认的 default template
PUT _template/template_default
<span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span><span class="token string" data-v-51d9266b>&quot;*&quot;</span><span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;order&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>0</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;version&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token number" data-v-51d9266b>1</span>
  <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>

#创建template_test模板
PUT /_template/template_test
<span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;index_patterns&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>[</span><span class="token string" data-v-51d9266b>&quot;test*&quot;</span><span class="token punctuation" data-v-51d9266b>]</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;order&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;settings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;number_of_shards&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>2</span>
    <span class="token punctuation" data-v-51d9266b>}</span><span class="token punctuation" data-v-51d9266b>,</span>
    <span class="token property" data-v-51d9266b>&quot;mappings&quot;</span> <span class="token operator" data-v-51d9266b>:</span> <span class="token punctuation" data-v-51d9266b>{</span>
      <span class="token property" data-v-51d9266b>&quot;date_detection&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>false</span><span class="token punctuation" data-v-51d9266b>,</span>
      <span class="token property" data-v-51d9266b>&quot;numeric_detection&quot;</span><span class="token operator" data-v-51d9266b>:</span> <span class="token boolean" data-v-51d9266b>true</span>
    <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>

#查看template信息
GET /_template/template_default
GET /_template/temp*


#写入新的数据，index以test开头
PUT testtemplate/_doc/<span class="token number" data-v-51d9266b>1</span>
<span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;someNumber&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token string" data-v-51d9266b>&quot;1&quot;</span><span class="token punctuation" data-v-51d9266b>,</span>
  <span class="token property" data-v-51d9266b>&quot;someDate&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token string" data-v-51d9266b>&quot;2019/01/01&quot;</span>
<span class="token punctuation" data-v-51d9266b>}</span>
#数字转成long，日期字符串转成text
GET testtemplate/_mapping
#primary：<span class="token number" data-v-51d9266b>1</span><span class="token punctuation" data-v-51d9266b>,</span> replica<span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>2</span>
GET testtemplate/_settings


#创建一个临时索引test*开头，会触发template_test模板
PUT testmy
<span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;settings&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token punctuation" data-v-51d9266b>{</span>
    <span class="token property" data-v-51d9266b>&quot;number_of_replicas&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token number" data-v-51d9266b>5</span>
  <span class="token punctuation" data-v-51d9266b>}</span>
<span class="token punctuation" data-v-51d9266b>}</span>

PUT testmy/_doc/<span class="token number" data-v-51d9266b>1</span>
<span class="token punctuation" data-v-51d9266b>{</span>
  <span class="token property" data-v-51d9266b>&quot;key&quot;</span><span class="token operator" data-v-51d9266b>:</span><span class="token string" data-v-51d9266b>&quot;value&quot;</span>
<span class="token punctuation" data-v-51d9266b>}</span>

#查看replica<span class="token operator" data-v-51d9266b>:</span> <span class="token number" data-v-51d9266b>5</span>
GET testmy/_settings

#清理
DELETE testmy
DELETE /_template/template_default
DELETE /_template/template_test
</code></pre> <div class="line-numbers-wrapper" data-v-51d9266b><span class="line-number" data-v-51d9266b>1</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>2</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>3</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>4</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>5</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>6</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>7</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>8</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>9</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>10</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>11</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>12</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>13</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>14</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>15</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>16</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>17</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>18</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>19</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>20</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>21</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>22</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>23</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>24</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>25</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>26</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>27</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>28</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>29</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>30</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>31</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>32</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>33</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>34</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>35</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>36</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>37</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>38</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>39</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>40</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>41</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>42</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>43</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>44</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>45</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>46</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>47</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>48</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>49</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>50</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>51</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>52</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>53</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>54</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>55</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>56</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>57</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>58</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>59</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>60</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>61</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>62</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>63</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>64</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>65</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>66</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>67</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>68</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>69</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>70</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>71</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>72</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>73</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>74</span><br data-v-51d9266b><span class="line-number" data-v-51d9266b>75</span><br data-v-51d9266b></div></div><h3 id="_2-dynamic-template" data-v-51d9266b><a href="#_2-dynamic-template" class="header-anchor" data-v-51d9266b>#</a> 2. Dynamic Template</h3> <h4 id="_2-1-什么是-dynamic-template？" data-v-51d9266b><a href="#_2-1-什么是-dynamic-template？" class="header-anchor" data-v-51d9266b>#</a> 2.1 什么是 Dynamic Template？</h4> <ul data-v-51d9266b><li data-v-51d9266b>根据 ES 识别的数据类型，结合字段名称，来动态设定字段类型，例如：
<ul data-v-51d9266b><li data-v-51d9266b>所有的字符串类型都设定成 keyword，或者关闭 keyword 字段</li> <li data-v-51d9266b>is 开头的字段都设置成 boolean</li> <li data-v-51d9266b>long_ 开头的都设置成 long 类型</li></ul></li></ul> <h4 id="_2-2-dynamic-template设定" data-v-51d9266b><a href="#_2-2-dynamic-template设定" class="header-anchor" data-v-51d9266b>#</a> 2.2 Dynamic Template设定</h4> <ul data-v-51d9266b><li data-v-51d9266b><p data-v-51d9266b>Dynamic Template 是定义在某个索引的 Mapping 中；</p></li> <li data-v-51d9266b><p data-v-51d9266b>Template 有一个名称；</p></li> <li data-v-51d9266b><p data-v-51d9266b>匹配规则是一个数组，参数如下：</p> <ul data-v-51d9266b><li data-v-51d9266b>match_mapping_type：自动识别文档中的字段值在对应匹配到 ES 中的类型，如 string、boolean 等；</li> <li data-v-51d9266b>match，unmatch：寻找匹配文档有没有对应匹配的字段名；</li> <li data-v-51d9266b>path_match，patch_unmatch：结合路径去匹配字段名</li></ul></li> <li data-v-51d9266b><p data-v-51d9266b>为匹配到字段设置 Mapping；</p></li></ul> <blockquote data-v-51d9266b><ul data-v-51d9266b><li data-v-51d9266b>注意 template 数组中的顺序：
<ul data-v-51d9266b><li data-v-51d9266b>模板按照顺序来检测，第一个匹配的模板会被优先启用；</li> <li data-v-51d9266b>例如，我们给 string 类型字段定义两个模板：
<ul data-v-51d9266b><li data-v-51d9266b>strings_as_boolean：以 is 开头的字段名会映射成 boolean；</li> <li data-v-51d9266b>strings_as_keywords：所有其他 text 字段映射成 keyword；</li></ul></li> <li data-v-51d9266b>我们将 string_as_boolean 模板放在第一位，因为它比匹配所有字符串字段的 strings_as_keyword 模板更特殊。</li></ul></li></ul></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BigDataAndDistributedSystem/ELK/ESIndex-mapping.html" class="prev">ES Index-Mapping &amp; Setting</a></span> <span class="next"><a href="/BigDataAndDistributedSystem/ELK/ESIndex-TextAnalysis.html">ES Index-Text Analysis</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.251ed5d9.js" defer></script><script src="/assets/js/2.858e58ff.js" defer></script><script src="/assets/js/61.061546fa.js" defer></script>
  </body>
</html>
